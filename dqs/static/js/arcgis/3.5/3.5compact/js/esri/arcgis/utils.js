/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/layers/OnDemandMode":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=_1([_9],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_c){this.featureLayer=_c;this._featureMap={};this._queryErrorHandler=_3.hitch(this,this._queryErrorHandler);},initialize:function(_d){this.inherited(arguments);var _e=this.featureLayer,_f=_e._srInfo;this._gridLayer=new _a(new _7(_f?_f.valid[0]:_d.extent.xmin,_d.extent.ymax,_d.spatialReference),{width:_e._tileWidth,height:_e._tileHeight},{width:_d.width,height:_d.height},_f);this._cellMap={};this._gridLayer.setResolution(_d.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(_10){if(this._init){if(_10<2){this._zoomHandler();}else{console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id = "+this.featureLayer.id+", Layer URL = "+this.featureLayer.url);}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_11){var _12=this._gridLayer,_13=_11.geometry,_14=[];if(!_13){return;}_14=_12.getCellsInExtent((_13.type==="point")?{xmin:_13.x,ymin:_13.y,xmax:_13.x,ymax:_13.y}:_13.getExtent(),false).cells;var _15=this._cellMap,i,_16,oid=_11.attributes[this.featureLayer.objectIdField],_17,row,col;for(i=0;i<_14.length;i++){_16=_14[i];_17=_16.latticeID;row=_16.row;col=_16.col;if(_17){_16=(_15[_17]=(_15[_17]||_16));}else{_15[row]=_15[row]||{};_16=(_15[row][col]=(_15[row][col]||_16));}_16.features=_16.features||[];_16.features.push(_11);this._addFeatureIIf(oid,_11);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_2.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_2.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_2.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_2.disconnect(this._zoomConnect);_2.disconnect(this._panConnect);_2.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _18=this.featureLayer,map=this.map;if(_18.suspended){return;}_18._fireUpdateStart();this._clearIIf();var _19=_18._trackManager;if(_19){_19.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_1a,_1b){var id="_"+_1a.name+_1a.layerId+_1a._ulid+"_"+_1b.resolution+"_"+(_1b.latticeID||(_1b.row+"_"+_1b.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_1c){this._exceeds=false;var _1d=this.featureLayer,map=this.map,_1e=_1c||map.extent,_1f=this._gridLayer.getCellsInExtent(_1e,_1d.latticeTiling),_20=_1f.cells;if(!_1d.isEditable()){var _21=this._cellMap;_20=_4.filter(_20,function(_22){if(_22.lattice){if(_21[_22.latticeID]){return false;}}else{if(_21[_22.row]&&_21[_22.row][_22.col]){return false;}}return true;});}var _23=_1d.getOutFields(),_24=_1d.getDefinitionExpression(),_25=_1d._getOffsettedTE(_1d._mapTimeExtent),_26=_1d._usePatch,_27=this._ioQueue,i,_28=this,_29=this._drawFeatures,_2a,_2b,_2c;this._pending=this._pending||0;for(i=0;i<_20.length;i++){_2a=_20[i];_2b=new _8();_2b.geometry=_2a.extent||_2a.lattice;_2b.outFields=_23;_2b.where=_24;if(_1d.latticeTiling&&_2a.extent){_2b.spatialRelationship=_8.SPATIAL_REL_CONTAINS;}_2b.returnGeometry=true;_2b.timeExtent=_25;_2b.maxAllowableOffset=_1d._maxOffset;if(_1d._ts){_2b._ts=(new Date()).getTime();}_2c=null;if(_26){_2c=this._getRequestId(_1d,_2a);if(this._isPending(_2c)){continue;}}this._pending++;_27.push(_1d._task.execute(_2b,function(){var _2d=_2a;return function(_2e){_29.apply(_28,[_2e,_2d]);};}.call(this),this._queryErrorHandler,_2c));}this._removeOldCells(_1e);this._endCheck();},_drawFeatures:function(_2f,_30){this._exceeds=this._exceeds||_2f.exceededTransferLimit;this._finalizeIO();var _31=this.featureLayer,map=this.map,_32=map.extent,_33=_30.extent,row=_30.row,col=_30.col,_34=_31.objectIdField,_35=_2f.features,_36=this._gridLayer,_37=this._cellMap,i,len,_38=_30.latticeID,_39=_38?_37[_38]:(_37[row]&&_37[row][col]);if((_30.resolution!=_36._resolution)||(_38?(_38!==_36.getLatticeID(_32)):(!_36.intersects(_33,_32)))){if(_39){this._removeCell(row,col,_38);}}else{if(_39){this._updateCell(_39,_35);}else{_30.features=_35;if(_38){_37[_38]=_30;}else{_37[row]=_37[row]||{};_37[row][col]=_30;}len=_35.length;for(i=0;i<len;i++){var _3a=_35[i];var oid=_3a.attributes[_34];this._addFeatureIIf(oid,_3a);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_3b){if(this._pending===0){this._processIOQueue();var _3c=this.featureLayer,_3d=_3c._trackManager;if(_3d){_3d.clearTracks();_3d.addFeatures(_3c.graphics);if(_3c._ager){_4.forEach(_3c.graphics,function(_3e){if(_3e._shape){_3c._repaint(_3e);}});}_3d.moveLatestToFront();_3d.drawTracks();}this.featureLayer._fireUpdateEnd(_3b&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_3c.onQueryLimitExceeded();}}},_processIOQueue:function(_3f){this._ioQueue=_4.filter(this._ioQueue,function(dfd){var _40=dfd.fired>-1?false:true;return _40;});if(_3f){_4.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_41){var _42=this._cellMap,_43=this._gridLayer,_44,_45;for(_44 in _42){if(_42[_44]){var row=_42[_44],_46=row.latticeID,_47=0,_48=0;if(_46){_47++;if(_46!==_43.getLatticeID(_41)){this._removeCell(null,null,_46);_48++;}}else{for(_45 in row){if(row[_45]){_47++;var _49=row[_45].extent;if(!_43.intersects(_49,_41)){this._removeCell(_44,_45);_48++;}}}}if(_48===_47){delete _42[_44];}}}},_updateCell:function(_4a,_4b){var _4c=this.featureLayer,_4d=_4c.objectIdField,_4e=_4c._selectedFeatures,i,len=_4b.length;_4a.features=_4a.features||[];for(i=0;i<len;i++){var _4f=_4b[i];var oid=_4f.attributes[_4d];var _50=this._addFeatureIIf(oid,_4f);if(_50===_4f){this._incRefCount(oid);_4a.features.push(_50);}else{if(!(oid in _4e)){_50.setGeometry(_4f.geometry);_50.setAttributes(_4f.attributes);}}}},_removeCell:function(row,col,_51){var _52=this._cellMap,_53=this.featureLayer,_54=_53.objectIdField;var _55=_51?_52[_51]:(_52[row]&&_52[row][col]);if(_55){if(_51){delete _52[_51];}else{delete _52[row][col];}var _56=_55.features,i;for(i=0;i<_56.length;i++){var _57=_56[i];var oid=_57.attributes[_54];this._decRefCount(oid);if(oid in _53._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(_5("extend-esri")){_3.setObject("layers._OnDemandMode",_b,_6);}return _b;});},"dijit/a11y":function(){define("dijit/a11y",["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-style","dojo/sniff","./main"],function(_58,_59,_5a,dom,_5b,_5c,has,_5d){var _5e=(_5d._isElementShown=function(_5f){var s=_5c.get(_5f);return (s.visibility!="hidden")&&(s.visibility!="collapsed")&&(s.display!="none")&&(_5b.get(_5f,"type")!="hidden");});_5d.hasDefaultTabStop=function(_60){switch(_60.nodeName.toLowerCase()){case "a":return _5b.has(_60,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var _61;try{var _62=_60.contentDocument;if("designMode" in _62&&_62.designMode=="on"){return true;}_61=_62.body;}catch(e1){try{_61=_60.contentWindow.document.body;}catch(e2){return false;}}return _61&&(_61.contentEditable=="true"||(_61.firstChild&&_61.firstChild.contentEditable=="true"));default:return _60.contentEditable=="true";}};var _63=(_5d.isTabNavigable=function(_64){if(_5b.get(_64,"disabled")){return false;}else{if(_5b.has(_64,"tabIndex")){return _5b.get(_64,"tabIndex")>=0;}else{return _5d.hasDefaultTabStop(_64);}}});_5d._getTabNavigable=function(_65){var _66,_67,_68,_69,_6a,_6b,_6c={};function _6d(_6e){return _6e&&_6e.tagName.toLowerCase()=="input"&&_6e.type&&_6e.type.toLowerCase()=="radio"&&_6e.name&&_6e.name.toLowerCase();};var _6f=function(_70){for(var _71=_70.firstChild;_71;_71=_71.nextSibling){if(_71.nodeType!=1||(has("ie")<=9&&_71.scopeName!=="HTML")||!_5e(_71)){continue;}if(_63(_71)){var _72=+_5b.get(_71,"tabIndex");if(!_5b.has(_71,"tabIndex")||_72==0){if(!_66){_66=_71;}_67=_71;}else{if(_72>0){if(!_68||_72<_69){_69=_72;_68=_71;}if(!_6a||_72>=_6b){_6b=_72;_6a=_71;}}}var rn=_6d(_71);if(_5b.get(_71,"checked")&&rn){_6c[rn]=_71;}}if(_71.nodeName.toUpperCase()!="SELECT"){_6f(_71);}}};if(_5e(_65)){_6f(_65);}function rs(_73){return _6c[_6d(_73)]||_73;};return {first:rs(_66),last:rs(_67),lowest:rs(_68),highest:rs(_6a)};};_5d.getFirstInTabbingOrder=function(_74,doc){var _75=_5d._getTabNavigable(dom.byId(_74,doc));return _75.lowest?_75.lowest:_75.first;};_5d.getLastInTabbingOrder=function(_76,doc){var _77=_5d._getTabNavigable(dom.byId(_76,doc));return _77.last?_77.last:_77.highest;};return {hasDefaultTabStop:_5d.hasDefaultTabStop,isTabNavigable:_5d.isTabNavigable,_getTabNavigable:_5d._getTabNavigable,getFirstInTabbingOrder:_5d.getFirstInTabbingOrder,getLastInTabbingOrder:_5d.getLastInTabbingOrder};});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_78,_79,_7a,_7b,_7c,_7d,has,_7e,_7f,_80,_81,_82,_83,_84,_85){var _86=_78([_83],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_87){this.pointSymbol=_87&&_87.pointSymbol;this.polylineSymbol=_87&&_87.polylineSymbol;this.polygonSymbol=_87&&_87.polygonSymbol;this._outSR=(_87&&(_87.outSpatialReference||_87.outSR))||new _7f({wkid:4326});this._options=_87;this.registerConnectEvents("esri.layers._ServiceGeneratedFeatureCollection",true);},parse:function(){console.error("parse function has not been implemented");},getFeatureLayers:function(){var _88=[];if(this._fLayers){_88=_88.concat(this._fLayers);}return _88;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._createLayer();},_createLayer:function(_89){var _8a=this;this._fireUpdateStart();var _8b=this.parse(_89);_8b.addCallback(function(_8c){_8a._io=null;_8a._initLayer(_8c);});_8b.addErrback(function(err){_8a._io=null;err=_7a.mixin(new Error(),err);err.message="Unable to load resource: "+_8a.url+" "+(err.message||"");_8a._fireUpdateEnd(err);_8a.onError(err);});},_initLayer:function(_8d){if(this.loaded){this._removeInternalLayers();}this.name=_8d.name;this.description=_8d.description;this.snippet=_8d.snippet;if(_8d.visibility!==undefined){this.defaultVisibility=this.visible=!!_8d.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_8d.featureInfos;this.fullExtent=this.initialExtent=new _80(_8d.lookAtExtent);this.copyright=_8d.author||_8d.copyright;var _8e;var _8f=_7a.getObject("featureCollection.layers",false,_8d);if(_8f&&_8f.length>0){this._fLayers=[];_7b.forEach(_8f,function(_90,i){var _91=_7a.getObject("featureSet.features",false,_90),_92;if(_91&&_91.length>0){_8e=_7a.mixin({outFields:["*"],infoTemplate:_90.popupInfo?new _85(_90.popupInfo):null,editable:false},this._options);if(_8e.id){_8e.id=_8e.id+"_"+i;}_90.layerDefinition.capabilities="Query,Data";_92=new _84(_90,_8e);if(_92.geometryType){this["_"+_92.geometryType]=_92;}this._fLayers.push(_92);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _93=new _82(this.pointSymbol);this._esriGeometryPoint.setRenderer(_93);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _94=new _82(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_94);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _95=new _82(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_95);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _96=map.spatialReference,_97=this._outSR,_98;if(_96.wkid){_98=(_96._isWebMercator()&&_97._isWebMercator())||(_96.wkid===_97.wkid);}else{if(_96.wkt){_98=(_96.wkt===_97.wkt);}else{console.log("_setMap - map has invalid spatial reference");return;}}if(!_98){if(_96._isWebMercator()&&_97.wkid===4326){this._converter=_81.geographicToWebMercator;}else{if(_97._isWebMercator()&&_96.wkid===4326){this._converter=_81.webMercatorToGeographic;}else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return;}}}var _99=this._fLayers;if(_99&&_99.length>0){_7b.forEach(_99,function(_9a){if(this._converter){var _9b=_9a.graphics,i,_9c,len=_9b?_9b.length:0;for(i=0;i<len;i++){_9c=_9b[i].geometry;if(_9c){_9b[i].setGeometry(this._converter(_9c));}}}map.addLayer(_9a);},this);}this.setVisibility(this.visible);},_removeInternalLayers:function(){var map=this._map;if(map){_7b.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_9d){this._fireUpdateStart();_7b.forEach(this.getFeatureLayers(),function(_9e){_9e.setVisibility(_9d);});this._fireUpdateEnd();},_setMap:function(map,_9f){this.inherited(arguments);this._map=map;var div=this._div=_7c.create("div",null,_9f);_7d.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a0){if(this._io){this._io.cancel();}_79.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a0.removeChild(div);_7c.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_7a.setObject("layers._ServiceGeneratedFeatureCollection",_86,_7e);}return _86;});},"esri/layers/GeoRSSLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_a1,_a2,_a3,has,_a4,_a5,_a6,_a7){var _a8=_a1([_a7],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_a9){if(_a5.defaults.geoRSSService){this.serviceUrl=_a5.defaults.geoRSSService;}this._createLayer();this.registerConnectEvents("esri.layers.GeoRSSLayer",true);},parse:function(){this._io=_a6({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?true:undefined,outSR:this._outSR?_a3.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(_aa){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){_a2.setObject("layers.GeoRSSLayer",_a8,_a4);}return _a8;});},"esri/PopupInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/i18n","dojo/has","esri/kernel","esri/lang","dojo/i18n!dojo/cldr/nls/number"],function(_ab,_ac,_ad,_ae,_af,has,_b0,_b1){var _b2=_ab(null,{declaredClass:"esri.PopupInfo",initialize:function(_b3,_b4){if(!_b3){return;}_ac.mixin(this,_b4);this.info=_b3;this.title=this.getTitle;this.content=this.getContent;var _b5=(this._fieldLabels={}),_b6=(this._fieldsMap={});if(_b3.fieldInfos){_ad.forEach(_b3.fieldInfos,function(_b7){_b5[_b7.fieldName]=_b7.label;_b6[_b7.fieldName]=_b7;});}},toJson:function(){return _ae.fromJson(_ae.toJson(this.info));},getTitle:function(){},getContent:function(){},getComponents:function(_b8){var _b9=this.info,_ba=_b8.getLayer(),_bb=_ac.clone(_b8.attributes)||{},_bc=_ac.clone(_bb),_bd=_b9.fieldInfos,_be="",_bf="",_c0,_c1,_c2,_c3=_ba&&_ba._getDateOpts&&_ba._getDateOpts().properties,_c4={dateFormat:{properties:_c3,formatter:"DateFormat"+this._insertOffset(this._dateFormats["shortDateShortTime"])}};if(_bd){_ad.forEach(_bd,function(_c5){var _c6=_c5.fieldName,val=_bc[_c6];_bc[_c6]=this._formatValue(val,_c6,_c4);if(_c3&&_c5.format&&_c5.format.dateFormat){var pos=_ad.indexOf(_c3,_c6);if(pos>-1){_c3.splice(pos,1);}}},this);}if(_ba){var _c7=_ba.types,_c8=_ba.typeIdField,_c9=_c8&&_bb[_c8];for(_c1 in _bb){_c2=_bb[_c1];if(_b1.isDefined(_c2)){var _ca=this._getDomainName(_ba,_c7,_c9,_c1,_c2);if(_b1.isDefined(_ca)){_bc[_c1]=_ca;}else{if(_c1===_c8){var _cb=this._getTypeName(_ba,_c2);if(_b1.isDefined(_cb)){_bc[_c1]=_cb;}}}}}}if(_b9.title){_be=_ac.trim(_b1.substitute(_bc,this._fixTokens(_b9.title),_c4)||"");}if(_b9.description){_bf=_ac.trim(_b1.substitute(_bc,this._fixTokens(_b9.description),_c4)||"");}if(_bd){_c0=[];_ad.forEach(_bd,function(_cc){_c1=_cc.fieldName;if(_c1&&_cc.visible){_c0.push([_cc.label||_c1,_b1.substitute(_bc,"${"+_c1+"}",_c4)||""]);}});}var _cd,_ce;if(_b9.mediaInfos){_cd=[];_ad.forEach(_b9.mediaInfos,function(_cf){_ce=0;_c2=_cf.value;switch(_cf.type){case "image":var url=_c2.sourceURL;url=url&&_ac.trim(_b1.substitute(_bb,this._fixTokens(url)));_ce=!!url;break;case "piechart":case "linechart":case "columnchart":case "barchart":_ce=_ad.some(_c2.fields,function(_d0){return _b1.isDefined(_bb[_d0]);});break;default:return;}if(_ce){_cf=_ac.clone(_cf);_c2=_cf.value;_cf.title=_cf.title?_ac.trim(_b1.substitute(_bc,this._fixTokens(_cf.title),_c4)||""):"";_cf.caption=_cf.caption?_ac.trim(_b1.substitute(_bc,this._fixTokens(_cf.caption),_c4)||""):"";if(_cf.type==="image"){_c2.sourceURL=_b1.substitute(_bb,this._fixTokens(_c2.sourceURL));if(_c2.linkURL){_c2.linkURL=_ac.trim(_b1.substitute(_bb,this._fixTokens(_c2.linkURL))||"");}}else{var _d1=_bb[_c2.normalizeField]||0;_c2.fields=_ad.map(_c2.fields,function(_d2){var _d3=_bb[_d2];_d3=(_d3===undefined)?null:_d3;if(_d3&&_d1){_d3=_d3/_d1;}return {y:_d3,tooltip:(this._fieldLabels[_d2]||_d2)+":<br/>"+this._formatValue(_d3,_d2,_c4,!!_d1)};},this);}_cd.push(_cf);}},this);}return {title:_be,description:_bf,fields:(_c0&&_c0.length)?_c0:null,mediaInfos:(_cd&&_cd.length)?_cd:null,formatted:_bc,editSummary:(_ba&&_ba.getEditSummary)?_ba.getEditSummary(_b8):""};},getAttachments:function(_d4){var _d5=_d4.getLayer(),_d6=_d4.attributes;if(this.info.showAttachments&&_d5&&_d5.hasAttachments&&_d5.objectIdField){var oid=_d6&&_d6[_d5.objectIdField];if(oid){return _d5.queryAttachmentInfos(oid);}}},_dateFormats:{"shortDate":"(datePattern: 'M/d/y', selector: 'date')","longMonthDayYear":"(datePattern: 'MMMM d, y', selector: 'date')","dayShortMonthYear":"(datePattern: 'd MMM y', selector: 'date')","longDate":"(datePattern: 'EEEE, MMMM d, y', selector: 'date')","shortDateShortTime":"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')","shortDateShortTime24":"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')","shortDateLongTime":"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')","shortDateLongTime24":"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')","longMonthYear":"(datePattern: 'MMMM y', selector: 'date')","shortMonthYear":"(datePattern: 'MMM y', selector: 'date')","year":"(datePattern: 'y', selector: 'date')"},_fixTokens:function(_d7){return _d7.replace(/(\{[^\{\r\n]+\})/g,"$$$1");},_formatValue:function(val,_d8,_d9,_da){var _db=this._fieldsMap[_d8],fmt=_db&&_db.format;if(!_b1.isDefined(val)||!_db||!_b1.isDefined(fmt)){return val;}var _dc="",_dd=[],_de=fmt.hasOwnProperty("places")||fmt.hasOwnProperty("digitSeparator"),_df=fmt.hasOwnProperty("digitSeparator")?fmt.digitSeparator:true;if(_de){_dc="NumberFormat";_dd.push("places: "+((_b1.isDefined(fmt.places)&&(!_da||fmt.places>0))?Number(fmt.places):"Infinity"));if(_dd.length){_dc+=("("+_dd.join(",")+")");}}else{if(fmt.dateFormat){_dc="DateFormat"+this._insertOffset(this._dateFormats[fmt.dateFormat]||this._dateFormats["shortDateShortTime"]);}else{return val;}}var _e0=_b1.substitute({"myKey":val},"${myKey:"+_dc+"}",_d9)||"";if(_de&&!_df){var _e1=_af.getLocalization("dojo.cldr","number");if(_e1.group){_e0=_e0.replace(new RegExp("\\"+_e1.group,"g"),"");}}return _e0;},_insertOffset:function(_e2){if(_e2){_e2=_b1.isDefined(this.utcOffset)?_e2.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):_e2;}return _e2;},_getDomainName:function(_e3,_e4,_e5,_e6,_e7){var _e8,_e9;if(_e4&&_b1.isDefined(_e5)){_ad.some(_e4,function(_ea){if(_ea.id==_e5){_e8=_ea.domains&&_ea.domains[_e6];if(_e8&&_e8.type==="inherited"){_e8=this._getLayerDomain(_e3,_e6);_e9=true;}return true;}return false;},this);}if(!_e9&&!_e8){_e8=this._getLayerDomain(_e3,_e6);}if(_e8&&_e8.codedValues){var _eb;_ad.some(_e8.codedValues,function(_ec){if(_ec.code==_e7){_eb=_ec.name;return true;}return false;});return _eb;}},_getLayerDomain:function(_ed,_ee){var _ef=_ed.fields;if(_ef){var _f0;_ad.some(_ef,function(_f1){if(_f1.name===_ee){_f0=_f1.domain;return true;}return false;});return _f0;}},_getTypeName:function(_f2,id){var _f3=_f2.types;if(_f3){var _f4;_ad.some(_f3,function(_f5){if(_f5.id==id){_f4=_f5.name;return true;}return false;});return _f4;}}});if(has("extend-esri")){_b0.PopupInfo=_b0.PopupInfoTemplate=_b2;}return _b2;});},"esri/layers/KMLLayer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_f6,_f7,_f8,_f9,_fa,_fb,has,ioq,_fc,_fd,_fe,_ff,_100,_101,_102,_103,_104,_105,_106,_107,_108,_109){var _10a=_f7([_105],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_10b){if(!url){console.log("KMLLayer:constructor - please provide url for the KML file");}this._outSR=(_10b&&_10b.outSR)||new _102({wkid:4326});this._options=_10b;if(_ff.defaults.kmlService){this.serviceUrl=_ff.defaults.kmlService;}var link=(this.linkInfo=_10b&&_10b.linkInfo);if(link){this.visible=!!link.visibility;this._waitingForMap=!!link.viewFormat;}if(!link||(link&&link.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_f9.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",true);},getFeature:function(_10c){if(!_10c){return;}var type=_10c.type,id=_10c.id,_10d,i,len;switch(type){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _10e=this["_"+type];if(_10e){_10d=_f9.getObject("_mode._featureMap."+id,false,_10e);}break;case "GroundOverlay":var _10f=this._groundLyr;if(_10f){var _110=_10f.getImages();len=_110.length;for(i=0;i<len;i++){if(_110[i].id===id){_10d=_110[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_fa.some(this._links,function(link){if(link.linkInfo&&link.linkInfo.id===id){_10d=link;return true;}else{return false;}});break;case "Folder":var _111=this.folders;len=_111?_111.length:0;for(i=0;i<len;i++){if(_111[i].id===id){_10d=_111[i];break;}}break;default:console.log("KMLLayer:getFeature - unknown feature type");break;}return _10d;},getLayers:function(){var _112=[];if(this._groundLyr){_112.push(this._groundLyr);}if(this._fLayers){_112=_112.concat(this._fLayers);}if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass){_112.push(link);}});}return _112;},setFolderVisibility:function(_113,_114){if(!_113){return;}this._fireUpdateStart();_113.visible=_114;if(_114){_114=this._areLocalAncestorsVisible(_113);}this._setState(_113,_114);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var self=this;this._fireUpdateStart();this._io=_101({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_fb.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_115){self._io=null;self._initLayer(_115);},error:function(err){self._io=null;err=_f9.mixin(new Error(),err);err.message="Unable to load KML: "+self.url+" "+(err.message||"");self._fireUpdateEnd(err);self.onError(err);}});},_initLayer:function(json){if(this.loaded){this._removeInternalLayers();}this.name=json.name;this.description=json.description;this.snippet=json.snippet;this.visibility=json.visibility;this.featureInfos=json.featureInfos;var i,len;var _116=(this.folders=json.folders),_117=[],fldr;if(_116){len=_116.length;for(i=0;i<len;i++){fldr=(_116[i]=new _106(_116[i]));if(fldr.parentFolderId===-1){_117.push(fldr);}}}var _118=(this._links=json.networkLinks),_119;len=_118?_118.length:0;for(i=0;i<len;i++){if(_118[i].viewRefreshMode&&_118[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_119=_f9.mixin({},this._options);_119.linkInfo=_118[i];if(_119.id){_119.id=_119.id+"_"+i;}_118[i]=new _10a(_118[i].href,_119);_118[i]._parentLayer=this;_118[i]._parentFolderId=this._getLinkParentId(_118[i].linkInfo.id);}var _11a=json.groundOverlays;if(_11a&&_11a.length>0){_119=_f9.mixin({},this._options);if(_119.id){_119.id=_119.id+"_"+"mapImage";}var _11b=(this._groundLyr=new _108(_119));len=_11a.length;for(i=0;i<len;i++){_11b.addImage(new _107(_11a[i]));}}var _11c=_f9.getObject("featureCollection.layers",false,json);if(_11c&&_11c.length>0){this._fLayers=[];_fa.forEach(_11c,function(_11d,i){var _11e=_f9.getObject("featureSet.features",false,_11d),_11f;if(_11e&&_11e.length>0){_119=_f9.mixin({outFields:["*"],infoTemplate:_11d.popupInfo?new _104(_11d.popupInfo):null,editable:false},this._options);if(_119.id){_119.id=_119.id+"_"+i;}_11d.layerDefinition.capabilities="Query,Data";_11f=new _109(_11d,_119);if(_11f.geometryType){this["_"+_11f.geometryType]=_11f;}this._fLayers.push(_11f);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_117.length;for(i=0;i<len;i++){fldr=_117[i];this._setState(fldr,fldr.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass){map.addLayer(link);if(link._waitingForMap){link._waitingForMap=null;if(link.visible){link._parseKml(map);}else{link._wMap=map;}}}});}var _120=map.spatialReference,_121=this._outSR,_122;if(!_120.equals(_121)){if(_120.isWebMercator()&&_121.wkid===4326){_122=_103.geographicToWebMercator;}else{if(_121.isWebMercator()&&_120.wkid===4326){_122=_103.webMercatorToGeographic;}else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return;}}}if(this._groundLyr){if(_122){_fa.forEach(this._groundLyr.getImages(),function(_123){_123.extent=_122(_123.extent);});}map.addLayer(this._groundLyr);}var _124=this._fLayers;if(_124&&_124.length>0){_fa.forEach(_124,function(_125){if(_122){var _126=_125.graphics,i,geom,len=_126?_126.length:0;for(i=0;i<len;i++){geom=_126[i].geometry;if(geom){_126[i].setGeometry(_122(geom));}}}map.addLayer(_125);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_fa.forEach(this._links,function(link){if(link.declaredClass&&link._io){link._io.cancel();}});}if(map){_fa.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_127,_128){var _129=_127.featureInfos,info,_12a,i,len=_129?_129.length:0,_12b=_128?"show":"hide";for(i=0;i<len;i++){info=_129[i];_12a=this.getFeature(info);if(!_12a){continue;}if(info.type==="Folder"){this._setState(_12a,_128&&_12a.visible);}else{if(info.type==="NetworkLink"){this._setInternalVisibility(_12a,_128);}else{_12a[_12b]();}}}},_areLocalAncestorsVisible:function(_12c){var _12d=_12c.parentFolderId,_12e=_12c.visible;while(_12e&&_12d!==-1){var _12f=this.getFeature({type:"Folder",id:_12d});_12e=_12e&&_12f.visible;_12d=_12f.parentFolderId;}return _12e;},_setInternalVisibility:function(_130,_131){var _132=_130._parentLayer,_133=_130._parentFolderId;_131=_131&&_130.visible;while(_131&&_132){_131=_131&&_132.visible;if(_133>-1){_131=_131&&_132._areLocalAncestorsVisible(_132.getFeature({type:"Folder",id:_133}));}_133=_132._parentFolderId;_132=_132._parentLayer;}this._setIntState(_130,_131);},_setIntState:function(link,_134){if(!link){return;}_fa.forEach(link.getLayers(),function(_135){if(_135.linkInfo){link._setIntState(_135,_134&&_135.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_135._parentFolderId})));}else{_135.setVisibility(_134);}});},_getLinkParentId:function(id){var _136=-1;if(this.folders){_fa.some(this.folders,function(_137){if(_137.networkLinkIds&&_fa.indexOf(_137.networkLinkIds,id)!==-1){_136=_137.id;return true;}return false;});}return _136;},_checkAutoRefresh:function(){var _138=this.linkInfo;if(_138){if(this.visible){if(this.loaded&&this._map){var _139=_138.refreshMode,_13a=_138.refreshInterval,_13b=_138.viewRefreshMode,_13c=_138.viewRefreshTime;if(_139&&_139.toLowerCase().indexOf("oninterval")!==-1&&_13a>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_13a*1000);}if(_13b&&_13b.toLowerCase().indexOf("onstop")!==-1&&_13c>0){if(!this._extChgHandle){this._extChgHandle=_f8.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_f8.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _13d={},_13e=this.linkInfo,_13f=map&&map.extent,_140;if(this._url.query){_f9.mixin(_13d,this._url.query);_140=!!this._url.query.token;}if(_fe.id&&!_140){var _141=_fe.id.findCredential(this._url.path);if(_141){_13d.token=_141.token;}}if(_13e){var _142=_13e.viewFormat,_143=_13e.httpQuery,_144=_13e.viewBoundScale;if(_13f&&_142){var _145=_13f,_146=_13f,sr=_13f.spatialReference;if(sr){if(sr.isWebMercator()){_145=_103.webMercatorToGeographic(_13f);}else{if(sr.wkid===4326){_146=_103.geographicToWebMercator(_13f);}}}var _147=_145.getCenter(),_148=Math.max(_146.getWidth(),_146.getHeight());if(_144){_145=_145.expand(_144);}_142=_142.replace(/\[bboxWest\]/ig,_145.xmin).replace(/\[bboxEast\]/ig,_145.xmax).replace(/\[bboxSouth\]/ig,_145.ymin).replace(/\[bboxNorth\]/ig,_145.ymax).replace(/\[lookatLon\]/ig,_147.x).replace(/\[lookatLat\]/ig,_147.y).replace(/\[lookatRange\]/ig,_148).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_147.x).replace(/\[lookatTerrainLat\]/ig,_147.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_147.x).replace(/\[cameraLat\]/ig,_147.y).replace(/\[cameraAlt\]/ig,_148).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_f9.mixin(_13d,ioq.queryToObject(_142));}if(_143){_143=_143.replace(/\[clientVersion\]/ig,_fe.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_f6.locale);_f9.mixin(_13d,ioq.queryToObject(_143));}}var _149=[],_14a;for(_14a in _13d){if(_100.isDefined(_13d[_14a])){_149.push(_14a+"="+_13d[_14a]);}}_149=_149.join("&");return _149?("?"+_149):"";},_setMap:function(map,_14b){this._map=map;var div=this._div=_fc.create("div",null,_14b);_fd.set(div,"position","absolute");this._addInternalLayers();return div;},_unsetMap:function(map,_14c){if(this._io){this._io.cancel();}this._stopAutoRefresh();_f8.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_14c.removeChild(div);_fc.destroy(div);}this._map=this._wMap=this._div=null;},onVisibilityChange:function(_14d){if(!this.loaded){if(this.linkInfo&&_14d){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_14d);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_f9.setObject("layers.KMLLayer",_10a,_fe);}return _10a;});},"dojo/hccss":function(){define(["require","./_base/config","./dom-class","./dom-style","./has","./ready","./_base/window"],function(_14e,_14f,_150,_151,has,_152,win){has.add("highcontrast",function(){var div=win.doc.createElement("div");div.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;"+"background-image: url("+(_14f.blankGif||_14e.toUrl("./resources/blank.gif"))+");";win.body().appendChild(div);var cs=_151.getComputedStyle(div),_153=cs.backgroundImage,hc=(cs.borderTopColor==cs.borderRightColor)||(_153&&(_153=="none"||_153=="url(invalid-url:)"));if(has("ie")<=8){div.outerHTML="";}else{win.body().removeChild(div);}return hc;});_152(90,function(){if(has("highcontrast")){_150.add(win.body(),"dj_a11y");}});return has;});},"dijit/_WidgetBase":function(){define("dijit/_WidgetBase",["require","dojo/_base/array","dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/ready","dojo/Stateful","dojo/topic","dojo/_base/window","./Destroyable","./registry"],function(_154,_155,_156,_157,_158,_159,dom,_15a,_15b,_15c,_15d,_15e,has,_15f,lang,on,_160,_161,_162,win,_163,_164){has.add("dijit-legacy-requires",!_15f.isAsync);if(has("dijit-legacy-requires")){_160(0,function(){var _165=["dijit/_base/manager"];_154(_165);});}var _166={};function _167(obj){var ret={};for(var attr in obj){ret[attr.toLowerCase()]=true;}return ret;};function _168(attr){return function(val){_15a[val?"set":"remove"](this.domNode,attr,val);this._set(attr,val);};};return _159("dijit._WidgetBase",[_161,_163],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:_168("lang"),dir:"",_setDirAttr:_168("dir"),textDir:"","class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(val){this._set("ownerDocument",val);},attributeMap:{},_blankGif:_157.blankGif||_154.toUrl("dojo/resources/blank.gif"),postscript:function(_169,_16a){this.create(_169,_16a);},create:function(_16b,_16c){this.srcNodeRef=dom.byId(_16c);this._connects=[];this._supportingWidgets=[];if(this.srcNodeRef&&(typeof this.srcNodeRef.id=="string")){this.id=this.srcNodeRef.id;}if(_16b){this.params=_16b;lang.mixin(this,_16b);}this.postMixInProperties();if(!this.id){this.id=_164.getUniqueId(this.declaredClass.replace(/\./g,"_"));if(this.params){delete this.params.id;}}this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:win.doc);this.ownerDocumentBody=win.body(this.ownerDocument);_164.add(this);this.buildRendering();var _16d;if(this.domNode){this._applyAttributes();var _16e=this.srcNodeRef;if(_16e&&_16e.parentNode&&this.domNode!==_16e){_16e.parentNode.replaceChild(this.domNode,_16e);_16d=true;}this.domNode.setAttribute("widgetId",this.id);}this.postCreate();if(_16d){delete this.srcNodeRef;}this._created=true;},_applyAttributes:function(){var ctor=this.constructor,list=ctor._setterAttrs;if(!list){list=(ctor._setterAttrs=[]);for(var attr in this.attributeMap){list.push(attr);}var _16f=ctor.prototype;for(var _170 in _16f){if(_170 in this.attributeMap){continue;}var _171="_set"+_170.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();})+"Attr";if(_171 in _16f){list.push(_170);}}}var _172={};for(var key in this.params||{}){_172[key]=this[key];}_155.forEach(list,function(attr){if(attr in _172){}else{if(this[attr]){this.set(attr,this[attr]);}}},this);for(key in _172){this.set(key,_172[key]);}},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div");}if(this.baseClass){var _173=this.baseClass.split(" ");if(!this.isLeftToRight()){_173=_173.concat(_155.map(_173,function(name){return name+"Rtl";}));}_15b.add(this.domNode,_173);}},postCreate:function(){},startup:function(){if(this._started){return;}this._started=true;_155.forEach(this.getChildren(),function(obj){if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){obj.startup();obj._started=true;}});},destroyRecursive:function(_174){this._beingDestroyed=true;this.destroyDescendants(_174);this.destroy(_174);},destroy:function(_175){this._beingDestroyed=true;this.uninitialize();function _176(w){if(w.destroyRecursive){w.destroyRecursive(_175);}else{if(w.destroy){w.destroy(_175);}}};_155.forEach(this._connects,lang.hitch(this,"disconnect"));_155.forEach(this._supportingWidgets,_176);if(this.domNode){_155.forEach(_164.findWidgets(this.domNode,this.containerNode),_176);}this.destroyRendering(_175);_164.remove(this.id);this._destroyed=true;},destroyRendering:function(_177){if(this.bgIframe){this.bgIframe.destroy(_177);delete this.bgIframe;}if(this.domNode){if(_177){_15a.remove(this.domNode,"widgetId");}else{_15c.destroy(this.domNode);}delete this.domNode;}if(this.srcNodeRef){if(!_177){_15c.destroy(this.srcNodeRef);}delete this.srcNodeRef;}},destroyDescendants:function(_178){_155.forEach(this.getChildren(),function(_179){if(_179.destroyRecursive){_179.destroyRecursive(_178);}});},uninitialize:function(){return false;},_setStyleAttr:function(_17a){var _17b=this.domNode;if(lang.isObject(_17a)){_15e.set(_17b,_17a);}else{if(_17b.style.cssText){_17b.style.cssText+="; "+_17a;}else{_17b.style.cssText=_17a;}}this._set("style",_17a);},_attrToDom:function(attr,_17c,_17d){_17d=arguments.length>=3?_17d:this.attributeMap[attr];_155.forEach(lang.isArray(_17d)?_17d:[_17d],function(_17e){var _17f=this[_17e.node||_17e||"domNode"];var type=_17e.type||"attribute";switch(type){case "attribute":if(lang.isFunction(_17c)){_17c=lang.hitch(this,_17c);}var _180=_17e.attribute?_17e.attribute:(/^on[A-Z][a-zA-Z]*$/.test(attr)?attr.toLowerCase():attr);if(_17f.tagName){_15a.set(_17f,_180,_17c);}else{_17f.set(_180,_17c);}break;case "innerText":_17f.innerHTML="";_17f.appendChild(this.ownerDocument.createTextNode(_17c));break;case "innerHTML":_17f.innerHTML=_17c;break;case "class":_15b.replace(_17f,_17c,this[attr]);break;}},this);},get:function(name){var _181=this._getAttrNames(name);return this[_181.g]?this[_181.g]():this[name];},set:function(name,_182){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _183=this._getAttrNames(name),_184=this[_183.s];if(lang.isFunction(_184)){var _185=_184.apply(this,Array.prototype.slice.call(arguments,1));}else{var _186=this.focusNode&&!lang.isFunction(this.focusNode)?"focusNode":"domNode",_187,map,tag;tag=this[_186]&&this[_186].tagName;if(tag){_187=_166[tag]||(_166[tag]=_167(this[_186]));}map=name in this.attributeMap?this.attributeMap[name]:_183.s in this?this[_183.s]:((_187&&_183.l in _187&&typeof _182!="function")||/^aria-|^data-|^role$/.test(name))?_186:null;if(map!=null){this._attrToDom(name,_182,map);}this._set(name,_182);}return _185||this;},_attrPairNames:{},_getAttrNames:function(name){var apn=this._attrPairNames;if(apn[name]){return apn[name];}var uc=name.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();});return (apn[name]={n:name+"Node",s:"_set"+uc+"Attr",g:"_get"+uc+"Attr",l:uc.toLowerCase()});},_set:function(name,_188){var _189=this[name];this[name]=_188;if(this._created&&_188!==_189){if(this._watchCallbacks){this._watchCallbacks(name,_189,_188);}this.emit("attrmodified-"+name,{detail:{prevValue:_189,newValue:_188}});}},emit:function(type,_18a,_18b){_18a=_18a||{};if(_18a.bubbles===undefined){_18a.bubbles=true;}if(_18a.cancelable===undefined){_18a.cancelable=true;}if(!_18a.detail){_18a.detail={};}_18a.detail.widget=this;var ret,_18c=this["on"+type];if(_18c){ret=_18c.apply(this,_18b?_18b:[_18a]);}if(this._started&&!this._beingDestroyed){on.emit(this.domNode,type.toLowerCase(),_18a);}return ret;},on:function(type,func){var _18d=this._onMap(type);if(_18d){return _156.after(this,_18d,func,true);}return this.own(on(this.domNode,type,func))[0];},_onMap:function(type){var ctor=this.constructor,map=ctor._onMap;if(!map){map=(ctor._onMap={});for(var attr in ctor.prototype){if(/^on/.test(attr)){map[attr.replace(/^on/,"").toLowerCase()]=attr;}}}return map[typeof type=="string"&&type.toLowerCase()];},toString:function(){return "[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]";},getChildren:function(){return this.containerNode?_164.findWidgets(this.containerNode):[];},getParent:function(){return _164.getEnclosingWidget(this.domNode.parentNode);},connect:function(obj,_18e,_18f){return this.own(_158.connect(obj,_18e,this,_18f))[0];},disconnect:function(_190){_190.remove();},subscribe:function(t,_191){return this.own(_162.subscribe(t,lang.hitch(this,_191)))[0];},unsubscribe:function(_192){_192.remove();},isLeftToRight:function(){return this.dir?(this.dir=="ltr"):_15d.isBodyLtr(this.ownerDocument);},isFocusable:function(){return this.focus&&(_15e.get(this.domNode,"display")!="none");},placeAt:function(_193,_194){var _195=!_193.tagName&&_164.byId(_193);if(_195&&_195.addChild&&(!_194||typeof _194==="number")){_195.addChild(this,_194);}else{var ref=_195?(_195.containerNode&&!/after|before|replace/.test(_194||"")?_195.containerNode:_195.domNode):dom.byId(_193,this.ownerDocument);_15c.place(this.domNode,ref,_194);if(!this._started&&(this.getParent()||{})._started){this.startup();}}return this;},getTextDir:function(text,_196){return _196;},applyTextDir:function(){},defer:function(fcn,_197){var _198=setTimeout(lang.hitch(this,function(){_198=null;if(!this._destroyed){lang.hitch(this,fcn)();}}),_197||0);return {remove:function(){if(_198){clearTimeout(_198);_198=null;}return null;}};}});});},"esri/layers/FeatureLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_199,_19a,lang,_19b,_19c,_19d,_19e,has,ioq,_19f,i18n,_1a0,_1a1,_1a2,_1a3,_1a4,_1a5,_1a6,_1a7,_1a8,_1a9,_1aa,_1ab,_1ac,_1ad,_1ae,_1af,_1b0,_1b1,_1b2,_1b3,_1b4,_1b5,_1b6,_1b7,_1b8,_1b9,_1ba,_1bb){var _1bc=_199(_1b2,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",constructor:function(url,_1bd){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_1bd&&_1bd.outFields;this._loadCallback=_1bd&&_1bd.loadCallback;var _1be=_1bd&&_1bd._usePatch;this._usePatch=(_1be===null||_1be===undefined)?true:_1be;this._trackIdField=_1bd&&_1bd.trackIdField;this.objectIdField=_1bd&&_1bd.objectIdField;this._maxOffset=_1bd&&_1bd.maxAllowableOffset;this._optEditable=_1bd&&_1bd.editable;this._optAutoGen=_1bd&&_1bd.autoGeneralize;this.editSummaryCallback=_1bd&&_1bd.editSummaryCallback;this.userId=_1bd&&_1bd.userId;this.userIsAdmin=_1bd&&_1bd.userIsAdmin;this.useMapTime=(_1bd&&_1bd.hasOwnProperty("useMapTime"))?(!!_1bd.useMapTime):true;this.source=_1bd&&_1bd.source;this.gdbVersion=_1bd&&_1bd.gdbVersion;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_1a1.isDefined(_1bd&&_1bd.mode)?_1bd.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _1b8(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_1bd&&_1bd.tileWidth)||512;this._tileHeight=(_1bd&&_1bd.tileHeight)||512;this._mode=new _1b9(this);var _1bf=_1bd&&_1bd.latticeTiling;this.latticeTiling=_1bf;break;case ctor.MODE_SELECTION:this._mode=new _1ba(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _1ac(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _1c0=this._url.path;this._fserver=false;if(_1c0.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _1c1=_1bd&&_1bd.resourceInfo;if(_1c1){this._initLayer(_1c1);}else{if(this.source){var _1c2={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_19c.toJson(_1c2)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_1a2({url:_1c0,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents("esri.layers.FeatureLayer",{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]});},_initLayer:function(_1c3,io){if(_1c3||io){this._json=_1c3;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1c3&&_1c3._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _1b8(this);this._isSnapshot=true;this._featureSet=_1c3.featureSet;this._nextId=_1c3.nextObjectId;_1c3=_1c3.layerDefinition;}if(_1c3.hasOwnProperty("capabilities")){var _1c4=(this.capabilities=_1c3.capabilities);if(_1c4&&_1c4.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_1a1.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_19c.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1c3.geometryType==="esriGeometryPolyline")||(_1c3.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_1a1.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _1c5=_1c3.effectiveMinScale||_1c3.minScale,_1c6=_1c3.effectiveMaxScale||_1c3.maxScale;if(!this._hasMin&&_1c5){this.setMinScale(_1c5);}if(!this._hasMax&&_1c6){this.setMaxScale(_1c6);}this.layerId=_1c3.id;this.name=_1c3.name;this.description=_1c3.description;this.copyright=_1c3.copyrightText;this.type=_1c3.type;this.geometryType=_1c3.geometryType;this.displayField=_1c3.displayField;this.defaultDefinitionExpression=_1c3.definitionExpression;this.fullExtent=new _1af(_1c3.extent);this.initialExtent=new _1af(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _1a4(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1c3.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1c3.indexedFields;this.maxRecordCount=_1c3.maxRecordCount;this.canModifyLayer=_1c3.canModifyLayer;this.supportsStatistics=_1c3.supportsStatistics;this.supportsAdvancedQueries=_1c3.supportsAdvancedQueries;this.hasLabels=_1c3.hasLabels;this.canScaleSymbols=_1c3.canScaleSymbols;this.supportsRollbackOnFailure=_1c3.supportsRollbackOnFailure;this.syncCanReturnChanges=_1c3.syncCanReturnChanges;this.isDataVersioned=_1c3.isDataVersioned;this.editFieldsInfo=_1c3.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1c3.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1c3.relationships;this.allowGeometryUpdates=_1a1.isDefined(_1c3.allowGeometryUpdates)?_1c3.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _1c7=(this.fields=[]),_1c8=_1c3.fields,i;for(i=0;i<_1c8.length;i++){_1c7.push(new _1b3(_1c8[i]));}if(!this.objectIdField){this.objectIdField=_1c3.objectIdField;if(!this.objectIdField){_1c8=_1c3.fields;for(i=0;i<_1c8.length;i++){var _1c9=_1c8[i];if(_1c9.type==="esriFieldTypeOID"){this.objectIdField=_1c9.name;break;}}}if(!this.objectIdField){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url},"objectIdField is not set [url: ${url}]"));}}if(!_1a1.isDefined(this._nextId)){var _1ca=this.objectIdField,_1cb=-1;if(this._collection&&_1ca){var fset=this._featureSet,_1cc=fset&&fset.features,il=_1cc?_1cc.length:0,oid,attr;for(i=0;i<il;i++){attr=_1cc[i].attributes;oid=attr&&attr[_1ca];if(oid>_1cb){_1cb=oid;}}}this._nextId=(_1cb+1);}this.globalIdField=_1c3.globalIdField;var _1cd=(this.typeIdField=_1c3.typeIdField),_1ce;if(_1cd){_1ce=!this._getField(_1cd)&&this._getField(_1cd,true);if(_1ce){this.typeIdField=_1ce.name;}}this.visibilityField=_1c3.visibilityField;var _1cf=_1c3.defaultSymbol;if(_1cf){this.defaultSymbol=_1a8.fromJson(_1cf);}var _1d0=this.types=[],_1d1=_1c3.types,_1d2,_1d3,_1d4,_1d5=this.editFieldsInfo,_1d6=_1d5&&_1d5.creatorField,_1d7=_1d5&&_1d5.editorField,fix=(_1d6||_1d7),_1d8=[];if(_1d1){for(i=0;i<_1d1.length;i++){_1d2=new _1b5(_1d1[i]);_1d3=_1d2.templates;if(fix&&_1d3&&_1d3.length){_1d8=_1d8.concat(_1d3);}_1d0.push(_1d2);}}var _1d9=_1c3.templates,_1da,_1db=this.templates=[];if(_1d9){for(i=0;i<_1d9.length;i++){_1da=new _1b6(_1d9[i]);if(fix){_1d8.push(_1da);}_1db.push(_1da);}}for(i=0;i<_1d8.length;i++){_1d4=lang.getObject("prototype.attributes",false,_1d8[i]);if(_1d4){if(_1d6){delete _1d4[_1d6];}if(_1d7){delete _1d4[_1d7];}}}var _1dc=_1c3.timeInfo;if(_1dc){this.timeInfo=new _1b4(_1dc);this._startTimeField=_1dc.startTimeField;this._endTimeField=_1dc.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_1dc.trackIdField=this._trackIdField;}else{this._trackIdField=_1dc.trackIdField;}}this.hasAttachments=(!this._collection&&_1c3.hasAttachments)?true:false;this.htmlPopupType=_1c3.htmlPopupType;var _1dd=_1c3.drawingInfo,_1de;if(!this.renderer){if(_1dd&&_1dd.renderer){_1de=_1dd.renderer;this.setRenderer(_1ab.fromJson(_1de));if(_1de.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _1df=_1de.type,_1e0=[];_1de=this.renderer;switch(_1df){case "simple":_1e0.push(_1de.symbol);break;case "uniqueValue":case "classBreaks":_1e0.push(_1de.defaultSymbol);_1e0=_1e0.concat(_19b.map(_1de.infos,function(info){return info.symbol;}));break;}_1e0=_19b.filter(_1e0,_1a1.isDefined);var _1e1=this._url.path+"/images/",_1e2=this._getToken();_19b.forEach(_1e0,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_1e1+url;}if(_1e2&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_1e2);}}});}}else{if(_1cf){_1d1=this.types;if(_1d1.length>0){_1de=new _1aa(this.defaultSymbol,this.typeIdField);_19b.forEach(_1d1,function(type){_1de.addValue(type.id,type.symbol);});}else{_1de=new _1a9(this.defaultSymbol);}this.setRenderer(_1de);}else{if(!this._isTable){var _1e3;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_1e3=new _1a5();break;case "esriGeometryPolyline":_1e3=new _1a6();break;case "esriGeometryPolygon":_1e3=new _1a7();break;}this.setRenderer(_1e3?new _1a9(_1e3):null);}}}}var _1e4=(_1dd&&_1dd.transparency)||0;if(!_1a1.isDefined(this.opacity)&&_1e4>0){this.opacity=1-(_1e4/100);}this.version=_1c3.currentVersion;if(!this.version){var ver;if("capabilities" in _1c3||"drawingInfo" in _1c3||"hasAttachments" in _1c3||"htmlPopupType" in _1c3||"relationships" in _1c3||"timeInfo" in _1c3||"typeIdField" in _1c3||"types" in _1c3){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _1e5=function(){this.onLoad(this);var _1e6=this._loadCallback;if(_1e6){delete this._loadCallback;_1e6(this);}};if(this._collection){this._fireUpdateStart();var _1e7=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _1ae(_1e7));this._fcAdded=true;_1e5.call(this);}else{this._forceIdentity(_1e5);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _1e8=this.renderer;if(_1e8){this._ager=(_1e8.declaredClass.indexOf("TemporalRenderer")!==-1&&_1e8.observationAger&&_1e8.observationRenderer);var _1e9=_19b.filter([_1e8,_1e8.observationRenderer,_1e8.latestObservationRenderer,_1e8.trackRenderer],_1a1.isDefined);var _1ea=[];_19b.forEach(_1e9,function(rnd){if(!lang.isFunction(rnd.attributeField)){_1ea.push(rnd.attributeField);}_1ea.push(rnd.attributeField2);_1ea.push(rnd.attributeField3);},this);this._rendererFields=_19b.filter(_1ea,_1a1.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded&&this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this.loaded&&this._collection){this._typesDirty=true;}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode;if(mode){mode.initialize(map);}return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_19a.disconnect(this._zoomConnect);this._zoomConnect=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},getOutFields:function(){return _19b.filter(this._getOutFields(),function(_1eb){return (_1eb==="*"||!!this._getField(_1eb));},this);},setEditable:function(_1ec){if(!this._collection){console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service");return this;}if(!this.loaded){this._optEditable=_1ec;return this;}var _1ed=this._editable;this._editable=_1ec;this._updateCaps();if(_1ed!==_1ec){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_1ee){var _1ef={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _1ef;}var _1f0=_1ee&&_1ee.feature,_1f1=_1ee&&_1ee.userId,caps=_19b.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_1f2=_19b.indexOf(caps,"editing")>-1,_1f3=_1f2&&(_19b.indexOf(caps,"create")>-1),_1f4=_1f2&&(_19b.indexOf(caps,"update")>-1),_1f5=_1f2&&(_19b.indexOf(caps,"delete")>-1),_1f6=this.ownershipBasedAccessControlForFeatures,_1f7=this.editFieldsInfo,_1f8=_1f7&&_1f7.creatorField,_1f9=_1f7&&_1f7.realm,_1fa=_1f0&&_1f0.attributes,_1fb=(_1fa&&_1f8)?_1fa[_1f8]:undefined,_1fc,_1fd=!!this.userIsAdmin,_1fe=!_1f6||_1fd||!!(_1f6.allowOthersToUpdate||_1f6.allowUpdateToOthers),_1ff=!_1f6||_1fd||!!(_1f6.allowOthersToDelete||_1f6.allowDeleteToOthers);if(_1fd||(_1f2&&!(_1f3||_1f4||_1f5))){_1f3=_1f4=_1f5=true;}_1fc={"canCreate":_1f3,"canUpdate":_1f4,"canDelete":_1f5};if(_1fb===null){_1fc.canUpdate=_1f4&&_1fe;_1fc.canDelete=_1f5&&_1ff;}else{if(_1fb===""){return _1fc;}else{if(_1fb){_1f1=_1f1||this.getUserId();if(_1f1&&_1f9){_1f1=_1f1+"@"+_1f9;}if(_1f1.toLowerCase()===_1fb.toLowerCase()){return _1fc;}else{_1fc.canUpdate=_1f4&&_1fe;_1fc.canDelete=_1f5&&_1ff;}}}}return _1fc;},getUserId:function(){var _200;if(this.loaded){_200=(this.credential&&this.credential.userId)||this.userId||"";}return _200;},setUserIsAdmin:function(_201){this.userIsAdmin=_201;},setEditSummaryCallback:function(_202){this.editSummaryCallback=_202;},getEditSummary:function(_203,_204,_205){_205=_1a1.isDefined(_205)?_205:(new Date()).getTime();var _206="",info=this.getEditInfo(_203,_204,_205),_207=(_204&&_204.callback)||this.editSummaryCallback;if(_207){info=_207(_203,info)||"";}if(lang.isString(info)){_206=info;}else{if(info){var _208=info.action,_209=info.userId,_20a=info.timeValue,_20b=0;if(_208){_20b++;}if(_209){_20b++;}if(_1a1.isDefined(_20a)){_20b++;}if(_20b>1){_206=(_208==="edit"?"edit":"create")+(_209?"User":"")+(_1a1.isDefined(_20a)?info.displayPattern:"");}}_206=_206&&_1a1.substitute(info,this.i18n.layers.FeatureLayer[_206]);}return _206;},getEditInfo:function(_20c,_20d,_20e){if(!this.loaded){return;}_20e=_1a1.isDefined(_20e)?_20e:(new Date()).getTime();var _20f=(_20d&&_20d.action)||"last",_210=this.editFieldsInfo,_211=_210&&_210.creatorField,_212=_210&&_210.creationDateField,_213=_210&&_210.editorField,_214=_210&&_210.editDateField,_215=_210&&_210.realm,_216=_20c&&_20c.attributes,_217=(_216&&_211)?_216[_211]:undefined,_218=(_216&&_212)?_216[_212]:null,_219=(_216&&_213)?_216[_213]:undefined,_21a=(_216&&_214)?_216[_214]:null,_21b=this._getEditData(_217,_218,_20e),_21c=this._getEditData(_219,_21a,_20e),_21d;switch(_20f){case "creation":_21d=_21b;break;case "edit":_21d=_21c;break;case "last":_21d=_21c||_21b;break;}if(_21d){_21d.action=(_21d===_21c)?"edit":"creation";}return _21d;},_getEditData:function(_21e,_21f,_220){var data,_221,_222,_223=60000,_224=3600000,_225=2*_224,_226=24*_224,_227=7*_226;if(_1a1.isDefined(_21f)){_221=_220-_21f;if(_221<0){_222="Full";}else{if(_221<_223){_222="Seconds";}else{if(_221<(2*_223)){_222="Minute";}else{if(_221<_224){_222="Minutes";}else{if(_221<_225){_222="Hour";}else{if(_221<_226){_222="Hours";}else{if(_221<_227){_222="WeekDay";}else{_222="Full";}}}}}}}}if((_21e!==undefined)||_222){data=data||{};data.userId=_21e;if(_222){var _228=_19e.format,_229=new Date(_21f);data.minutes=Math.floor(_221/_223);data.hours=Math.floor(_221/_224);data.weekDay=_228(_229,{datePattern:"EEEE",selector:"date"});data.formattedDate=_228(_229,{selector:"date"});data.formattedTime=_228(_229,{selector:"time"});data.displayPattern=_222;data.timeValue=_21f;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_22a){if(!this.isEditable()){this._maxOffset=_22a;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_22b){if(!this.loaded){this._optAutoGen=_22b;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_22b;if(_22b){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_22c){if(!this._collection&&(_22c!==this.gdbVersion)&&(_22c||this.gdbVersion)){this.gdbVersion=_22c;this._task.gdbVersion=_22c;this._url.query=lang.mixin(this._url.query,{gdbVersion:_22c});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_22d){if(this._isSnapshot){this._timeDefn=_22d;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url);}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_22e,_22f){this._timeOffset=_22e;this._timeOffsetUnits=_22f;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_230,_231,_232,_233){_231=_231||this.constructor.SELECTION_NEW;var _234=this._getShallowClone(_230),map=this._map,_235,dfd=_1a3._fixDfd(new _19d(_1a3._dfdCanceller));_234.outFields=this.getOutFields();_234.returnGeometry=true;if(map){_234.outSpatialReference=new _1a4(map.spatialReference.toJson());}if(!this._applyQueryFilters(_234)){_235={features:[]};this._selectHandler(_235,_231,_232,_233,dfd);return dfd;}var _236=this._canDoClientSideQuery(_234);if(_236){_235={features:this._doQuery(_234,_236)};this._selectHandler(_235,_231,_232,_233,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_233,dfd,true);return dfd;}var self=this;if(this._ts){_234._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_234);temp.addCallbacks(function(_237){self._selectHandler(_237,_231,_232,_233,dfd);},function(err){self._resolve([err],null,_233,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _238=this._selectedFeatures,_239=[],item;for(item in _238){if(_238.hasOwnProperty(item)){_239.push(_238[item]);}}return _239;},clearSelection:function(_23a){var _23b=this._selectedFeatures,mode=this._mode,item;for(item in _23b){if(_23b.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_23a){this.onSelectionClear();}return this;},setSelectionSymbol:function(_23c){this._selectionSymbol=_23c;if(_23c){var _23d=this._selectedFeatures,item;for(item in _23d){if(_23d.hasOwnProperty(item)){_23d[item].setSymbol(_23c);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_23e,_23f,_240,_241,_242){var _243=_242.assembly,dfd=_242.dfd;this._applyNormalized(adds,_243&&_243[0]);this._applyNormalized(_23e,_243&&_243[1]);this.onBeforeApplyEdits(adds,_23e,_23f);var i,_244={},_245=this.objectIdField,_246={f:"json"},_247=false;if(this._collection){var _248={};_248.addResults=adds?_19b.map(adds,function(){_247=true;return {objectId:this._nextId++,success:true};},this):null;_248.updateResults=_23e?_19b.map(_23e,function(_249){_247=true;var oid=_249.attributes[_245];_244[oid]=_249;return {objectId:oid,success:true};},this):null;_248.deleteResults=_23f?_19b.map(_23f,function(_24a){_247=true;return {objectId:_24a.attributes[_245],success:true};},this):null;if(_247){this._editHandler(_248,adds,_244,_240,_241,dfd);}return;}if(adds&&adds.length>0){_246.adds=this._convertFeaturesToJson(adds,0,1);_247=true;}if(_23e&&_23e.length>0){for(i=0;i<_23e.length;i++){var _24b=_23e[i];_244[_24b.attributes[_245]]=_24b;}_246.updates=this._convertFeaturesToJson(_23e,0,0,1);_247=true;}if(_23f&&_23f.length>0){var ids=[];for(i=0;i<_23f.length;i++){ids.push(_23f[i].attributes[_245]);}_246.deletes=ids.join(",");_247=true;}if(_247){var self=this;return _1a2({url:this._url.path+"/applyEdits",content:lang.mixin(_246,this._url.query),callbackParamName:"callback",load:function(_24c){self._editHandler(_24c,adds,_244,_240,_241,dfd);},error:function(err){self._resolve([err],null,_241,dfd,true);}},{usePost:true});}},queryFeatures:function(_24d,_24e,_24f){return this._query("execute","onQueryFeaturesComplete",_24d,_24e,_24f);},queryRelatedFeatures:function(_250,_251,_252){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_250,_251,_252);},queryIds:function(_253,_254,_255){return this._query("executeForIds","onQueryIdsComplete",_253,_254,_255);},queryCount:function(_256,_257,_258){return this._query("executeForCount","onQueryCountComplete",_256,_257,_258);},queryAttachmentInfos:function(_259,_25a,_25b){var url=this._url.path+"/"+_259+"/attachments",dfd=new _19d(_1a3._dfdCanceller),self=this;dfd._pendingDfd=_1a2({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_25c){var _25d=_25c.attachmentInfos,_25e;_19b.forEach(_25d,function(info){_25e=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_25e?("?"+_25e):"");info.objectId=_259;});self._resolve([_25d],"onQueryAttachmentInfosComplete",_25a,dfd);},error:function(err){self._resolve([err],null,_25b,dfd,true);}});return dfd;},addAttachment:function(_25f,_260,_261,_262){return this._sendAttachment("add",_25f,_260,_261,_262);},updateAttachment:function(_263,_264,_265,_266,_267){_265.appendChild(_19f.create("input",{type:"hidden",name:"attachmentId",value:_264}));return this._sendAttachment("update",_263,_265,_266,_267);},deleteAttachments:function(_268,_269,_26a,_26b){var url=this._url.path+"/"+_268+"/deleteAttachments",dfd=new _19d(_1a3._dfdCanceller),self=this,_26c={f:"json",attachmentIds:_269.join(",")};dfd._pendingDfd=_1a2({url:url,content:lang.mixin(_26c,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_26d){var _26e=_26d.deleteAttachmentResults;_26e=_19b.map(_26e,function(_26f){var res=new _1b7(_26f);res.attachmentId=res.objectId;res.objectId=_268;return res;});self._resolve([_26e],"onDeleteAttachmentsComplete",_26a,dfd);}),error:function(err){self._resolve([err],null,_26b,dfd,true);}},{usePost:true});return dfd;},addType:function(_270){var _271=this.types;if(_271){var _272=_19b.some(_271,function(type){if(type.id==_270.id){return true;}return false;});if(_272){return false;}else{_271.push(_270);}}else{this.types=[_270];}this._typesDirty=true;return true;},deleteType:function(_273){if(!this._collection){return;}var _274=this.types;if(_274){var _275=-1;_19b.some(_274,function(type,_276){if(type.id==_273){_275=_276;return true;}return false;});if(_275>-1){this._typesDirty=true;return _274.splice(_275,1)[0];}}},toJson:function(){var _277=this._json,json=lang.isString(_277)?_19c.fromJson(_277):lang.clone(_277);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _278=json.layerDefinition,_279=this._collection;if(_279&&this._typesDirty){_278.types=_19b.map(this.types||[],function(type){return type.toJson();});var _27a=this.renderer,_27b=_278.drawingInfo;if(_27b&&_27a&&_27a.declaredClass.indexOf("TemporalRenderer")===-1){_27b.renderer=_27a.toJson();}}var _27c=null;if(!(_279&&!this._fcAdded)){_27c={geometryType:_278.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_27c);if(_279){json.nextObjectId=this._nextId;_278.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_27d){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_1a0.id&&_1a0.id._hasPortalSession()&&_1a0.id._doPortalSignIn(path)){_1a0.id.getCredential(path).then(function(){self._findCredential();_27d.call(self);},function(){_27d.call(self);});}else{_27d.call(this);}},_updateCaps:function(){var _27e=this._editable,_27f=lang.trim(this.capabilities||""),_280=_19b.map((_27f?_27f.split(","):[]),lang.trim),caps=_19b.map((_27f?_27f.toLowerCase().split(","):[]),lang.trim),_281=_19b.indexOf(caps,"editing"),cap,i,_282,_283={"Create":_19b.indexOf(caps,"create"),"Update":_19b.indexOf(caps,"update"),"Delete":_19b.indexOf(caps,"delete")};if(_27e&&_281===-1){_280.push("Editing");}else{if(!_27e&&_281>-1){_282=[_281];for(cap in _283){if(_283[cap]>-1){_282.push(_283[cap]);}}_282.sort();for(i=_282.length-1;i>=0;i--){_280.splice(_282[i],1);}}}this.capabilities=_280.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_284=this.renderer;if(evt.firstOccurrence){this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_284&&(_284.latestObservationRenderer||_284.trackRenderer))){this._trackManager=new _1bb(this);this._trackManager.initialize(map);}}this._zoomConnect=_19a.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_285){var map=this._map;if(_285&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_19a.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_19a.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_286){this._mapTimeExtent=_286;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_287){var _288=this._timeOffset,_289=this._timeOffsetUnits;return (_287&&_288&&_289)?_287.offset(-1*_288,_289):_287;},_getTimeOverlap:function(_28a,_28b){if(_28a&&_28b){return _28a.intersection(_28b);}else{return _28a||_28b;}},_getTimeFilter:function(_28c){var _28d=this.getTimeDefinition(),_28e=null,_28f;if(_28d||_28e){_28f=this._getTimeOverlap(_28d,_28e);if(!_28f){return [false];}}if(_28c){_28c=_28f?this._getTimeOverlap(_28c,_28f):_28c;if(!_28c){return [false];}}else{_28c=_28f;}return [true,_28c];},_getAttributeFilter:function(_290){var _291=this.getDefinitionExpression();if(_290){_290=_291?"("+_291+") AND ("+_290+")":_290;}else{_290=_291;}return _290;},_applyQueryFilters:function(_292){_292.where=this._getAttributeFilter(_292.where);_292.maxAllowableOffset=this._maxOffset;if(this.timeInfo){var _293=this._getTimeFilter(_292.timeExtent);if(!_293[0]){return false;}else{_292.timeExtent=_293[1];}}return true;},_add:function(_294){var _295=this._selectionSymbol,attr=_294.attributes,_296=this.visibilityField;if(_295&&this._isSelOnly){_294.setSymbol(_295);}if(_296&&attr&&attr.hasOwnProperty(_296)){_294[attr[_296]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_297){var _298=[],map=this._map;if(this._isTable||!map){return;}if(_297.text||(_297.where&&_297.where!==this.getDefinitionExpression())){return;}var _299=this._isSnapshot,_29a=this._isSelOnly;var _29b=_297.geometry;if(_29b){if(!_29a&&_297.spatialRelationship===_1ad.SPATIAL_REL_INTERSECTS&&(_29b.type==="extent"&&(_299||map.extent.contains(_29b)))){_298.push(1);}else{return;}}var ids=_297.objectIds;if(ids){if(_299){_298.push(2);}else{var len=ids.length,mode=this._mode,_29c=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_29c++;}}if(_29c===len){_298.push(2);}else{return;}}}if(this.timeInfo){var _29d=_297.timeExtent,_29e=this._mapTimeExtent;if(_299){if(_29d){_298.push(3);}}else{if(_29a){if(_29d){return;}}else{if(_29e){if(_19b.indexOf(_298,2)!==-1){if(_29d){_298.push(3);}}else{return;}}else{if(_298.length>0){if(_29d){_298.push(3);}}else{if(_29d){return;}}}}}}return _298.length>0?_298:null;},_doQuery:function(_29f,_2a0,_2a1){var _2a2=[],mode=this._mode,_2a3=this.objectIdField,i,len,_2a4;if(_19b.indexOf(_2a0,2)!==-1){_2a2=[];var ids=_29f.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_2a2.push(obj);}}if(_2a2.length===0){return [];}}if(_19b.indexOf(_2a0,1)!==-1){_2a4=_2a2.length>0?_2a2:this.graphics;len=_2a4.length;var _2a5=_29f.geometry._normalize(null,true);_2a2=[];for(i=0;i<len;i++){var _2a6=_2a4[i],_2a7=_2a6.geometry;if(_2a7){if(this.normalization&&_2a5.length){if(_2a5[0].intersects(_2a7)||_2a5[1].intersects(_2a7)){_2a2.push(_2a6);}}else{if(_2a5.intersects(_2a7)){_2a2.push(_2a6);}}}}if(_2a2.length===0){return [];}}if(_19b.indexOf(_2a0,3)!==-1){if(this.timeInfo){_2a4=_2a2.length>0?_2a2:this.graphics;var time=_29f.timeExtent,_2a8=this._filterByTime(_2a4,time.startTime,time.endTime);_2a2=_2a8.match;}}if(_2a1){return _19b.map(_2a2,function(obj){return obj.attributes[_2a3];},this);}else{return _2a2;}},_filterByTime:function(_2a9,_2aa,_2ab){var _2ac=this._startTimeField,_2ad=this._endTimeField,_2ae;if(!this._twoTimeFields){_2ae=_2ac||_2ad;}var _2af=_1a1.isDefined,yea=[],nay=[],i,len=_2a9.length,_2b0,_2b1;_2aa=_2aa?_2aa.getTime():-Infinity;_2ab=_2ab?_2ab.getTime():Infinity;if(_2ae){for(i=0;i<len;i++){_2b0=_2a9[i];_2b1=_2b0.attributes;var time=_2b1[_2ae];if(time>=_2aa&&time<=_2ab){yea.push(_2b0);}else{nay.push(_2b0);}}}else{for(i=0;i<len;i++){_2b0=_2a9[i];_2b1=_2b0.attributes;var _2b2=_2b1[_2ac],end=_2b1[_2ad];_2b2=_2af(_2b2)?_2b2:-Infinity;end=_2af(end)?end:Infinity;if((_2b2>=_2aa&&_2b2<=_2ab)||(end>=_2aa&&end<=_2ab)||(_2aa>=_2b2&&_2ab<=end)){yea.push(_2b0);}else{nay.push(_2b0);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_2b3,_2b4,dfd,_2b5){if(_2b3){this[_2b3].apply(this,args);}if(_2b4){_2b4.apply(null,args);}if(dfd){_1a3._resDfd(dfd,args,_2b5);}},_getShallowClone:function(_2b6){var _2b7=new _1ad(),prop;for(prop in _2b6){if(_2b6.hasOwnProperty(prop)){_2b7[prop]=_2b6[prop];}}return _2b7;},_query:function(type,_2b8,_2b9,_2ba,_2bb){var that=this,map=this._map,dfd=new _19d(_1a3._dfdCanceller),_2bc=_2b9;var _2bd=function(_2be,_2bf){if(!_2bf&&type==="execute"&&!that._isTable){var _2c0=_2be.features,mode=that._mode,_2c1=that.objectIdField,il=_2c0.length,i;for(i=il-1;i>=0;i--){var oid=_2c0[i].attributes[_2c1];var _2c2=mode._getFeature(oid);if(_2c2){_2c0.splice(i,1,_2c2);}}}that._resolve([_2be],_2b8,_2ba,dfd);};if(type!=="executeRelationshipQuery"){_2bc=this._getShallowClone(_2b9);_2bc.outFields=this.getOutFields();_2bc.returnGeometry=_2b9.hasOwnProperty("returnGeometry")?_2b9.returnGeometry:true;var _2c3;if(map){_2bc.outSpatialReference=new _1a4(map.spatialReference.toJson());}if(!this._applyQueryFilters(_2bc)){switch(type){case "execute":_2c3=new _1ae({features:[]});break;case "executeForIds":_2c3=[];break;case "executeForCount":_2c3=0;break;}_2bd(_2c3,true);return dfd;}var _2c4=this._canDoClientSideQuery(_2bc);if(_2c4){var _2c5=this._doQuery(_2bc,_2c4,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_2c3=new _1ae();_2c3.features=_2c5;break;case "executeForIds":_2c3=_2c5;break;case "executeForCount":_2c3=_2c5.length;break;}_2bd(_2c3,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_2bb,dfd,true);return dfd;}if(this._ts){_2bc._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_2bc);temp.addCallbacks(_2bd,function(err){that._resolve([err],null,_2bb,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2c6,_2c7,_2c8,_2c9){var json=[],_2ca=this._selectionSymbol,_2cb=this.visibilityField,i,_2cc,_2cd=this.objectIdField;if(this.loaded&&(_2c8||_2c9)){_2cc=_19b.filter(this.fields,function(_2ce){return (_2ce.editable===false)&&(!_2c9||(_2ce.name!==_2cd));});}for(i=0;i<_2c6.length;i++){var _2cf=_2c6[i],_2d0={},_2d1=_2cf.geometry,attr=_2cf.attributes,_2d2=_2cf.symbol;if(_2d1&&(!_2c9||!this.loaded||this.allowGeometryUpdates)){_2d0.geometry=_2d1.toJson();}if(_2cb){_2d0.attributes=attr=lang.mixin({},attr);attr[_2cb]=_2cf.visible?1:0;}else{if(attr){_2d0.attributes=lang.mixin({},attr);}}if(_2d0.attributes&&_2cc&&_2cc.length){_19b.forEach(_2cc,function(_2d3){delete _2d0.attributes[_2d3.name];});}if(_2d2&&(_2d2!==_2ca)){_2d0.symbol=_2d2.toJson();}json.push(_2d0);}return _2c7?json:_19c.toJson(json);},_selectHandler:function(_2d4,_2d5,_2d6,_2d7,dfd){var _2d8,ctor=this.constructor;switch(_2d5){case ctor.SELECTION_NEW:this.clearSelection(true);_2d8=true;break;case ctor.SELECTION_ADD:_2d8=true;break;case ctor.SELECTION_SUBTRACT:_2d8=false;break;}var i,_2d9=_2d4.features,mode=this._mode,_2da=[],_2db=this.objectIdField,_2dc,oid;if(_2d8){for(i=0;i<_2d9.length;i++){_2dc=_2d9[i];oid=_2dc.attributes[_2db];var _2dd=mode._addFeatureIIf(oid,_2dc);_2da.push(_2dd);this._selectFeatureIIf(oid,_2dd,mode);}}else{for(i=0;i<_2d9.length;i++){_2dc=_2d9[i];oid=_2dc.attributes[_2db];this._unSelectFeatureIIf(oid,mode);var _2de=mode._removeFeatureIIf(oid);_2da.push(_2de||_2dc);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_2da,_2d5,_2d4.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_2d6,dfd);if(_2d4.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_2df,mode){var _2e0=this._selectedFeatures,_2e1=_2e0[oid];if(!_2e1){mode._incRefCount(oid);_2e0[oid]=_2df;if(!this._isTable){this._setSelectSymbol(_2df);}}return _2e1||_2df;},_unSelectFeatureIIf:function(oid,mode){var _2e2=this._selectedFeatures[oid];if(_2e2){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_2e2);}}return _2e2;},_isSelected:function(_2e3){},_setSelectSymbol:function(_2e4){var _2e5=this._selectionSymbol;if(_2e5&&!this._isSelOnly){_2e4.setSymbol(_2e5);}},_setUnSelectSymbol:function(_2e6){var _2e7=this._selectionSymbol;if(_2e7&&!this._isSelOnly){if(_2e7===_2e6.symbol){_2e6.setSymbol(null,true);}}},_getOutFields:function(){var _2e8=_19b.filter([this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields),function(_2e9,_2ea,arr){return !!_2e9&&(_19b.indexOf(arr,_2e9)===_2ea);});var _2eb=lang.clone(this._outFields);if(_2eb){if(_19b.indexOf(_2eb,"*")!==-1){return _2eb;}_19b.forEach(_2e8,function(_2ec){if(_19b.indexOf(_2eb,_2ec)===-1){_2eb.push(_2ec);}});return _2eb;}else{return _2e8;}},_checkFields:function(_2ed){var _2ee=_2ed||this._getOutFields();_19b.forEach(_2ee,function(_2ef){if(_2ef==="*"){return;}if(!this._getField(_2ef)){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url,field:_2ef},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]"));}},this);if(!_2ed&&!this._isTable&&!this._fserver&&!this._collection){var _2f0=_19b.some(this.fields,function(_2f1){return (_2f1&&_2f1.type==="esriFieldTypeGeometry")?true:false;});if(!_2f0){console.debug("esri.layers.FeatureLayer: "+_1a1.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"));}}},_fixRendererFields:function(){var _2f2=this.renderer;if(_2f2&&this.fields.length>0){var _2f3=_19b.filter([_2f2,_2f2.observationRenderer,_2f2.latestObservationRenderer,_2f2.trackRenderer],_1a1.isDefined);var _2f4=[];_19b.forEach(_2f3,function(rnd){var _2f5,_2f6;_2f6=rnd.attributeField;if(_2f6&&!lang.isFunction(_2f6)){_2f5=!this._getField(_2f6)&&this._getField(_2f6,true);if(_2f5){rnd.attributeField=_2f5.name;}}_2f6=rnd.attributeField2;if(_2f6){_2f5=!this._getField(_2f6)&&this._getField(_2f6,true);if(_2f5){rnd.attributeField2=_2f5.name;}}_2f6=rnd.attributeField3;if(_2f6){_2f5=!this._getField(_2f6)&&this._getField(_2f6,true);if(_2f5){rnd.attributeField3=_2f5.name;}}if(!lang.isFunction(rnd.attributeField)){_2f4.push(rnd.attributeField);}_2f4.push(rnd.attributeField2);_2f4.push(rnd.attributeField3);},this);this._rendererFields=_19b.filter(_2f4,_1a1.isDefined);}},_getField:function(_2f7,_2f8){var _2f9=this.fields;if(!_2f9||_2f9.length===0){return null;}var _2fa;if(_2f8){_2f7=_2f7.toLowerCase();}_19b.some(_2f9,function(_2fb){var _2fc=false;if(_2f8){_2fc=(_2fb&&_2fb.name.toLowerCase()===_2f7)?true:false;}else{_2fc=(_2fb&&_2fb.name===_2f7)?true:false;}if(_2fc){_2fa=_2fb;}return _2fc;});return _2fa;},_getDateOpts:function(){if(!this._dtOpts){var _2fd=_19b.map(_19b.filter(this.fields,function(_2fe){return !!(_2fe&&_2fe.type==="esriFieldTypeDate");}),function(_2ff){return _2ff.name;});this._dtOpts={properties:_2fd};}return this._dtOpts;},_applyNormalized:function(_300,_301){if(_300&&_301){_19b.forEach(_300,function(_302,_303){if(_302&&_301[_303]){_302.setGeometry(_301[_303]);}});}},_editHandler:function(_304,adds,_305,_306,_307,dfd){var _308=_304.addResults,_309=_304.updateResults,_30a=_304.deleteResults,i,_30b,oid,_30c,attr,_30d=this.objectIdField,mode=this._mode,_30e=this._isTable;var _30f=this.editFieldsInfo,_310=this.getOutFields()||[],_311=_30f&&_30f.creatorField,_312=_30f&&_30f.creationDateField,_313=_30f&&_30f.editorField,_314=_30f&&_30f.editDateField,_315=_30f&&_30f.realm;if(_19b.indexOf(_310,"*")===-1){if(_311&&_19b.indexOf(_310,_311)===-1){_311=null;}if(_312&&_19b.indexOf(_310,_312)===-1){_312=null;}if(_313&&_19b.indexOf(_310,_313)===-1){_313=null;}if(_314&&_19b.indexOf(_310,_314)===-1){_314=null;}}var _316=(_312||_314)?(new Date()).getTime():null,_317=(_311||_313)?this.getUserId():undefined;if(_317&&_315){_317=_317+"@"+_315;}if(_308){for(i=0;i<_308.length;i++){_308[i]=new _1b7(_308[i]);if(_30e){continue;}_30b=_308[i];if(_30b.success){oid=_30b.objectId;_30c=adds[i];var gl=_30c._graphicsLayer;if(gl&&gl!==this){gl.remove(_30c);}attr=_30c.attributes||{};attr[_30d]=oid;if(_311){attr[_311]=_317;}if(_313){attr[_313]=_317;}if(_312){attr[_312]=_316;}if(_314){attr[_314]=_316;}_30c.setAttributes(attr);if(mode._init){mode.drawFeature(_30c);}}}}if(_309){for(i=0;i<_309.length;i++){_309[i]=new _1b7(_309[i]);if(_30e){continue;}_30b=_309[i];if(_30b.success){oid=_30b.objectId;_30c=_305[oid];var _318=mode._getFeature(oid);if(_318){if(_318.geometry!==_30c.geometry){_318.setGeometry(_1b0.fromJson(_30c.geometry.toJson()));}this._repaint(_318,oid);}_30c=_318||_30c;attr=_30c.attributes||{};if(_313){attr[_313]=_317;}if(_314){attr[_314]=_316;}_30c.setAttributes(attr);}}}if(_30a){var _319=[];for(i=0;i<_30a.length;i++){_30a[i]=new _1b7(_30a[i]);if(_30e){continue;}_30b=_30a[i];if(_30b.success){oid=_30b.objectId;_30c=mode._getFeature(oid);if(_30c){if(this._unSelectFeatureIIf(oid,mode)){_319.push(_30c);}_30c._count=0;mode._removeFeatureIIf(oid);}}}if(_319.length>0){this.onSelectionComplete(_319,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_308,_309,_30a],"onEditsComplete",_306,dfd);},_sendAttachment:function(type,_31a,_31b,_31c,_31d){var _31e=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_31a+"/"+_31e,self=this;var dfd=_1a2({url:url,form:_31b,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_31f){var _320=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_321=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_322=new _1b7(_31f[_320]);_322.attachmentId=_322.objectId;_322.objectId=_31a;self._resolve([_322],_321,_31c);return _322;}).addErrback(function(_323){self._resolve([_323],null,_31d,null,true);});return dfd;},_repaint:function(_324,oid,_325){oid=_1a1.isDefined(oid)?oid:_324.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_324.setSymbol(_324.symbol,_325);}},_getKind:function(_326){var _327=this._trackManager;if(_327){return _327.isLatestObservation(_326)?1:0;}return 0;}});lang.mixin(_1bc,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_1b1._createWrappers(_1bc);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_1bc,_1a0);}return _1bc;});},"esri/virtualearth/VETiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/_base/array","dojo/_base/config","dojo/has","dojo/string","dojo/_base/Deferred","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/layers/TileInfo","esri/layers/TiledMapServiceLayer","esri/geometry/Extent","esri/request"],function(_328,lang,_329,_32a,_32b,has,_32c,_32d,_32e,_32f,_330,_331,_332,_333,_334){var VET=_328(_332,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(_335){try{_335=lang.mixin({bingMapsKey:null,culture:"en-US"},_335||{});var _336=window.location.protocol;if(_336==="file:"){_336="http:";}this.url=_336+"//dev.virtualearth.net/REST/v1";this._url=_32f.urlToObject(this.url);this.spatialReference=new _330({wkid:102100});this.tileInfo=new _331({rows:256,cols:256,dpi:96,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=(this.fullExtent=new _333(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _330({wkid:102100})));lang.mixin(this,_335);this.hasAttributionData=this.showAttribution;this._initLayer=lang.hitch(this,this._initLayer);this._errorHandler=lang.hitch(this,this._errorHandler);this._getTileInfo=lang.hitch(this,this._getTileInfo);if(this.bingMapsKey){this._getTileInfo();}else{throw new Error("BingMapsKey must be provided.");}this.registerConnectEvents("esri.virtualearth.VETiledLayer",true);}catch(e){this.onError(e);throw e;}},_unsetMap:function(map,_337){this.inherited("_unsetMap",arguments);},_getTileInfo:function(){if(!this.mapStyle){return;}var url=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var info=this.resourceInfo;if(!this.loaded&&info){this._initLayer(info);}else{_334({url:url,content:lang.mixin({},{key:this.bingMapsKey,ss:true,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler});}}},_initLayer:function(_338,io){try{this.resourceInfo=_329.toJson(_338);var _339=_338.resourceSets[0].resources[0];var _33a=_339.imageUrl.replace("{","${");this.tileServers=_32a.map(_339.imageUrlSubdomains,function(_33b){var _33c=window.location.protocol;if(_33c==="file:"){_33c="http:";}return _32c.substitute(_33a,{subdomain:_33b}).replace("http:",_33c);});this._tsLength=this.tileServers.length;if(!this.loaded){this.copyright=this.copyright||"&copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=true;this.onLoad(this);var _33d=this.loadCallback;if(_33d){delete this.loadCallback;_33d(this);}}else{this.refresh();this.onMapStyleChange();}}catch(e){this.onError(e);}},getAttributionData:function(){var dfd=new _32d(),_33e=_329.fromJson(this.resourceInfo),_33f;if(this.hasAttributionData&&_33e){_33f=lang.getObject("resourceSets.0.resources.0.imageryProviders",false,_33e);}if(_33f){dfd.callback({contributors:_33f});}else{var err=new Error("Layer does not have attribution data");err.log=_32b.isDebug;dfd.errback(err);}return dfd;},getTileUrl:function(_340,row,col){var _341=this.tileServers[row%this._tsLength],_342=_341.replace(/\{/g,"${");return _32c.substitute(_342,{quadkey:this._getQuadKey(_340,row,col),culture:this.culture,token:this.bingMapsKey});},_getQuadKey:function(_343,row,col){var _344="",_345,mask,i;for(i=_343;i>0;i--){_345="0";mask=1<<(i-1);if((col&mask)!=0){_345++;}if((row&mask)!=0){_345++;_345++;}_344=_344+_345;}return _344;},setMapStyle:function(_346){this.mapStyle=_346;this._getTileInfo();},setCulture:function(_347){this.culture=_347;this._getTileInfo();},setBingMapsKey:function(_348){this.bingMapsKey=_348;},onMapStyleChange:function(){}});lang.mixin(VET,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});if(has("extend-esri")){lang.setObject("virtualearth.VETiledLayer",VET,_32e);}return VET;});},"dojo/touch":function(){define(["./_base/kernel","./aspect","./dom","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],function(dojo,_349,dom,lang,on,has,_34a,_34b,win){var _34c=navigator.msPointerEnabled;var _34d;function _34e(_34f,_350,_351){if(_34c&&_351){return function(node,_352){return on(node,_351,_352);};}else{if(has("touch")){return function(node,_353){var _354=on(node,_350,_353),_355=on(node,_34f,function(evt){if(!_34d||(new Date()).getTime()>_34d+1000){_353.call(this,evt);}});return {remove:function(){_354.remove();_355.remove();}};};}else{return function(node,_356){return on(node,_34f,_356);};}}};var _357,_358,_359;if(has("touch")&&!_34c){_34b(function(){_359=win.body();win.doc.addEventListener("touchstart",function(_35a){_34d=(new Date()).getTime();var _35b=_359;_359=_35a.target;if(_359.dojoElementFromPoint){_359=_359.dojoElementFromPoint(_35a.changedTouches[0].clientX,_35a.changedTouches[0].clientY);}if(_35b){on.emit(_35b,"dojotouchout",{target:_35b,relatedTarget:_359,bubbles:true});}if(_359){on.emit(_359,"dojotouchover",{target:_359,relatedTarget:_35b,bubbles:true});}},true);on(win.doc,"touchmove",function(_35c){_34d=(new Date()).getTime();_358=_35c;var _35d=win.doc.elementFromPoint(_35c.clientX,_35c.clientY);if(_35d){var _35e=_35d;if(_35d.dojoElementFromPoint){_35d=_35d.dojoElementFromPoint(_35c.clientX,_35c.clientY);}if(_359!==_35d){if(_359){on.emit(_35e,"dojotouchout",{target:_359,relatedTarget:_35d,bubbles:true});}if(_35d){on.emit(_35e,"dojotouchover",{target:_35d,relatedTarget:_359,bubbles:true});}_359=_35d;}on.emit(_35e,"dojotouchmove",{target:_35d,bubbles:true});}});on(win.doc,"touchend",function(_35f){var node=win.doc.elementFromPoint(_35f.clientX,_35f.clientY);var _360=node;if(node.dojoElementFromPoint){node=node.dojoElementFromPoint(_35f.clientX,_35f.clientY);}if(node){on.emit(_360,"dojotouchend",lang.delegate(_35f,{target:node,bubbles:true}));}});});_357=function(node,_361){return on(node,"dojotouchmove",function(_362){_361(lang.delegate(_358,{target:_362.target,preventDefault:function(){_358.preventDefault();},stopPropagation:function(){_362.stopPropagation();}}));});};}var _363={press:_34e("mousedown","touchstart","MSPointerDown"),move:_34e("mousemove",_357,"MSPointerMove"),release:_34e("mouseup","dojotouchend","MSPointerUp"),cancel:_34e(_34a.leave,"touchcancel",has("touch")?"MSPointerCancel":null),over:_34e("mouseover","dojotouchover","MSPointerOver"),out:_34e("mouseout","dojotouchout","MSPointerOut"),enter:_34a._eventHandler(_34e("mouseover","dojotouchover","MSPointerOver")),leave:_34a._eventHandler(_34e("mouseout","dojotouchout","MSPointerOut"))};1&&(dojo.touch=_363);return _363;});},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_364,lang,_365,has,_366){var _367=_364(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_368){if(_368){this.name=_368.name;this.title=_368.title;this.description=_368.description;this.extent=_368.extent;this.legendURL=_368.legendURL;this.subLayers=_368.subLayers?_368.subLayers:[];this.allExtents=_368.allExtents?_368.allExtents:[];this.spatialReferences=_368.spatialReferences?_368.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_365.forEach(this.subLayers,function(_369){info.subLayers.push(_369.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_365.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_367,_366);}return _367;});},"dijit/_WidgetsInTemplateMixin":function(){define("dijit/_WidgetsInTemplateMixin",["dojo/_base/array","dojo/_base/declare","dojo/parser"],function(_36a,_36b,_36c){return _36b("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:false,widgetsInTemplate:true,_beforeFillContent:function(){if(this.widgetsInTemplate){var node=this.domNode;var cw=(this._startupWidgets=_36c.parse(node,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,scope:"dojo"}));if(!cw.isFulfilled()){throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), "+"unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}this._attachTemplateNodes(cw,function(n,p){return n[p];});}},startup:function(){_36a.forEach(this._startupWidgets,function(w){if(w&&!w._started&&w.startup){w.startup();}});this.inherited(arguments);}});});},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_36d,lang,has,_36e,_36f){var _370=_36d(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_36f.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_370,_36e);}return _370;});},"esri/layers/RenderMode":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_371,_372,lang,_373,has,_374,_375){var _376=_372(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_371._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_377){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _378=this._featureMap[oid];if(_378){_378._count++;}},_decRefCount:function(oid){var _379=this._featureMap[oid];if(_379){_379._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_37a){var fmap=this._featureMap,_37b=fmap[oid],_37c=this.featureLayer;if(!_37b){fmap[oid]=_37a;_37c._add(_37a);_37a._count=0;}return _37b||_37a;},_removeFeatureIIf:function(oid){var _37d=this._featureMap[oid],_37e=this.featureLayer;if(_37d){if(_37d._count){return;}delete this._featureMap[oid];_37e._remove(_37d);}return _37d;},_clearIIf:function(){var i,_37f=this.featureLayer,_380=_37f.graphics,_381=_37f._selectedFeatures,_382=_37f.objectIdField;for(i=_380.length-1;i>=0;i--){var _383=_380[i];var oid=_383.attributes[_382];if(oid in _381){_383._count=1;continue;}_383._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_374[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_374[this._prefix+id];if(dfd){try{dfd.cancel();_374._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_374._validCheck(null);},_toggleVisibility:function(show){var _384=this.featureLayer,_385=_384.graphics,_386=show?"show":"hide",i,len=_385.length;show=show&&_384._ager;for(i=0;i<len;i++){var _387=_385[i];_387[_386]();if(show){_384._repaint(_387);}}},_applyTimeFilter:function(_388){var _389=this.featureLayer;if(!_389.timeInfo||_389.suspended){return;}if(!_388){_389._fireUpdateStart();}var _38a=_389._trackManager;if(_38a){_38a.clearTracks();}var defn=_389.getTimeDefinition(),_38b=_389._getOffsettedTE(_389._mapTimeExtent);if(_38b){_38b=_389._getTimeOverlap(defn,_38b);if(_38b){var _38c=_389._filterByTime(_389.graphics,_38b.startTime,_38b.endTime);if(_38a){_38a.addFeatures(_38c.match);}_373.forEach(_38c.match,function(_38d){var _38e=_38d._shape;if(!_38d.visible){_38d.show();_38e=_38d._shape;_38e&&_38e._moveToFront();}if(_389._ager&&_38e){_389._repaint(_38d);}});_373.forEach(_38c.noMatch,function(_38f){if(_38f.visible){_38f.hide();}});}else{this._toggleVisibility(false);}}else{if(_38a){_38a.addFeatures(_389.graphics);}this._toggleVisibility(true);}if(_38a){_38a.moveLatestToFront();_38a.drawTracks();}if(!_388){_389._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_376,_375);}return _376;});},"esri/layers/FeatureType":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_390,lang,_391,has,_392,_393,_394,_395,_396,_397,_398){var _399=_390(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _39a=json.symbol;if(_39a){this.symbol=_394.fromJson(_39a);}var _39b=json.domains,_39c,i;var _39d=this.domains={};for(_39c in _39b){if(_39b.hasOwnProperty(_39c)){var _39e=_39b[_39c];switch(_39e.type){case "range":_39d[_39c]=new _395(_39e);break;case "codedValue":_39d[_39c]=new _396(_39e);break;case "inherited":_39d[_39c]=new _397(_39e);break;}}}var _39f=json.templates;if(_39f){var _3a0=this.templates=[];for(i=0;i<_39f.length;i++){_3a0.push(new _398(_39f[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _3a1,_3a2=this.domains,_3a3=this.templates,_3a4=_393.fixJson;if(_3a2){var _3a5=json.domains={};for(_3a1 in _3a2){if(_3a2.hasOwnProperty(_3a1)){_3a5[_3a1]=_3a2[_3a1]&&_3a2[_3a1].toJson();}}_3a4(_3a5);}if(_3a3){json.templates=_391.map(_3a3,function(_3a6){return _3a6.toJson();});}return _3a4(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_399,_392);}return _399;});},"esri/layers/TrackManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_3a7,lang,_3a8,has,_3a9,_3aa,_3ab,_3ac){var _3ad=_3a7(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_3ae){this.layer=_3ae;this.trackMap={};},initialize:function(map){this.map=map;var _3af=this.layer,_3b0=_3af.renderer.trackRenderer;if(_3b0&&(_3af.geometryType==="esriGeometryPoint")){var _3b1=(this.container=new _3ac._GraphicsLayer({id:_3af.id+"_tracks",_child:true}));_3b1.loaded=true;_3b1.onLoad(_3b1);_3b1._setMap(map,_3af._div);_3b1.setRenderer(_3b0);}},addFeatures:function(_3b2){var tkid,_3b3=this.trackMap,_3b4=this.layer,_3b5=_3b4._trackIdField;_3a8.forEach(_3b2,function(_3b6){var _3b7=_3b6.attributes;tkid=_3b7[_3b5];var ary=(_3b3[tkid]=(_3b3[tkid]||[]));ary.push(_3b6);});var _3b8=_3b4._startTimeField,_3b9=_3b4.objectIdField;var _3ba=function(a,b){var _3bb=a.attributes[_3b8],_3bc=b.attributes[_3b8];if(_3bb===_3bc){return (a.attributes[_3b9]<b.attributes[_3b9])?-1:1;}else{return (_3bb<_3bc)?-1:1;}};for(tkid in _3b3){_3b3[tkid].sort(_3ba);}},drawTracks:function(){var _3bd=this.container;if(!_3bd){return;}var _3be=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_3bf,_3c0=this.layer._trackIdField,_3c1;for(tkid in _3be){ary=_3be[tkid];path=[];for(i=ary.length-1;i>=0;i--){_3bf=ary[i].geometry;if(_3bf){path.push([_3bf.x,_3bf.y]);}}_3c1={};_3c1[_3c0]=tkid;if(path.length>0){_3bd.add(new _3aa(new _3ab({paths:[path],spatialReference:sr}),null,_3c1));}}},moveLatestToFront:function(){_3a8.forEach(this.getLatestObservations(),function(_3c2){var _3c3=_3c2._shape;_3c3&&_3c3._moveToFront();this._repaint(_3c2,null,true);},this.layer);},getLatestObservations:function(){var _3c4=[];if(!this.layer.renderer.latestObservationRenderer){return _3c4;}var _3c5=this.trackMap,tkid;for(tkid in _3c5){var ary=_3c5[tkid];_3c4.push(ary[ary.length-1]);}return _3c4;},clearTracks:function(){var _3c6=this.getLatestObservations();this.trackMap={};var _3c7=this.container;if(_3c7){_3c7.clear();}_3a8.forEach(_3c6,function(_3c8){this._repaint(_3c8,null,true);},this.layer);},isLatestObservation:function(_3c9){var _3ca=this.layer._trackIdField;var _3cb=this.trackMap[_3c9.attributes[_3ca]];if(_3cb){return (_3cb[_3cb.length-1]===_3c9);}return false;},destroy:function(){var _3cc=this.container;if(_3cc){_3cc.clear();_3cc._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_3ad,_3a9);}return _3ad;});},"esri/layers/GridLayout":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_3cd,lang,_3ce,has,_3cf,_3d0,_3d1,_3d2){var _3d3=_3cd(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_3d4,_3d5,_3d6,_3d7){this.origin=_3d4;this.cellWidth=_3d5.width;this.cellHeight=_3d5.height;this.mapWidth=_3d6.width;this.mapHeight=_3d6.height;this.srInfo=_3d7;},setResolution:function(_3d8){this._resolution=(_3d8.xmax-_3d8.xmin)/this.mapWidth;if(this.srInfo){var _3d9=Math.round((2*this.srInfo.valid[1])/this._resolution),_3da=Math.round(_3d9/this.cellWidth);this._frameStats=[_3da,0,_3da-1];}},getCellCoordinates:function(_3db){var res=this._resolution,_3dc=this.origin;return {row:Math.floor((_3dc.y-_3db.y)/(this.cellHeight*res)),col:Math.floor((_3db.x-_3dc.x)/(this.cellWidth*res))};},normalize:function(col){var _3dd=this._frameStats;if(_3dd){var _3de=_3dd[0],m180=_3dd[1],p180=_3dd[2];if(col<m180){col=col%_3de;col=col<m180?col+_3de:col;}else{if(col>p180){col=col%_3de;}}}return col;},intersects:function(_3df,_3e0){var _3e1=this.srInfo;if(_3e1){return _3ce.some(_3e0._getParts(_3e1),function(_3e2){return _3df.intersects(_3e2.extent);});}else{return _3df.intersects(_3e0);}},getCellExtent:function(row,col){var res=this._resolution,_3e3=this.origin,_3e4=this.cellWidth,_3e5=this.cellHeight;return new _3d1((col*_3e4*res)+_3e3.x,_3e3.y-((row+1)*_3e5*res),((col+1)*_3e4*res)+_3e3.x,_3e3.y-(row*_3e5*res),new _3d0(_3e3.spatialReference.toJson()));},getLatticeID:function(_3e6){var _3e7=this.getCellCoordinates({x:_3e6.xmin,y:_3e6.ymax}),_3e8=this.getCellCoordinates({x:_3e6.xmax,y:_3e6.ymin}),_3e9=_3e7.row,_3ea=_3e8.row,_3eb=this.normalize(_3e7.col),_3ec=this.normalize(_3e8.col);return _3e9+"_"+_3ea+"_"+_3eb+"_"+_3ec;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_3ed,_3ee){var _3ef=this.getCellCoordinates({x:_3ed.xmin,y:_3ed.ymax}),_3f0=this.getCellCoordinates({x:_3ed.xmax,y:_3ed.ymin}),_3f1=_3ef.row,_3f2=_3f0.row,_3f3=_3ef.col,_3f4=_3f0.col,_3f5=[],i,j,nj,_3f6=[],_3f7=[],len,xmin,xmax,ymin,ymax,_3f8=[],_3f9,_3fa;for(i=_3f1;i<=_3f2;i++){for(j=_3f3;j<=_3f4;j++){nj=this.normalize(j);_3ed=this.getCellExtent(i,nj);_3f5.push({row:i,col:nj,extent:_3ed,resolution:this._resolution});if(_3ee){_3f6.push(_3ed.xmin,_3ed.xmax);_3f7.push(_3ed.ymin,_3ed.ymax);}}}_3f3=this.normalize(_3f3);_3f4=this.normalize(_3f4);_3f6.sort(this.sorter);_3f7.sort(this.sorter);len=_3f6.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3f6[i]===_3f6[i+1]){_3f6.splice(i,1);}}}len=_3f7.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3f7[i]===_3f7[i+1]){_3f7.splice(i,1);}}}if(_3f6.length&&_3f7.length){xmin=_3f6[0];xmax=_3f6[_3f6.length-1];ymin=_3f7[0];ymax=_3f7[_3f7.length-1];len=_3f6.length;for(i=0;i<len;i++){_3f8.push([[_3f6[i],ymax],[_3f6[i],ymin]]);}len=_3f7.length;for(i=0;i<len;i++){_3f8.push([[xmin,_3f7[i]],[xmax,_3f7[i]]]);}_3f9=new _3d2({paths:_3f8,spatialReference:this.origin.spatialReference.toJson()});_3fa=_3f1+"_"+_3f2+"_"+_3f3+"_"+_3f4;_3f5.push({latticeID:_3fa,lattice:_3f9,resolution:this._resolution});}return {minRow:_3f1,maxRow:_3f2,minCol:_3f3,maxCol:_3f4,cells:_3f5};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_3d3,_3cf);}return _3d3;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(lang,_3fb,_3fc){var _3fd={};lang.setObject("dojo.data.util.simpleFetch",_3fd);_3fd.errorHandler=function(_3fe,_3ff){if(_3ff.onError){var _400=_3ff.scope||_3fb.global;_3ff.onError.call(_400,_3fe,_3ff);}};_3fd.fetchHandler=function(_401,_402){var _403=_402.abort||null,_404=false,_405=_402.start?_402.start:0,_406=(_402.count&&(_402.count!==Infinity))?(_405+_402.count):_401.length;_402.abort=function(){_404=true;if(_403){_403.call(_402);}};var _407=_402.scope||_3fb.global;if(!_402.store){_402.store=this;}if(_402.onBegin){_402.onBegin.call(_407,_401.length,_402);}if(_402.sort){_401.sort(_3fc.createSortFunction(_402.sort,this));}if(_402.onItem){for(var i=_405;(i<_401.length)&&(i<_406);++i){var item=_401[i];if(!_404){_402.onItem.call(_407,item,_402);}}}if(_402.onComplete&&!_404){var _408=null;if(!_402.onItem){_408=_401.slice(_405,_406);}_402.onComplete.call(_407,_408,_402);}};_3fd.fetch=function(_409){_409=_409||{};if(!_409.store){_409.store=this;}this._fetchItems(_409,lang.hitch(this,"fetchHandler"),lang.hitch(this,"errorHandler"));return _409;};return _3fd;});},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_40a,xhr,_40b,_40c,_40d){var _40e=_40a("dojox.data.CsvStore",null,{constructor:function(_40f){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_40f.url){this.url=_40f.url;}this._csvData=_40f.data;if(_40f.label){this.label=_40f.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_40f.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _40f){this.separator=_40f.separator;}if("urlPreventCache" in _40f){this.urlPreventCache=_40f.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_410,_411){this._assertIsItem(item);var _412=_411;if(typeof _410==="string"){var ai=this._attributeIndexes[_410];if(ai!=null){var _413=this._dataArray[this._getIndex(item)];_412=_413[ai]||_411;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _412;},getValues:function(item,_414){var _415=this.getValue(item,_414);return (_415?[_415]:[]);},getAttributes:function(item){this._assertIsItem(item);var _416=[];var _417=this._dataArray[this._getIndex(item)];for(var i=0;i<_417.length;i++){if(_417[i]!==""){_416.push(this._attributes[i]);}}return _416;},hasAttribute:function(item,_418){this._assertIsItem(item);if(typeof _418==="string"){var _419=this._attributeIndexes[_418];var _41a=this._dataArray[this._getIndex(item)];return (typeof _419!=="undefined"&&_419<_41a.length&&_41a[_419]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_41b,_41c){var _41d=undefined;if(typeof _41c==="string"){_41d=_40c.patternToRegExp(_41c,false);}return this._containsValue(item,_41b,_41c,_41d);},_containsValue:function(item,_41e,_41f,_420){var _421=this.getValues(item,_41e);for(var i=0;i<_421.length;++i){var _422=_421[i];if(typeof _422==="string"&&_420){return (_422.match(_420)!==null);}else{if(_41f===_422){return true;}}}return false;},isItem:function(_423){if(_423&&_423[this._storeProp]===this){var _424=_423[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_424]];if(data){return true;}}else{if(_424>=0&&_424<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_425){return this.isItem(_425);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_426,_427,_428){var self=this;var _429=function(_42a,_42b){var _42c=null;if(_42a.query){var key,_42d;_42c=[];var _42e=_42a.queryOptions?_42a.queryOptions.ignoreCase:false;var _42f={};for(key in _42a.query){_42d=_42a.query[key];if(typeof _42d==="string"){_42f[key]=_40c.patternToRegExp(_42d,_42e);}}for(var i=0;i<_42b.length;++i){var _430=true;var _431=_42b[i];for(key in _42a.query){_42d=_42a.query[key];if(!self._containsValue(_431,key,_42d,_42f[key])){_430=false;}}if(_430){_42c.push(_431);}}}else{_42c=_42b.slice(0,_42b.length);}_427(_42c,_42a);};if(this._loadFinished){_429(_426,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_426,filter:_429});}else{this._loadInProgress=true;var _432={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _433=xhr.get(_432);_433.addCallback(function(data){try{self._processData(data);_429(_426,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_428(e,_426);}});_433.addErrback(function(_434){self._loadInProgress=false;if(_428){_428(_434,_426);}else{throw _434;}});var _435=null;if(_426.abort){_435=_426.abort;}_426.abort=function(){var df=_433;if(df&&df.fired===-1){df.cancel();df=null;}if(_435){_435.call(_426);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_429(_426,this._arrayOfAllItems);}catch(e){_428(e,_426);}}else{var _436=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_428){_428(_436,_426);}else{throw _436;}}}}},close:function(_437){},_getArrayOfArraysFromCsvFileContents:function(_438){if(lang.isString(_438)){var _439=new RegExp("^\\s+","g");var _43a=new RegExp("\\s+$","g");var _43b=new RegExp("\"\"","g");var _43c=[];var i;var _43d=this._splitLines(_438);for(i=0;i<_43d.length;++i){var _43e=_43d[i];if(_43e.length>0){var _43f=_43e.split(this.separator);var j=0;while(j<_43f.length){var _440=_43f[j];var _441=_440.replace(_439,"");var _442=_441.replace(_43a,"");var _443=_442.charAt(0);var _444=_442.charAt(_442.length-1);var _445=_442.charAt(_442.length-2);var _446=_442.charAt(_442.length-3);if(_442.length===2&&_442=="\"\""){_43f[j]="";}else{if((_443=="\"")&&((_444!="\"")||((_444=="\"")&&(_445=="\"")&&(_446!="\"")))){if(j+1===_43f.length){return;}var _447=_43f[j+1];_43f[j]=_441+this.separator+_447;_43f.splice(j+1,1);}else{if((_443=="\"")&&(_444=="\"")){_442=_442.slice(1,(_442.length-1));_442=_442.replace(_43b,"\"");}_43f[j]=_442;j+=1;}}}_43c.push(_43f);}}this._attributes=_43c.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_43c;}},_splitLines:function(_448){var _449=[];var i;var line="";var _44a=false;for(i=0;i<_448.length;i++){var c=_448.charAt(i);switch(c){case "\"":_44a=!_44a;line+=c;break;case "\r":if(_44a){line+=c;}else{_449.push(line);line="";if(i<(_448.length-1)&&_448.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_44a){line+=c;}else{_449.push(line);line="";}break;default:line+=c;}}if(line!==""){_449.push(line);}return _449;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _44b=this._dataArray[i];id=_44b[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_44c){var item={};item[this._storeProp]=this;item[this._idProp]=_44c;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_44d){var item;var _44e=_44d.scope?_44d.scope:_40b.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_44d});}else{this._loadInProgress=true;var _44f={url:self.url,handleAs:"text"};var _450=xhr.get(_44f);_450.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_44d.identity);if(!self.isItem(item)){item=null;}if(_44d.onItem){_44d.onItem.call(_44e,item);}self._handleQueuedFetches();}catch(error){if(_44d.onError){_44d.onError.call(_44e,error);}}});_450.addErrback(function(_451){this._loadInProgress=false;if(_44d.onError){_44d.onError.call(_44e,_451);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_44d.identity);if(!self.isItem(item)){item=null;}if(_44d.onItem){_44d.onItem.call(_44e,item);}}catch(e){if(_44d.onError){_44d.onError.call(_44e,e);}}}}}else{item=this._createItemFromIdentity(_44d.identity);if(!this.isItem(item)){item=null;}if(_44d.onItem){_44d.onItem.call(_44e,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _452=this._queuedFetches[i];var _453=_452.filter;var _454=_452.args;if(_453){_453(_454,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_452.args);}}this._queuedFetches=[];}}});lang.extend(_40e,_40d);return _40e;});},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(lang,_455){var _456={};lang.setObject("dojo.date.stamp",_456);_456.fromISOString=function(_457,_458){if(!_456._isoRegExp){_456._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _459=_456._isoRegExp.exec(_457),_45a=null;if(_459){_459.shift();if(_459[1]){_459[1]--;}if(_459[6]){_459[6]*=1000;}if(_458){_458=new Date(_458);_455.forEach(_455.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(prop){return _458["get"+prop]();}),function(_45b,_45c){_459[_45c]=_459[_45c]||_45b;});}_45a=new Date(_459[0]||1970,_459[1]||0,_459[2]||1,_459[3]||0,_459[4]||0,_459[5]||0,_459[6]||0);if(_459[0]<100){_45a.setFullYear(_459[0]||1970);}var _45d=0,_45e=_459[7]&&_459[7].charAt(0);if(_45e!="Z"){_45d=((_459[8]||0)*60)+(Number(_459[9])||0);if(_45e!="-"){_45d*=-1;}}if(_45e){_45d-=_45a.getTimezoneOffset();}if(_45d){_45a.setTime(_45a.getTime()+_45d*60000);}}return _45a;};_456.toISOString=function(_45f,_460){var _461=function(n){return (n<10)?"0"+n:n;};_460=_460||{};var _462=[],_463=_460.zulu?"getUTC":"get",date="";if(_460.selector!="time"){var year=_45f[_463+"FullYear"]();date=["0000".substr((year+"").length)+year,_461(_45f[_463+"Month"]()+1),_461(_45f[_463+"Date"]())].join("-");}_462.push(date);if(_460.selector!="date"){var time=[_461(_45f[_463+"Hours"]()),_461(_45f[_463+"Minutes"]()),_461(_45f[_463+"Seconds"]())].join(":");var _464=_45f[_463+"Milliseconds"]();if(_460.milliseconds){time+="."+(_464<100?"0":"")+_461(_464);}if(_460.zulu){time+="Z";}else{if(_460.selector!="time"){var _465=_45f.getTimezoneOffset();var _466=Math.abs(_465);time+=(_465>0?"-":"+")+_461(Math.floor(_466/60))+":"+_461(_466%60);}}_462.push(time);}return _462.join("T");};return _456;});},"dijit/_Templated":function(){define("dijit/_Templated",["./_WidgetBase","./_TemplatedMixin","./_WidgetsInTemplateMixin","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel"],function(_467,_468,_469,_46a,_46b,lang,_46c){lang.extend(_467,{waiRole:"",waiState:""});return _46b("dijit._Templated",[_468,_469],{widgetsInTemplate:false,constructor:function(){_46c.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0");},_attachTemplateNodes:function(_46d,_46e){this.inherited(arguments);var _46f=lang.isArray(_46d)?_46d:(_46d.all||_46d.getElementsByTagName("*"));var x=lang.isArray(_46d)?0:-1;for(;x<_46f.length;x++){var _470=(x==-1)?_46d:_46f[x];var role=_46e(_470,"waiRole");if(role){_470.setAttribute("role",role);}var _471=_46e(_470,"waiState");if(_471){_46a.forEach(_471.split(/\s*,\s*/),function(_472){if(_472.indexOf("-")!=-1){var pair=_472.split("-");_470.setAttribute("aria-"+pair[0],pair[1]);}});}}}});});},"esri/dijit/PopupRenderer":function(){define(["require","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_Widget","dijit/_Templated","esri/kernel","dojo/i18n!esri/nls/jsapi","dojo/NodeList-dom"],function(_473,_474,_475,lang,_476,_477,has,_478,dom,_479,_47a,_47b,_47c,_47d,_47e,_47f,_480){var _481=0;var PR=_474([_47d,_47e],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=lang.mixin({},_480.widgets.popup);},templateString:"<div class='esriViewPopup'>"+"<div class='mainSection'>"+"<div class='header' dojoAttachPoint='_title'></div>"+"<div class='hzLine'></div>"+"<div dojoAttachPoint='_description'></div>"+"<div class='break'></div>"+"</div>"+"<div class='attachmentsSection hidden'>"+"<div>${_nls.NLS_attach}:</div>"+"<ul dojoAttachPoint='_attachmentsList'>"+"</ul>"+"<div class='break'></div>"+"</div>"+"<div class='mediaSection hidden'>"+"<div class='header' dojoAttachPoint='_mediaTitle'></div>"+"<div class='hzLine'></div>"+"<div class='caption' dojoAttachPoint='_mediaCaption'></div>"+"<div class='gallery' dojoAttachPoint='_gallery'>"+"<div class='mediaHandle prev' dojoAttachPoint='_prevMedia' dojoAttachEvent='onclick: _goToPrevMedia'></div>"+"<div class='mediaHandle next' dojoAttachPoint='_nextMedia' dojoAttachEvent='onclick: _goToNextMedia'></div>"+"<ul class='summary'>"+"<li class='image mediaCount hidden' dojoAttachPoint='_imageCount'>0</li>"+"<li class='image mediaIcon hidden'></li>"+"<li class='chart mediaCount hidden' dojoAttachPoint='_chartCount'>0</li>"+"<li class='chart mediaIcon hidden'></li>"+"</ul>"+"<div class='frame' dojoAttachPoint='_mediaFrame'></div>"+"</div>"+"</div>"+"<div class='editSummarySection hidden' dojoAttachPoint='_editSummarySection'>"+"<div class='break'></div>"+"<div class='break hidden' dojoAttachPoint='_mediaBreak'></div>"+"<div class='editSummary' dojoAttachPoint='_editSummary'></div>"+"</div>"+"</div>",showTitle:true,startup:function(){this.inherited(arguments);var _482=this.template,_483=this.graphic,_484=_482.getComponents(_483),_485=this.showTitle?_484.title:"",_486=_484.description,_487=_484.fields,_488=_484.mediaInfos,_489=this.domNode,nls=this._nls;this._prevMedia.title=nls.NLS_prevMedia;this._nextMedia.title=nls.NLS_nextMedia;_479.set(this._title,"innerHTML",_485);if(!_485){_47a.add(this._title,"hidden");}if(!_486&&_487){_486="";_476.forEach(_487,function(row){_486+=("<tr valign='top'>");_486+=("<td class='attrName'>"+row[0]+"</td>");_486+=("<td class='attrValue'>"+row[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"<a target='_blank' href='$1' title='$1'>"+nls.NLS_moreInfo+"</a>")+"</td>");_486+=("</tr>");});if(_486){_486="<table class='attrTable' cellpadding='0px' cellspacing='0px'>"+_486+"</table>";}}_479.set(this._description,"innerHTML",_486);if(!_486){_47a.add(this._description,"hidden");}_477.query("a",this._description).forEach(function(node){_479.set(node,"target","_blank");});if(_485&&_486){_477.query(".mainSection .hzLine",_489).removeClass("hidden");}else{if(_485||_486){_477.query(".mainSection .hzLine",_489).addClass("hidden");}else{_477.query(".mainSection",_489).addClass("hidden");}}var dfd=(this._dfd=_482.getAttachments(_483));if(dfd){dfd.addBoth(lang.hitch(this,this._attListHandler,dfd));_479.set(this._attachmentsList,"innerHTML","<li>"+nls.NLS_searching+"...</li>");_477.query(".attachmentsSection",_489).removeClass("hidden");}if(_488&&_488.length){_477.query(".mediaSection",_489).removeClass("hidden");dom.setSelectable(this._mediaFrame,false);this._mediaInfos=_488;this._mediaPtr=0;this._updateUI();this._displayMedia();}if(_484.editSummary){_479.set(this._editSummary,"innerHTML",_484.editSummary);if(_488&&_488.length){_47a.remove(this._mediaBreak,"hidden");}_47a.remove(this._editSummarySection,"hidden");}},destroy:function(){if(this._dfd){this._dfd.cancel();}this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments);},_goToPrevMedia:function(){var ptr=this._mediaPtr-1;if(ptr<0){return;}this._mediaPtr--;this._updateUI();this._displayMedia();},_goToNextMedia:function(){var ptr=this._mediaPtr+1;if(ptr===this._mediaInfos.length){return;}this._mediaPtr++;this._updateUI();this._displayMedia();},_updateUI:function(){var _48a=this._mediaInfos,_48b=_48a.length,_48c=this.domNode,_48d=this._prevMedia,_48e=this._nextMedia;if(_48b>1){var _48f=0,_490=0;_476.forEach(_48a,function(info){if(info.type==="image"){_48f++;}else{if(info.type.indexOf("chart")!==-1){_490++;}}});if(_48f){_479.set(this._imageCount,"innerHTML",_48f);_477.query(".summary .image",_48c).removeClass("hidden");}if(_490){_479.set(this._chartCount,"innerHTML",_490);_477.query(".summary .chart",_48c).removeClass("hidden");}}else{_477.query(".summary",_48c).addClass("hidden");_47a.add(_48d,"hidden");_47a.add(_48e,"hidden");}var ptr=this._mediaPtr;if(ptr===0){_47a.add(_48d,"hidden");}else{_47a.remove(_48d,"hidden");}if(ptr===_48b-1){_47a.add(_48e,"hidden");}else{_47a.remove(_48e,"hidden");}this._destroyFrame();},_displayMedia:function(){var info=this._mediaInfos[this._mediaPtr],_491=info.title,_492=info.caption,_493=_477.query(".mediaSection .hzLine",this.domNode)[0];_479.set(this._mediaTitle,"innerHTML",_491);_47a[_491?"remove":"add"](this._mediaTitle,"hidden");_479.set(this._mediaCaption,"innerHTML",_492);_47a[_492?"remove":"add"](this._mediaCaption,"hidden");_47a[(_491&&_492)?"remove":"add"](_493,"hidden");this._rid=null;if(info.type==="image"){this._showImage(info.value);}else{var self=this,_494=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],_495=info.value.theme||this.chartTheme||"esri/dijit/Rainbow";if(lang.isString(_495)){_495=_495.replace(/\./gi,"/");if(_495.indexOf("/")===-1){_495="dojox/charting/themes/"+_495;}_494.push(_495);}try{var rid=(this._rid=_481++);_473(_494,function(_496,_497,_498){if(rid===self._rid){self._rid=null;self._showChart(info.type,info.value,_496,_497,_498);}});}catch(err){console.log("PopupRenderer: error loading modules");}}},_showImage:function(_499){_47a.add(this._mediaFrame,"image");var _49a=_47c.get(this._gallery,"height"),html="<img class='esriPopupMediaImage' src='"+_499.sourceURL+"' />";if(_499.linkURL){html="<a target='_blank' href='"+_499.linkURL+"'>"+html+"</a>";}_479.set(this._mediaFrame,"innerHTML",html);var img=_477.query(".esriPopupMediaImage",this._mediaFrame)[0],self=this,_49b;_49b=_475.connect(img,"onload",function(){_475.disconnect(_49b);_49b=null;self._imageLoaded(img,_49a);});},_showChart:function(type,_49c,_49d,_49e,_49f){_47a.remove(this._mediaFrame,"image");var _4a0=this._chart=new _49d(_47b.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});if(_49f){_4a0.setTheme(_49f);}switch(type){case "piechart":_4a0.addPlot("default",{type:"Pie",labels:false});_4a0.addSeries("Series A",_49c.fields);break;case "linechart":_4a0.addPlot("default",{type:"Markers"});_4a0.addAxis("x",{min:0,majorTicks:false,minorTicks:false,majorLabels:false,minorLabels:false});_4a0.addAxis("y",{includeZero:true,vertical:true,fixUpper:"minor"});_476.forEach(_49c.fields,function(info,idx){info.x=idx+1;});_4a0.addSeries("Series A",_49c.fields);break;case "columnchart":_4a0.addPlot("default",{type:"Columns",gap:3});_4a0.addAxis("y",{includeZero:true,vertical:true,fixUpper:"minor"});_4a0.addSeries("Series A",_49c.fields);break;case "barchart":_4a0.addPlot("default",{type:"Bars",gap:3});_4a0.addAxis("x",{includeZero:true,fixUpper:"minor",minorLabels:false});_4a0.addAxis("y",{vertical:true,majorTicks:false,minorTicks:false,majorLabels:false,minorLabels:false});_4a0.addSeries("Series A",_49c.fields);break;}this._action=new _49e(_4a0);_4a0.render();},_destroyFrame:function(){this._rid=null;if(this._chart){this._chart.destroy();this._chart=null;}if(this._action){this._action.destroy();this._action=null;}_479.set(this._mediaFrame,"innerHTML","");},_imageLoaded:function(img,_4a1){var _4a2=img.height;if(_4a2<_4a1){var diff=Math.round((_4a1-_4a2)/2);_47c.set(img,"marginTop",diff+"px");}},_attListHandler:function(dfd,_4a3){if(dfd===this._dfd){this._dfd=null;var html="";if(!(_4a3 instanceof Error)&&_4a3&&_4a3.length){_476.forEach(_4a3,function(info){html+=("<li>");html+=("<a href='"+info.url+"' target='_blank'>"+(info.name||"[No name]")+"</a>");html+=("</li>");});}_479.set(this._attachmentsList,"innerHTML",html||"<li>"+this._nls.NLS_noAttach+"</li>");}}});if(has("extend-esri")){lang.setObject("dijit._PopupRenderer",PR,_47f);}return PR;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _4a4={};lang.setObject("dojo.data.util.sorter",_4a4);_4a4.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_4a4.createSortFunction=function(_4a5,_4a6){var _4a7=[];function _4a8(attr,dir,comp,s){return function(_4a9,_4aa){var a=s.getValue(_4a9,attr);var b=s.getValue(_4aa,attr);return dir*comp(a,b);};};var _4ab;var map=_4a6.comparatorMap;var bc=_4a4.basicComparator;for(var i=0;i<_4a5.length;i++){_4ab=_4a5[i];var attr=_4ab.attribute;if(attr){var dir=(_4ab.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_4a7.push(_4a8(attr,dir,comp,_4a6));}}return function(rowA,rowB){var i=0;while(i<_4a7.length){var ret=_4a7[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _4a4;});},"esri/layers/KMLGroundOverlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_4ac,lang,has,_4ad,_4ae,_4af){var _4b0=_4ac([_4af],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(json){if(_4ae.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLGroundOverlay",_4b0,_4ad);}return _4b0;});},"esri/layers/MapImageLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_4b1,_4b2,lang,_4b3,_4b4,_4b5,_4b6,_4b7,has,_4b8,_4b9,_4ba,_4bb){var _4bc=_4b1([_4bb],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_4bd){this.inherited(arguments,[null,_4bd]);this._mapImages=[];this.registerConnectEvents("esri.layers.MapImageLayer",true);var _4be=lang.hitch;this._panStart=_4be(this,this._panStart);this._pan=_4be(this,this._pan);this._extentChange=_4be(this,this._extentChange);this._zoom=_4be(this,this._zoom);this._zoomStart=_4be(this,this._zoomStart);this._scale=_4be(this,this._scale);this._resize=_4be(this,this._resize);_4b2.connect(this,"onSuspend",this,this._onSuspend);_4b2.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_4b6._getDOMAccessor("transform"),addImage:function(_4bf){var _4c0=this._mapImages.push(_4bf);_4c0=_4c0-1;_4bf._idx=_4c0;_4bf._layer=this;if(this._div){this._createImage(_4bf,_4c0);}},removeImage:function(_4c1){if(_4c1){var idx=_4c1._idx,_4c2=this._mapImages;if(_4c2[idx]===_4c1){delete _4c2[idx];var node=_4c1._node;if(node){this._clearEvents(node);node.e_idx=node.e_bl=node.e_tr=node.e_l=node.e_t=node.e_w=node.e_h=null;if(node.parentNode){node.parentNode.removeChild(node);_4b4.destroy(node);}}_4c1._node=_4c1._idx=_4c1._layer=null;}}},removeAllImages:function(){var _4c3=this._mapImages,i,len=_4c3.length;for(i=0;i<len;i++){var _4c4=_4c3[i];if(_4c4){this.removeImage(_4c4);}}this._mapImages=[];},getImages:function(){var _4c5=this._mapImages,_4c6=[],i,len=_4c5.length;for(i=0;i<len;i++){if(_4c5[i]){_4c6.push(_4c5[i]);}}return _4c6;},setOpacity:function(_4c7){if(this.opacity!=_4c7){this._opacityChanged(this.opacity=_4c7);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_4c8){var div=this._div,i,len,_4c9;if(div){if(!has("ie")||has("ie")>8){_4b5.set(div,"opacity",_4c8);}else{_4c9=div.childNodes;len=_4c9.length;for(i=0;i<len;i++){_4b5.set(_4c9[i],"opacity",_4c8);}}}},_createImage:function(_4ca,idx){var node=_4b4.create("img");_4b5.set(node,{position:"absolute"});if(has("ie")<=8){_4b5.set(node,"opacity",this.opacity);}if(_4ca.rotation){var _4cb="rotate("+(360-_4ca.rotation)+"deg)";if(has("ie")<9){}else{_4b5.set(node,this._transform,_4cb);_4b5.set(node,"transform",_4cb);}}_4ca._node=node;node.e_idx=idx;node.e_layer=this;node.e_load=_4b2.connect(node,"onload",_4bc.prototype._imageLoaded);node.e_error=_4b2.connect(node,"onerror",_4bc.prototype._imageError);node.e_abort=_4b2.connect(node,"onabort",_4bc.prototype._imageError);node.src=_4ca.href;},_imageLoaded:function(evt,img){var node=img||evt.target||evt.currentTarget,self=node.e_layer,_4cc=self._mapImages[node.e_idx],map=self._map;if(map&&(map.__zooming||map.__panning||!self._sr)){self._standby.push(node);return;}self._clearEvents(node);if(!_4cc||_4cc._node!==node){return;}if(map){self._attach(_4cc);}},_imageError:function(evt){var node=evt.target||evt.currentTarget,self=node.e_layer,_4cd=self._mapImages[node.e_idx];self._clearEvents(node);if(_4cd){_4cd._node=null;}},_clearEvents:function(node){var _4ce=_4b2.disconnect;_4ce(node.e_load);_4ce(node.e_error);_4ce(node.e_abort);node.e_load=node.e_error=node.e_abort=node.e_layer=null;},_attach:function(_4cf){var _4d0=_4cf.extent,_4d1=_4d0.spatialReference,_4d2=this._sr,div=this._div,node=_4cf._node,_4d3=new _4b9({x:_4d0.xmin,y:_4d0.ymin,spatialReference:_4d1}),_4d4=new _4b9({x:_4d0.xmax,y:_4d0.ymax,spatialReference:_4d1});if(!_4d2.equals(_4d1)){if(_4d2.isWebMercator()&&_4d1.wkid===4326){_4d3=_4ba.geographicToWebMercator(_4d3);_4d4=_4ba.geographicToWebMercator(_4d4);}else{if(_4d1.isWebMercator()&&_4d2.wkid===4326){_4d3=_4ba.webMercatorToGeographic(_4d3);_4d4=_4ba.webMercatorToGeographic(_4d4);}}}node.e_bl=_4d3;node.e_tr=_4d4;if(_4cf.visible){this._setPos(node,div._left,div._top);(this._active||div).appendChild(node);}},_setPos:function(node,_4d5,_4d6){var _4d7=node.e_bl,_4d8=node.e_tr,map=this._map;_4d7=map.toScreen(_4d7);_4d8=map.toScreen(_4d8);var left=_4d7.x-_4d5,top=_4d8.y-_4d6,_4d9=Math.abs(_4d8.x-_4d7.x),_4da=Math.abs(_4d7.y-_4d8.y),css={width:_4d9+"px",height:_4da+"px"},_4db=this._mapImages[node.e_idx];if(map.navigationMode==="css-transforms"){css[_4b6._css.names.transform]=_4b6._css.translate(left,top)+(_4db.rotation?(" "+_4b6._css.rotate(360-_4db.rotation)):"");}else{css.left=left+"px";css.top=top+"px";}_4b5.set(node,css);node.e_l=left;node.e_t=top;node.e_w=_4d9;node.e_h=_4da;},managedSuspension:true,_setMap:function(map,_4dc){this.inherited(arguments);var div=this._div=_4b4.create("div",null,_4dc),_4dd=_4b6._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_4dd.transform]=_4b6._css.translate(vd.x,vd.y);_4b5.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_4b4.create("div",null,div);_4b5.set(this._active,css);this._passive=_4b4.create("div",null,div);_4b5.set(this._passive,css);}else{div._left=0;div._top=0;_4b5.set(div,css);}this._standby=[];var _4de=this._mapImages,i,len=_4de.length;for(i=0;i<len;i++){var _4df=_4de[i],node=_4df._node;if(!node){this._createImage(_4df,_4df._idx);}}_4b8.hide(div);return div;},_unsetMap:function(map,_4e0){this._disconnect();var div=this._div;if(div){var _4e1=this._mapImages,i,len=_4e1.length;for(i=0;i<len;i++){var _4e2=_4e1[i];if(_4e2){var node=_4e2._node;if(node){this._clearEvents(node);node.e_idx=node.e_bl=node.e_tr=node.e_l=node.e_t=node.e_w=node.e_h=null;}_4e2._node=null;}}_4e0.removeChild(div);_4b4.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_4b8.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_4b5.set(div,_4b6._css.names.transform,_4b6._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_4b8.show(div);},_connect:function(map){if(!this._connections){var _4e3=_4b2.connect,_4e4=(map.navigationMode==="css-transforms");this._connections=[_4e3(map,"onPanStart",this._panStart),_4e3(map,"onPan",this._pan),_4e3(map,"onExtentChange",this._extentChange),_4e4&&_4e3(map,"onZoomStart",this._zoomStart),_4e4?_4e3(map,"onScale",this._scale):_4e3(map,"onZoom",this._zoom),_4e4&&_4e3(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_4b3.forEach(this._connections,_4b2.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_4e5,_4e6){var div=this._div;div._left=this._panL+_4e6.x;div._top=this._panT+_4e6.y;if(this._map.navigationMode==="css-transforms"){_4b5.set(div,_4b6._css.names.transform,_4b6._css.translate(div._left,div._top));}else{_4b5.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4e7,_4e8,_4e9){if(_4e9){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4e8){this._pan(_4e7,_4e8);}}this._processStandbyList();},_processStandbyList:function(){var i,_4ea=this._standby;if(_4ea&&_4ea.length){for(i=_4ea.length-1;i>=0;i--){this._imageLoaded(null,_4ea[i]);_4ea.splice(i,1);}}},_redraw:function(_4eb){if(_4eb){var _4ec=this._passive,_4ed=_4b6._css.names;_4b5.set(_4ec,_4ed.transition,"none");this._moveImages(_4ec,this._active);_4b5.set(_4ec,_4ed.transform,"none");}var div=this._active||this._div,_4ee=this._div._left,_4ef=this._div._top,i,len=div.childNodes.length,node;for(i=0;i<len;i++){node=div.childNodes[i];this._setPos(node,_4ee,_4ef);}},_zoom:function(_4f0,_4f1,_4f2){var div=this._div,_4f3=div._left,_4f4=div._top,i,len=div.childNodes.length,node;for(i=0;i<len;i++){node=div.childNodes[i];var _4f5=node.e_w*_4f1,_4f6=node.e_h*_4f1,_4f7=(_4f2.x-_4f3-node.e_l)*(_4f5-node.e_w)/node.e_w,_4f8=(_4f2.y-_4f4-node.e_t)*(_4f6-node.e_h)/node.e_h;_4f7=isNaN(_4f7)?0:_4f7;_4f8=isNaN(_4f8)?0:_4f8;_4b5.set(node,{left:(node.e_l-_4f7)+"px",top:(node.e_t-_4f8)+"px",width:_4f5+"px",height:_4f6+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_4f9,dest){var _4fa=_4f9.childNodes,i,len=_4fa.length;if(len>0){for(i=len-1;i>=0;i--){dest.appendChild(_4fa[i]);}}},_scale:function(mtx,_4fb){var css={},_4fc=_4b6._css.names,_4fd=this._passive;_4b5.set(_4fd,_4fc.transition,_4fb?"none":(_4fc.transformName+" "+_4b7.defaults.map.zoomDuration+"ms ease"));css[_4fc.transform]=_4b6._css.matrix(mtx);_4b5.set(_4fd,_4fc.transform,_4b6._css.matrix(mtx));},_resize:function(_4fe,_4ff,_500){_4b5.set(this._active,{width:_4ff+"px",height:_500+"px"});_4b5.set(this._passive,{width:_4ff+"px",height:_500+"px"});}});if(has("extend-esri")){lang.setObject("layers.MapImageLayer",_4bc,_4b6);}return _4bc;});},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","esri/kernel"],function(lang,has,_501){var _502={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};if(has("extend-esri")){lang.setObject("tasks._SpatialRelationship",_502,_501);}return _502;});},"esri/layers/WebTiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_503,lang,_504,Url,has,_505,_506,_507,_508,_509,_50a,_50b){var _50c=_503(_50a,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_50d,_50e){if(!_50e){_50e={};}this.urlTemplate=_50d;var _50f=new _509(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _508({wkid:102100}));var _510=new _509(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _508({wkid:102100}));this.initialExtent=_50e.initialExtent||_50f;this.fullExtent=_50e.fullExtent||_510;if(_50e.tileInfo){this.tileInfo=_50e.tileInfo;}else{var lods=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _511=new _50b({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":lods});this.tileInfo=_511;}this.spatialReference=new _508(this.tileInfo.spatialReference.toJson());this.copyright=_50e.copyright||"";var url=new Url(_50d);var _512=url.scheme+"://"+url.authority+"/";this.urlPath=_50d.substring(_512.length);this.tileServers=_50e.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_512);}if(_50e.subDomains&&_50e.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_50e.subDomains;var _513;_504.forEach(_50e.subDomains,function(_514,idx){if(url.authority.indexOf("${subDomain}")>-1){_513=url.scheme+"://"+_505.substitute(url.authority,{subDomain:_514})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_513=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_514)+"/";}}this.tileServers.push(_513);},this);}this.tileServers=_504.map(this.tileServers,function(item){if(item.charAt(item.length-1)!=="/"){item+="/";}return item;});this._levelToLevelValue=[];_504.forEach(this.tileInfo.lods,function(item){this._levelToLevelValue[item.level]=item.levelValue?item.levelValue:item.level;},this);this.loaded=true;this.onLoad(this);this.registerConnectEvents("esri.layers.WebTiledLayer",true);},getTileUrl:function(_515,row,col){_515=this._levelToLevelValue[_515];var _516=this.tileServers[row%this.tileServers.length];var _517=_516+_505.substitute(this.urlPath,{level:_515,col:col,row:row});_517=_517.replace(/\{level\}/gi,_515);_517=_517.replace(/\{row\}/gi,row);_517=_517.replace(/\{col\}/gi,col);return _507.addProxy(_517);}});if(has("extend-esri")){lang.setObject("layers.WebTiledLayer",_50c,_506);}return _50c;});},"esri/layers/SnapshotMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_518,lang,has,_519,_51a,_51b,_51c){var _51d=_518([_51c],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_51e){this.featureLayer=_51e;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id = "+this.featureLayer.id);}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_51f){var _520=this.featureLayer,_521=_520.objectIdField,oid=_51f.attributes[_521];this._addFeatureIIf(oid,_51f);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _522=this.featureLayer;if(_522._collection){_522._fireUpdateStart();_522._refresh(true);_522._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_523){var id="_"+_523.name+_523.layerId+_523._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _524=this.featureLayer;if(_524._collection){return;}_524._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_525=this.featureLayer,_526=_525.getDefinitionExpression();var _527=new _51b();_527.outFields=_525.getOutFields();_527.where=_526||"1=1";_527.returnGeometry=true;_527.outSpatialReference=new _51a(map.spatialReference.toJson());_527.timeExtent=_525.getTimeDefinition();_527.maxAllowableOffset=_525._maxOffset;if(_525._ts){_527._ts=(new Date()).getTime();}var _528;if(_525._usePatch){_528=this._getRequestId(_525);this._cancelPendingRequest(null,_528);}_525._task.execute(_527,this._drawFeatures,this._queryErrorHandler,_528);},_drawFeatures:function(_529){this._purgeRequests();var _52a=_529.features,_52b=this.featureLayer,_52c=_52b.objectIdField,i,len=_52a.length,_52d,oid;for(i=0;i<len;i++){_52d=_52a[i];oid=_52d.attributes[_52c];this._addFeatureIIf(oid,_52d);this._incRefCount(oid);}this._applyTimeFilter(true);_52b._fireUpdateEnd(null,_529.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_529.exceededTransferLimit){_52b.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _52e=this.featureLayer;_52e._errorHandler(err);_52e._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_51d,_519);}return _51d;});},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_52f,lang,has,_530,_531){var _532=_52f([_531],{declaredClass:"esri.layers._SelectionMode",constructor:function(_533){this.featureLayer=_533;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_532,_530);}return _532;});},"esri/tasks/Task":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/deferredUtils","esri/urlUtils","esri/Evented"],function(_534,lang,_535,has,_536,_537,_538,_539){var Task=_534(_539,{declaredClass:"esri.tasks._Task",constructor:function(url){if(url&&lang.isString(url)){this._url=_538.urlToObject(this.url=url);}this.normalization=true;this._errorHandler=lang.hitch(this,this._errorHandler);this.registerConnectEvents("esri.tasks._Task",{"error":["error"]});},_useSSL:function(){var _53a=this._url,re=/^http:/i,rep="https:";if(this.url){this.url=this.url.replace(re,rep);}if(_53a&&_53a.path){_53a.path=_53a.path.replace(re,rep);}},_encode:function(_53b,_53c,_53d){var _53e,type,_53f={},i,p,pl;for(i in _53b){if(i==="declaredClass"){continue;}_53e=_53b[i];type=typeof _53e;if(_53e!==null&&_53e!==undefined&&type!=="function"){if(lang.isArray(_53e)){_53f[i]=[];pl=_53e.length;for(p=0;p<pl;p++){_53f[i][p]=this._encode(_53e[p]);}}else{if(type==="object"){if(_53e.toJson){var json=_53e.toJson(_53d&&_53d[i]);if(_53e.declaredClass==="esri.tasks.FeatureSet"){if(json.spatialReference){json.sr=json.spatialReference;delete json.spatialReference;}}_53f[i]=_53c?json:_535.toJson(json);}}else{_53f[i]=_53e;}}}}return _53f;},_successHandler:function(args,_540,_541,dfd){if(_540){this[_540].apply(this,args);}if(_541){_541.apply(null,args);}if(dfd){_537._resDfd(dfd,args);}},_errorHandler:function(err,_542,dfd){this.onError(err);if(_542){_542(err);}if(dfd){dfd.errback(err);}},setNormalization:function(_543){this.normalization=_543;},onError:function(){}});if(has("extend-esri")){_536.Task=Task;}return Task;});},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_544,_545){dojo.DeferredList=function(list,_546,_547,_548,_549){var _54a=[];_544.call(this);var self=this;if(list.length===0&&!_546){this.resolve([0,[]]);}var _54b=0;_545.forEach(list,function(item,i){item.then(function(_54c){if(_546){self.resolve([i,_54c]);}else{_54d(true,_54c);}},function(_54e){if(_547){self.reject(_54e);}else{_54d(false,_54e);}if(_548){return null;}throw _54e;});function _54d(_54f,_550){_54a[i]=[_54f,_550];_54b++;if(_54b===list.length){self.resolve(_54a);}};});};dojo.DeferredList.prototype=new _544();dojo.DeferredList.prototype.gatherResults=function(_551){var d=new dojo.DeferredList(_551,false,true,false);d.addCallback(function(_552){var ret=[];_545.forEach(_552,function(_553){ret.push(_553[1]);});return ret;});return d;};return dojo.DeferredList;});},"dijit/_OnDijitClickMixin":function(){define("dijit/_OnDijitClickMixin",["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window","./a11yclick"],function(on,_554,keys,_555,has,_556,win,_557){var ret=_555("dijit._OnDijitClickMixin",null,{connect:function(obj,_558,_559){return this.inherited(arguments,[obj,_558=="ondijitclick"?_557:_558,_559]);}});ret.a11yclick=_557;return ret;});},"dijit/a11yclick":function(){define("dijit/a11yclick",["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window"],function(on,_55a,keys,_55b,has,_55c,win){var _55d=null;if(has("dom-addeventlistener")){win.doc.addEventListener("keydown",function(evt){_55d=evt.target;},true);}else{(function(){var _55e=function(evt){_55d=evt.srcElement;};win.doc.attachEvent("onkeydown",_55e);_55c.addOnWindowUnload(function(){win.doc.detachEvent("onkeydown",_55e);});})();}function _55f(e){return (e.keyCode===keys.ENTER||e.keyCode===keys.SPACE)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey;};return function(node,_560){if(/input|button/i.test(node.nodeName)){return on(node,"click",_560);}else{var _561=[on(node,"keydown",function(e){if(_55f(e)){_55d=e.target;e.preventDefault();}}),on(node,"keyup",function(e){if(_55f(e)&&e.target==_55d){_55d=null;on.emit(e.target,"click",{cancelable:true,bubbles:true});}}),on(node,"click",function(e){_560.call(this,e);})];if(has("touch")){var _562;_561.push(on(node,"touchend",function(e){var _563=e.target;_562=setTimeout(function(){_562=null;on.emit(_563,"click",{cancelable:true,bubbles:true});},600);}),on(node,"click",function(e){if(_562){clearTimeout(_562);}}));}return {remove:function(){_55a.forEach(_561,function(h){h.remove();});if(_562){clearTimeout(_562);_562=null;}}};}};return ret;});},"esri/layers/WMSLayer":function(){define(["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_564,_565,_566,lang,_567,has,_568,_569,_56a,_56b,_56c,_56d,_56e){var _56f=_566([_56d],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_570){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_56a.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_570){this.imageFormat=this._getImageFormat(_570.format);this.imageTransparency=(_570.transparent===false)?false:true;this.visibleLayers=_570.visibleLayers?_570.visibleLayers:[];if(_570.resourceInfo){this._readResourceInfo(_570.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_564.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_571){_571=this._checkVisibleLayersList(_571);this.visibleLayers=_571?_571:[];this.refresh(true);},setImageFormat:function(_572){this.imageFormat=this._getImageFormat(_572);this.refresh(true);},setImageTransparency:function(_573){this.imageTransparency=_573;this.refresh(true);},getImageUrl:function(_574,_575,_576,_577){if(!this.visibleLayers||this.visibleLayers.length===0){_577(this._blankImageURL);return;}var wkid=_574.spatialReference.wkid;if(_567.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _578=_567.filter(this.spatialReferences,function(el){return (_567.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_578.length==0){_578=_567.filter(this.spatialReferences,function(el){return (_567.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_578.length>0){wkid=_578[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_567.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_574.xmin;var xmax=_574.xmax;var ymin=_574.ymin;var ymax=_574.ymax;var _579={};_579.SERVICE="WMS";_579.REQUEST="GetMap";_579.FORMAT=this.imageFormat;_579.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_579.STYLES="";_579.VERSION=this.version;_579.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_579.WIDTH=_575;_579.HEIGHT=_576;if(this.maxWidth<_575){_579.WIDTH=this.maxWidth;}if(this.maxHeight<_576){_579.HEIGHT=this.maxHeight;}var _57a=wkid?wkid:NaN;if(!isNaN(_57a)){if(this.version=="1.3.0"){_579.CRS="EPSG:"+_57a;}else{_579.SRS="EPSG:"+_57a;}}if(this.version=="1.3.0"&&this._useLatLong(_57a)){_579.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_579.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _57b=this.getMapURL,key;_57b+=(_57b.indexOf("?")==-1)?"?":"";for(key in _579){_57b+=(_57b.substring(_57b.length-1,_57b.length)=="?")?"":"&";_57b+=key+"="+_579[key];}_577(_56a.addProxy(_57b));},_initLayer:function(_57c,io){this.spatialReference=new _56b(this.extent.spatialReference);this.initialExtent=new _56c(this.extent);this.fullExtent=new _56c(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _57d=this._loadCallback;if(_57d){delete this._loadCallback;_57d(this);}},_readResourceInfo:function(_57e){if(!_57e.extent){console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo");return;}if(!_57e.layerInfos){console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo");return;}this.extent=_57e.extent;this.allExtents[0]=_57e.extent;this.layerInfos=_57e.layerInfos;this.description=_57e.description?_57e.description:"";this.copyright=_57e.copyright?_57e.copyright:"";this.title=_57e.title?_57e.title:"";this.getMapURL=_57e.getMapURL?_57e.getMapURL:this._getCapabilitiesURL;this.version=_57e.version?_57e.version:"1.3.0";this.maxWidth=_57e.maxWidth?_57e.maxWidth:5000;this.maxHeight=_57e.maxHeight?_57e.maxHeight:5000;this.spatialReferences=_57e.spatialReferences?_57e.spatialReferences:[];this.imageFormat=this._getImageFormat(_57e.format);this.setScaleRange(_57e.minScale,_57e.maxScale);this._initLayer();},_getCapabilities:function(){var _57f=this._url.query?this._url.query:{};_57f.SERVICE="WMS";_57f.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _57f){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_57f[key];}var _580=_569({url:uri,handleAs:"xml",load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _581=this._getTag("Service",xml);this.title=this._getTagValue("Title",_581,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_581,"");}this.copyright=this._getTagValue("AccessConstraints",_581,"");this.description=this._getTagValue("Abstract",_581,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_581,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_581,5000),10);var _582=this._getTag("Layer",xml);if(!_582){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _583=this._getLayerInfo(_582);if(_583){this.layerInfos=_583.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_583];}this.extent=_583.extent;this.allExtents=_583.allExtents;this.spatialReferences=_583.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _584=_565.query("DCPType",this._getTag("GetMap",xml));if(_584&&_584.length>0){var _585=_565.query("HTTP",_584[0]);if(_585&&_585.length>0){var _586=_565.query("Get",_585[0]);if(_586&&_586.length>0){var _587=this._getAttributeValue("OnlineResource","xlink:href",_586[0],null);if(_587){if(_587.indexOf("&")==(_587.length-1)){_587=_587.substring(0,_587.length-1);}this.getMapURL=_587;}}}}this.getMapFormats=[];if(_565.query("Operation",xml).length==0){_567.forEach(_565.query("Format",this._getTag("GetMap",xml)),function(_588){this.getMapFormats.push(_588.text?_588.text:_588.textContent);},this);}else{_567.forEach(_565.query("Operation",xml),function(_589){if(_589.getAttribute("name")=="GetMap"){_567.forEach(_565.query("Format",_589),function(_58a){this.getMapFormats.push(_58a.text?_58a.text:_58a.textContent);},this);}},this);}if(!_567.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_58b,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_58b);},_getLayerInfo:function(_58c){if(!_58c){return null;}var _58d=new _56e();_58d.name="";_58d.title="";_58d.description="";_58d.allExtents=[];_58d.spatialReferences=[];_58d.subLayers=[];var _58e=this._getTag("LatLonBoundingBox",_58c);if(_58e){_58d.allExtents[0]=this._getExtent(_58e,4326);}var _58f=this._getTag("EX_GeographicBoundingBox",_58c);if(_58f){var _590=new _56c(0,0,0,0,new _56b({wkid:4326}));_590.xmin=parseFloat(this._getTagValue("westBoundLongitude",_58f,0));_590.ymin=parseFloat(this._getTagValue("southBoundLatitude",_58f,0));_590.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_58f,0));_590.ymax=parseFloat(this._getTagValue("northBoundLatitude",_58f,0));_58d.allExtents[0]=_590;}_58d.extent=_58d.allExtents[0];var _591=(_567.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_567.forEach(_58c.childNodes,function(_592){if(_592.nodeName=="Name"){_58d.name=(_592.text?_592.text:_592.textContent)||"";}else{if(_592.nodeName=="Title"){_58d.title=(_592.text?_592.text:_592.textContent)||"";}else{if(_592.nodeName=="Abstract"){_58d.description=(_592.text?_592.text:_592.textContent)||"";}else{if(_592.nodeName=="BoundingBox"){var _593=_592.getAttribute(_591),wkid;if(_593&&_593.indexOf("EPSG:")===0){wkid=parseInt(_593.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _594;if(this.version=="1.3.0"){_594=this._getExtent(_592,wkid,this._useLatLong(wkid));}else{_594=this._getExtent(_592,wkid);}_58d.allExtents[wkid]=_594;if(!_58d.extent){_58d.extent=_594;}}}else{if(_593&&_593.indexOf("CRS:")===0){wkid=parseInt(_593.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_58d.allExtents[wkid]=this._getExtent(_592,wkid);}}else{wkid=parseInt(_593,10);if(wkid!==0&&!isNaN(wkid)){_58d.allExtents[wkid]=this._getExtent(_592,wkid);}}}}else{if(_592.nodeName==_591){var _595=_592.text?_592.text:_592.textContent;var arr=_595.split(" ");_567.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_567.indexOf(_58d.spatialReferences,val)==-1){_58d.spatialReferences.push(val);}}},this);}else{if(_592.nodeName=="Style"){var _596=this._getTag("LegendURL",_592);if(_596){var _597=this._getTag("OnlineResource",_596);if(_597){_58d.legendURL=_597.getAttribute("xlink:href");}}}else{if(_592.nodeName==="Layer"){_58d.subLayers.push(this._getLayerInfo(_592));}}}}}}}},this);return _58d;},_getImageFormat:function(_598){var _599=_598?_598.toLowerCase():"";switch(_599){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _59a=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_59a){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_59b,wkid,_59c){var _59d;if(_59b){_59d=new _56c();var minx=parseFloat(_59b.getAttribute("minx"));var miny=parseFloat(_59b.getAttribute("miny"));var maxx=parseFloat(_59b.getAttribute("maxx"));var maxy=parseFloat(_59b.getAttribute("maxy"));if(_59c){_59d.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_59d.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_59d.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_59d.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_59d.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_59d.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_59d.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_59d.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_59d.spatialReference=new _56b({wkid:wkid});}return _59d;},_useLatLong:function(wkid){var _59e,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _59f=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_59f[0]&&wkid<=_59f[1]){_59e=true;break;}}return _59e;},_getTag:function(_5a0,xml){var tags=_565.query(_5a0,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_5a1,xml,_5a2){var _5a3=_565.query(_5a1,xml);if(_5a3&&_5a3.length>0){if(_5a3[0].text){return _5a3[0].text;}else{return _5a3[0].textContent;}}else{return _5a2;}},_getAttributeValue:function(_5a4,_5a5,xml,_5a6){var _5a7=_565.query(_5a4,xml);if(_5a7&&_5a7.length>0){return _5a7[0].getAttribute(_5a5);}else{return _5a6;}},_checkVisibleLayersList:function(_5a8){if(_5a8&&_5a8.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _5a8[0])=="number"){var list=[];_567.forEach(_5a8,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_5a8=list;}}return _5a8;},_stripParameters:function(url,_5a9){var obj=_56a.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_567.indexOf(_5a9,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_56f,_568);}return _56f;});},"dijit/hccss":function(){define("dijit/hccss",["dojo/dom-class","dojo/hccss","dojo/ready","dojo/_base/window"],function(_5aa,has,_5ab,win){_5ab(90,function(){if(has("highcontrast")){_5aa.add(win.body(),"dijit_a11y");}});return has;});},"dijit/_TemplatedMixin":function(){define("dijit/_TemplatedMixin",["dojo/_base/lang","dojo/touch","./_WidgetBase","dojo/string","dojo/cache","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/sniff","dojo/_base/unload"],function(lang,_5ac,_5ad,_5ae,_5af,_5b0,_5b1,_5b2,has,_5b3){var _5b4=_5b1("dijit._TemplatedMixin",null,{templateString:null,templatePath:null,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[];},_stringRepl:function(tmpl){var _5b5=this.declaredClass,_5b6=this;return _5ae.substitute(tmpl,this,function(_5b7,key){if(key.charAt(0)=="!"){_5b7=lang.getObject(key.substr(1),false,_5b6);}if(typeof _5b7=="undefined"){throw new Error(_5b5+" template:"+key);}if(_5b7==null){return "";}return key.charAt(0)=="!"?_5b7:_5b7.toString().replace(/"/g,"&quot;");},this);},buildRendering:function(){if(!this.templateString){this.templateString=_5af(this.templatePath,{sanitize:true});}var _5b8=_5b4.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);var node;if(lang.isString(_5b8)){node=_5b2.toDom(this._stringRepl(_5b8),this.ownerDocument);if(node.nodeType!=1){throw new Error("Invalid template: "+_5b8);}}else{node=_5b8.cloneNode(true);}this.domNode=node;this.inherited(arguments);this._attachTemplateNodes(node,function(n,p){return n.getAttribute(p);});this._beforeFillContent();this._fillContent(this.srcNodeRef);},_beforeFillContent:function(){},_fillContent:function(_5b9){var dest=this.containerNode;if(_5b9&&dest){while(_5b9.hasChildNodes()){dest.appendChild(_5b9.firstChild);}}},_attachTemplateNodes:function(_5ba,_5bb){var _5bc=lang.isArray(_5ba)?_5ba:(_5ba.all||_5ba.getElementsByTagName("*"));var x=lang.isArray(_5ba)?0:-1;for(;x<0||_5bc[x];x++){var _5bd=(x==-1)?_5ba:_5bc[x];if(this.widgetsInTemplate&&(_5bb(_5bd,"dojoType")||_5bb(_5bd,"data-dojo-type"))){continue;}var _5be=_5bb(_5bd,"dojoAttachPoint")||_5bb(_5bd,"data-dojo-attach-point");if(_5be){var _5bf,_5c0=_5be.split(/\s*,\s*/);while((_5bf=_5c0.shift())){if(lang.isArray(this[_5bf])){this[_5bf].push(_5bd);}else{this[_5bf]=_5bd;}this._attachPoints.push(_5bf);}}var _5c1=_5bb(_5bd,"dojoAttachEvent")||_5bb(_5bd,"data-dojo-attach-event");if(_5c1){var _5c2,_5c3=_5c1.split(/\s*,\s*/);var trim=lang.trim;while((_5c2=_5c3.shift())){if(_5c2){var _5c4=null;if(_5c2.indexOf(":")!=-1){var _5c5=_5c2.split(":");_5c2=trim(_5c5[0]);_5c4=trim(_5c5[1]);}else{_5c2=trim(_5c2);}if(!_5c4){_5c4=_5c2;}this._attachEvents.push(this.connect(_5bd,_5ac[_5c2]||_5c2,_5c4));}}}}},destroyRendering:function(){_5b0.forEach(this._attachPoints,function(_5c6){delete this[_5c6];},this);this._attachPoints=[];_5b0.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments);}});_5b4._templateCache={};_5b4.getCachedTemplate=function(_5c7,_5c8,doc){var _5c9=_5b4._templateCache;var key=_5c7;var _5ca=_5c9[key];if(_5ca){try{if(!_5ca.ownerDocument||_5ca.ownerDocument==(doc||document)){return _5ca;}}catch(e){}_5b2.destroy(_5ca);}_5c7=_5ae.trim(_5c7);if(_5c8||_5c7.match(/\$\{([^\}]+)\}/g)){return (_5c9[key]=_5c7);}else{var node=_5b2.toDom(_5c7,doc);if(node.nodeType!=1){throw new Error("Invalid template: "+_5c7);}return (_5c9[key]=node);}};if(has("ie")){_5b3.addOnWindowUnload(function(){var _5cb=_5b4._templateCache;for(var key in _5cb){var _5cc=_5cb[key];if(typeof _5cc=="object"){_5b2.destroy(_5cc);}delete _5cb[key];}});}lang.extend(_5ad,{dojoAttachEvent:"",dojoAttachPoint:""});return _5b4;});},"esri/tasks/GeometryService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/has","esri/kernel","esri/request","esri/deferredUtils","esri/tasks/Task","esri/geometry/Extent","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Multipoint","esri/geometry/jsonUtils"],function(_5cd,lang,_5ce,_5cf,_5d0,has,_5d1,_5d2,_5d3,Task,_5d4,_5d5,_5d6,_5d7,_5d8){var _5d9=_5cd(Task,{declaredClass:"esri.tasks.GeometryService",constructor:function(url){var _5da=lang.hitch;this._projectHandler=_5da(this,this._projectHandler);this._simplifyHandler=_5da(this,this._simplifyHandler);this._bufferHandler=_5da(this,this._bufferHandler);this._areasAndLengthsHandler=_5da(this,this._areasAndLengthsHandler);this._lengthsHandler=_5da(this,this._lengthsHandler);this._labelPointsHandler=_5da(this,this._labelPointsHandler);this._relationHandler=_5da(this,this._relationHandler);this._convexHullHandler=_5da(this,this._convexHullHandler);this._unionHandler=_5da(this,this._unionHandler);this._autoCompleteHandler=_5da(this,this._autoCompleteHandler);this._reshapeHandler=_5da(this,this._reshapeHandler);this._cutHandler=_5da(this,this._cutHandler);this._intersectHandler=_5da(this,this._intersectHandler);this._differenceHandler=_5da(this,this._differenceHandler);this._trimExtendHandler=_5da(this,this._trimExtendHandler);this._densifyHandler=_5da(this,this._densifyHandler);this._generalizeHandler=_5da(this,this._densifyHandler);this._offsetHandler=_5da(this,this._offsetHandler);this._distanceHandler=_5da(this,this._distanceHandler);this.registerConnectEvents("esri.tasks.GeometryService",{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]});},_encodeGeometries:function(_5db){var gs=[],i,il=_5db.length;for(i=0;i<il;i++){gs.push(_5db[i].toJson());}return {geometryType:_5d8.getJsonType(_5db[0]),geometries:gs};},_decodeGeometries:function(_5dc,_5dd,sr){var _5de=_5d8.getGeometryType(_5dd),_5df=_5dc.geometries,fs=[],_5e0={spatialReference:sr.toJson()},_5e1=lang.mixin;_5ce.forEach(_5df,function(g,i){fs[i]=new _5de(_5e1(g,_5e0));});return fs;},_toProjectGeometry:function(_5e2){var sr=_5e2.spatialReference.toJson();if(_5e2 instanceof _5d4){return new _5d6({rings:[[[_5e2.xmin,_5e2.ymin],[_5e2.xmin,_5e2.ymax],[_5e2.xmax,_5e2.ymax],[_5e2.xmax,_5e2.ymin],[_5e2.xmin,_5e2.ymin]]],spatialReference:sr});}else{return new _5d5({paths:[[].concat(_5e2.points)],spatialReference:sr});}},_fromProjectedGeometry:function(_5e3,_5e4,_5e5){if(_5e4==="esriGeometryEnvelope"){var ring=_5e3.rings[0];return new _5d4(ring[0][0],ring[0][1],ring[2][0],ring[2][1],_5e5);}else{return new _5d7({points:_5e3.paths[0],spatialReference:_5e5.toJson()});}},project:function(_5e6,_5e7,_5e8,_5e9){var _5ea=lang.mixin({},this._url.query,{f:"json"}),_5eb;if(!_5e6.geometries){_5eb=_5e6[0];_5ea=lang.mixin(_5ea,{outSR:_5e7.wkid||_5cf.toJson(_5e7.toJson()),inSR:_5eb.spatialReference.wkid||_5cf.toJson(_5eb.spatialReference.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_5e6))});}else{_5e9=_5e8;_5e8=_5e7;_5e7=_5e6.outSR;_5eb=_5e6.geometries[0];_5ea=lang.mixin(_5ea,_5e6.toJson());}var _5ec=_5d8.getJsonType(_5eb),_5ed=this._projectHandler,_5ee=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/project",content:_5ea,callbackParamName:"callback",load:function(r,i){_5ed(r,i,_5ec,_5e7,_5e8,_5e9,dfd);},error:function(r){_5ee(r,_5e9,dfd);}});return dfd;},_projectHandler:function(_5ef,io,_5f0,_5f1,_5f2,_5f3,dfd){try{var fs=this._decodeGeometries(_5ef,_5f0,_5f1);this._successHandler([fs],"onProjectComplete",_5f2,dfd);}catch(err){this._errorHandler(err,_5f3,dfd);}},onProjectComplete:function(){},simplify:function(_5f4,_5f5,_5f6){var _5f7=_5f4[0].spatialReference;var _5f8=lang.mixin({},this._url.query,{f:"json",sr:_5f7.wkid?_5f7.wkid:_5cf.toJson(_5f7.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_5f4))}),_5f9=_5d8.getJsonType(_5f4[0]),_5fa=this._simplifyHandler,_5fb=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/simplify",content:_5f8,callbackParamName:"callback",load:function(r,i){_5fa(r,i,_5f9,_5f7,_5f5,_5f6,dfd);},error:function(r){_5fb(r,_5f6,dfd);}});return dfd;},_simplifyHandler:function(_5fc,io,_5fd,sr,_5fe,_5ff,dfd){try{var fs=this._decodeGeometries(_5fc,_5fd,sr);this._successHandler([fs],"onSimplifyComplete",_5fe,dfd);}catch(err){this._errorHandler(err,_5ff,dfd);}},onSimplifyComplete:function(){},convexHull:function(_600,_601,_602){var _603=_600[0].spatialReference;var _604=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_603.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_600))}),_605=this._convexHullHandler,_606=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/convexHull",content:_604,callbackParamName:"callback",load:function(r,i){_605(r,i,_603,_601,_602,dfd);},error:function(r){_606(r,_602,dfd);}});return dfd;},_convexHullHandler:function(_607,io,_608,_609,_60a,dfd){try{var geom=_5d8.fromJson(_607.geometry).setSpatialReference(_608);this._successHandler([geom],"onConvexHullComplete",_609,dfd);}catch(err){this._errorHandler(err,_60a,dfd);}},onConvexHullComplete:function(){},union:function(_60b,_60c,_60d){var _60e=_60b[0].spatialReference;var _60f=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_60e.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_60b))}),_610=this._unionHandler,_611=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/union",content:_60f,callbackParamName:"callback",load:function(r,i){_610(r,i,_60e,_60c,_60d,dfd);},error:function(r){_611(r,_60d,dfd);}});return dfd;},_unionHandler:function(_612,io,_613,_614,_615,dfd){try{var geom=_5d8.fromJson(_612.geometry).setSpatialReference(_613);this._successHandler([geom],"onUnionComplete",_614,dfd);}catch(err){this._errorHandler(err,_615,dfd);}},onUnionComplete:function(){},autoComplete:function(_616,_617,_618,_619){var _61a=_616[0].spatialReference;var _61b=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_61a.toJson()),polygons:_5cf.toJson(this._encodeGeometries(_616).geometries),polylines:_5cf.toJson(this._encodeGeometries(_617).geometries)}),_61c=this._autoCompleteHandler,_61d=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/autoComplete",content:_61b,callbackParamName:"callback",load:function(r,i){_61c(r,i,_61a,_618,_619,dfd);},error:function(r){_61d(r,_619,dfd);}});return dfd;},_autoCompleteHandler:function(_61e,io,_61f,_620,_621,dfd){try{var _622=_61e.geometries,_623=[],i,il=_622.length;for(i=0;i<il;i++){_623[i]=new _5d6({spatialReference:_61f,rings:_622[i].rings});}this._successHandler([_623],"onAutoCompleteComplete",_620,dfd);}catch(err){this._errorHandler(err,_621,dfd);}},onAutoCompleteComplete:function(){},reshape:function(_624,_625,_626,_627){var _628=_624.spatialReference;var _629=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_628.toJson()),target:_5cf.toJson({geometryType:_5d8.getJsonType(_624),geometry:_624.toJson()}),reshaper:_5cf.toJson(_625.toJson())}),_62a=this._reshapeHandler,_62b=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/reshape",content:_629,callbackParamName:"callback",load:function(r,i){_62a(r,i,_628,_626,_627,dfd);},error:function(r){_62b(r,_627,dfd);}});return dfd;},_reshapeHandler:function(_62c,io,_62d,_62e,_62f,dfd){try{var geom=_5d8.fromJson(_62c.geometry).setSpatialReference(_62d);this._successHandler([geom],"onReshapeComplete",_62e,dfd);}catch(err){this._errorHandler(err,_62f,dfd);}},onReshapeComplete:function(){},cut:function(_630,_631,_632,_633){var _634=_630[0].spatialReference;var _635=_5ce.map(_630,function(_636){return _636.toJson();});var _637=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_634.toJson()),target:_5cf.toJson({geometryType:_5d8.getJsonType(_630[0]),geometries:_635}),cutter:_5cf.toJson(_631.toJson())}),_638=this._cutHandler,_639=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/cut",content:_637,callbackParamName:"callback",load:function(r,i){_638(r,i,_634,_632,_633,dfd);},error:function(r){_639(r,_633,dfd);}});return dfd;},_cutHandler:function(_63a,io,_63b,_63c,_63d,dfd){try{var _63e=_63a.geometries;var _63f={};_63f.cutIndexes=_63a.cutIndexes;_63f.geometries=[];_5ce.forEach(_63e,function(geom){_63f.geometries.push(_5d8.fromJson(geom).setSpatialReference(_63b));});this._successHandler([_63f],"onCutComplete",_63c,dfd);}catch(err){this._errorHandler(err,_63d,dfd);}},onCutComplete:function(){},intersect:function(_640,_641,_642,_643){var _644=_640[0].spatialReference;var _645=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_644.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_640)),geometry:_5cf.toJson({geometryType:_5d8.getJsonType(_641),geometry:_641.toJson()})}),_646=this._intersectHandler,_647=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/intersect",content:_645,callbackParamName:"callback",load:function(r,i){_646(r,i,_644,_642,_643,dfd);},error:function(r){_647(r,_643,dfd);}});return dfd;},_intersectHandler:function(_648,io,_649,_64a,_64b,dfd){try{var _64c=_648.geometries,_64d=[];_5ce.forEach(_64c,function(geom){_64d.push(_5d8.fromJson(geom).setSpatialReference(_649));});this._successHandler([_64d],"onIntersectComplete",_64a,dfd);}catch(err){this._errorHandler(err,_64b,dfd);}},onIntersectComplete:function(){},difference:function(_64e,_64f,_650,_651){var _652=_64e[0].spatialReference;var _653=lang.mixin({},this._url.query,{f:"json",sr:_5cf.toJson(_652.toJson()),geometries:_5cf.toJson(this._encodeGeometries(_64e)),geometry:_5cf.toJson({geometryType:_5d8.getJsonType(_64f),geometry:_64f.toJson()})}),_654=this._differenceHandler,_655=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/difference",content:_653,callbackParamName:"callback",load:function(r,i){_654(r,i,_652,_650,_651,dfd);},error:function(r){_655(r,_651,dfd);}});return dfd;},_differenceHandler:function(_656,io,_657,_658,_659,dfd){try{var _65a=_656.geometries,_65b=[];_5ce.forEach(_65a,function(geom){_65b.push(_5d8.fromJson(geom).setSpatialReference(_657));});this._successHandler([_65b],"onDifferenceComplete",_658,dfd);}catch(err){this._errorHandler(err,_659,dfd);}},onDifferenceComplete:function(){},buffer:function(_65c,_65d,_65e){var _65f=lang.mixin({},this._url.query,{f:"json"},_65c.toJson()),sr=_65c.outSpatialReference||_65c.geometries[0].spatialReference,_660=this._bufferHandler,_661=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/buffer",content:_65f,callbackParamName:"callback",load:function(r,i){_660(r,i,sr,_65d,_65e,dfd);},error:function(r){_661(r,_65e,dfd);}});return dfd;},_bufferHandler:function(_662,io,sr,_663,_664,dfd){try{var _665=_662.geometries,_666=[],i,il=_665.length;for(i=0;i<il;i++){_666[i]=new _5d6({spatialReference:sr,rings:_665[i].rings});}this._successHandler([_666],"onBufferComplete",_663,dfd);}catch(err){this._errorHandler(err,_664,dfd);}},onBufferComplete:function(){},areasAndLengths:function(_667,_668,_669){var _66a=lang.mixin({},this._url.query,{f:"json"},_667.toJson()),_66b=this._areasAndLengthsHandler,_66c=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/areasAndLengths",content:_66a,callbackParamName:"callback",load:function(r,i){_66b(r,i,_668,_669,dfd);},error:function(r){_66c(r,_669,dfd);}});return dfd;},_areasAndLengthsHandler:function(_66d,io,_66e,_66f,dfd){try{this._successHandler([_66d],"onAreasAndLengthsComplete",_66e,dfd);}catch(err){this._errorHandler(err,_66f,dfd);}},onAreasAndLengthsComplete:function(){},lengths:function(_670,_671,_672){var _673=lang.mixin({},this._url.query,{f:"json"},_670.toJson()),_674=this._lengthsHandler,_675=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/lengths",content:_673,callbackParamName:"callback",load:function(r,i){_674(r,i,_671,_672,dfd);},error:function(r){_675(r,_672,dfd);}});return dfd;},_lengthsHandler:function(_676,io,_677,_678,dfd){try{this._successHandler([_676],"onLengthsComplete",_677,dfd);}catch(err){this._errorHandler(err,_678,dfd);}},onLengthsComplete:function(){},labelPoints:function(_679,_67a,_67b){var _67c=_5ce.map(_679,function(geom){return geom.toJson();});var sr=_679[0].spatialReference,_67d=lang.mixin({},this._url.query,{f:"json",sr:sr.wkid?sr.wkid:_5cf.toJson(sr.toJson()),polygons:_5cf.toJson(_67c)}),_67e=this._labelPointsHandler,_67f=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/labelPoints",content:_67d,callbackParamName:"callback",load:function(r,i){_67e(r,i,_679,sr,_67a,_67b,dfd);},error:function(r){_67f(r,_67b,dfd);}});return dfd;},_labelPointsHandler:function(_680,io,_681,sr,_682,_683,dfd){try{var _684=_680.labelPoints,_685=[];_5ce.forEach(_684,function(geom){_685.push(_5d8.fromJson(geom).setSpatialReference(sr));});this._successHandler([_685],"onLabelPointsComplete",_682,dfd);}catch(err){this._errorHandler(err,_683,dfd);}},onLabelPointsComplete:function(){},relation:function(_686,_687,_688){var _689=lang.mixin({},this._url.query,{f:"json"},_686.toJson()),_68a=this._relationHandler,_68b=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/relation",content:_689,callbackParamName:"callback",load:function(r,i){_68a(r,i,_687,_688,dfd);},error:function(r){_68b(r,_688,dfd);}});return dfd;},_relationHandler:function(_68c,io,_68d,_68e,dfd){try{var _68f=_68c.relations;this._successHandler([_68f],"onRelationComplete",_68d,dfd);}catch(err){this._errorHandler(err,_68e,dfd);}},onRelationComplete:function(){},trimExtend:function(_690,_691,_692){var _693=lang.mixin({},this._url.query,{f:"json"},_690.toJson()),_694=_690.sr,_695=this._trimExtendHandler,_696=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/trimExtend",content:_693,callbackParamName:"callback",load:function(r,i){_695(r,i,_694,_691,_692,dfd);},error:function(r){_696(r,_692,dfd);}});return dfd;},_trimExtendHandler:function(_697,io,_698,_699,_69a,dfd){try{var _69b=_697.geometries,_69c=[],i,il=_69b.length;for(i=0;i<il;i++){_69c[i]=new _5d5({spatialReference:_698,paths:_69b[i].paths});}this._successHandler([_69c],"onTrimExtendComplete",_699,dfd);}catch(err){this._errorHandler(err,_69a,dfd);}},onTrimExtendComplete:function(){},densify:function(_69d,_69e,_69f){var _6a0=lang.mixin({},this._url.query,{f:"json"},_69d.toJson()),_6a1=_69d.geometries[0].spatialReference,_6a2=this._densifyHandler,_6a3=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/densify",content:_6a0,callbackParamName:"callback",load:function(r,i){_6a2(r,i,_6a1,_69e,_69f,dfd);},error:function(r){_6a3(r,_69f,dfd);}});return dfd;},_densifyHandler:function(_6a4,io,_6a5,_6a6,_6a7,dfd){try{var _6a8=_6a4.geometries,_6a9=[];_5ce.forEach(_6a8,function(geom){_6a9.push(_5d8.fromJson(geom).setSpatialReference(_6a5));});this._successHandler([_6a9],"onDensifyComplete",_6a6,dfd);}catch(err){this._errorHandler(err,_6a7,dfd);}},onDensifyComplete:function(){},generalize:function(_6aa,_6ab,_6ac){var _6ad=lang.mixin({},this._url.query,{f:"json"},_6aa.toJson()),_6ae=_6aa.geometries[0].spatialReference,_6af=this._generalizeHandler,_6b0=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/generalize",content:_6ad,callbackParamName:"callback",load:function(r,i){_6af(r,i,_6ae,_6ab,_6ac,dfd);},error:function(r){_6b0(r,_6ac,dfd);}});return dfd;},_generalizeHandler:function(_6b1,io,_6b2,_6b3,_6b4,dfd){try{var _6b5=_6b1.geometries,_6b6=[];_5ce.forEach(_6b5,function(geom){_6b6.push(_5d8.fromJson(geom).setSpatialReference(_6b2));});this._successHandler([_6b6],"onGeneralizeComplete",_6b3,dfd);}catch(err){this._errorHandler(err,_6b4,dfd);}},onGeneralizeComplete:function(){},offset:function(_6b7,_6b8,_6b9){var _6ba=lang.mixin({},this._url.query,{f:"json"},_6b7.toJson()),_6bb=_6b7.geometries[0].spatialReference,_6bc=this._offsetHandler,_6bd=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/offset",content:_6ba,callbackParamName:"callback",load:function(r,i){_6bc(r,i,_6bb,_6b8,_6b9,dfd);},error:function(r){_6bd(r,_6b9,dfd);}});return dfd;},_offsetHandler:function(_6be,io,_6bf,_6c0,_6c1,dfd){try{var _6c2=_6be.geometries,_6c3=[];_5ce.forEach(_6c2,function(geom){_6c3.push(_5d8.fromJson(geom).setSpatialReference(_6bf));});this._successHandler([_6c3],"onOffsetComplete",_6c0,dfd);}catch(err){this._errorHandler(err,_6c1,dfd);}},onOffsetComplete:function(){},distance:function(_6c4,_6c5,_6c6){var _6c7=lang.mixin({},this._url.query,{f:"json"},_6c4.toJson()),_6c8=_6c4.geometry1.spatialReference,_6c9=this._distanceHandler,_6ca=this._errorHandler,dfd=new _5d0(_5d3._dfdCanceller);dfd._pendingDfd=_5d2({url:this._url.path+"/distance",content:_6c7,callbackParamName:"callback",load:function(r,i){_6c9(r,i,_6c8,_6c5,_6c6,dfd);},error:function(r){_6ca(r,_6c6,dfd);}});return dfd;},_distanceHandler:function(_6cb,io,_6cc,_6cd,_6ce,dfd){try{_6cb=_6cb&&_6cb.distance;this._successHandler([_6cb],"onDistanceComplete",_6cd,dfd);}catch(err){this._errorHandler(err,_6ce,dfd);}},onDistanceComplete:function(){}});lang.mixin(_5d9,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});if(has("extend-esri")){lang.setObject("tasks.GeometryService",_5d9,_5d1);}return _5d9;});},"dojo/parser":function(){define(["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./_base/html","./_base/window","./_base/url","./_base/json","./aspect","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(_6cf,dojo,_6d0,_6d1,_6d2,_6d3,_6d4,_6d5,_6d6,_6d7,_6d8,_6d9,has,_6da,don,_6db){new Date("X");var _6dc=0;_6d7.after(_6d0,"extend",function(){_6dc++;},true);function _6dd(ctor){var map=ctor._nameCaseMap,_6de=ctor.prototype;if(!map||map._extendCnt<_6dc){map=ctor._nameCaseMap={};for(var name in _6de){if(name.charAt(0)==="_"){continue;}map[name.toLowerCase()]=name;}map._extendCnt=_6dc;}return map;};var _6df={};function _6e0(_6e1){var ts=_6e1.join();if(!_6df[ts]){var _6e2=[];for(var i=0,l=_6e1.length;i<l;i++){var t=_6e1[i];_6e2[_6e2.length]=(_6df[t]=_6df[t]||(_6d0.getObject(t)||(~t.indexOf("/")&&_6cf(t))));}var ctor=_6e2.shift();_6df[ts]=_6e2.length?(ctor.createSubclass?ctor.createSubclass(_6e2):ctor.extend.apply(ctor,_6e2)):ctor;}return _6df[ts];};var _6e3={_clearCache:function(){_6dc++;_6df={};},_functionFromScript:function(_6e4,_6e5){var _6e6="",_6e7="",_6e8=(_6e4.getAttribute(_6e5+"args")||_6e4.getAttribute("args")),_6e9=_6e4.getAttribute("with");var _6ea=(_6e8||"").split(/\s*,\s*/);if(_6e9&&_6e9.length){_6d1.forEach(_6e9.split(/\s*,\s*/),function(part){_6e6+="with("+part+"){";_6e7+="}";});}return new Function(_6ea,_6e6+_6e4.innerHTML+_6e7);},instantiate:function(_6eb,_6ec,_6ed){_6ec=_6ec||{};_6ed=_6ed||{};var _6ee=(_6ed.scope||dojo._scopeName)+"Type",_6ef="data-"+(_6ed.scope||dojo._scopeName)+"-",_6f0=_6ef+"type",_6f1=_6ef+"mixins";var list=[];_6d1.forEach(_6eb,function(node){var type=_6ee in _6ec?_6ec[_6ee]:node.getAttribute(_6f0)||node.getAttribute(_6ee);if(type){var _6f2=node.getAttribute(_6f1),_6f3=_6f2?[type].concat(_6f2.split(/\s*,\s*/)):[type];list.push({node:node,types:_6f3});}});return this._instantiate(list,_6ec,_6ed);},_instantiate:function(_6f4,_6f5,_6f6){var _6f7=_6d1.map(_6f4,function(obj){var ctor=obj.ctor||_6e0(obj.types);if(!ctor){throw new Error("Unable to resolve constructor for: '"+obj.types.join()+"'");}return this.construct(ctor,obj.node,_6f5,_6f6,obj.scripts,obj.inherited);},this);if(!_6f5._started&&!_6f6.noStart){_6d1.forEach(_6f7,function(_6f8){if(typeof _6f8.startup==="function"&&!_6f8._started){_6f8.startup();}});}return _6f7;},construct:function(ctor,node,_6f9,_6fa,_6fb,_6fc){var _6fd=ctor&&ctor.prototype;_6fa=_6fa||{};var _6fe={};if(_6fa.defaults){_6d0.mixin(_6fe,_6fa.defaults);}if(_6fc){_6d0.mixin(_6fe,_6fc);}var _6ff;if(has("dom-attributes-explicit")){_6ff=node.attributes;}else{if(has("dom-attributes-specified-flag")){_6ff=_6d1.filter(node.attributes,function(a){return a.specified;});}else{var _700=/^input$|^img$/i.test(node.nodeName)?node:node.cloneNode(false),_701=_700.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");_6ff=_6d1.map(_701.split(/\s+/),function(name){var _702=name.toLowerCase();return {name:name,value:(node.nodeName=="LI"&&name=="value")||_702=="enctype"?node.getAttribute(_702):node.getAttributeNode(_702).value};});}}var _703=_6fa.scope||dojo._scopeName,_704="data-"+_703+"-",hash={};if(_703!=="dojo"){hash[_704+"props"]="data-dojo-props";hash[_704+"type"]="data-dojo-type";hash[_704+"mixins"]="data-dojo-mixins";hash[_703+"type"]="dojoType";hash[_704+"id"]="data-dojo-id";}var i=0,item,_705=[],_706,_707;while(item=_6ff[i++]){var name=item.name,_708=name.toLowerCase(),_709=item.value;switch(hash[_708]||_708){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":_707=_709;break;case "data-dojo-id":case "jsid":_706=_709;break;case "data-dojo-attach-point":case "dojoattachpoint":_6fe.dojoAttachPoint=_709;break;case "data-dojo-attach-event":case "dojoattachevent":_6fe.dojoAttachEvent=_709;break;case "class":_6fe["class"]=node.className;break;case "style":_6fe["style"]=node.style&&node.style.cssText;break;default:if(!(name in _6fd)){var map=_6dd(ctor);name=map[_708]||name;}if(name in _6fd){switch(typeof _6fd[name]){case "string":_6fe[name]=_709;break;case "number":_6fe[name]=_709.length?Number(_709):NaN;break;case "boolean":_6fe[name]=_709.toLowerCase()!="false";break;case "function":if(_709===""||_709.search(/[^\w\.]+/i)!=-1){_6fe[name]=new Function(_709);}else{_6fe[name]=_6d0.getObject(_709,false)||new Function(_709);}_705.push(name);break;default:var pVal=_6fd[name];_6fe[name]=(pVal&&"length" in pVal)?(_709?_709.split(/\s*,\s*/):[]):(pVal instanceof Date)?(_709==""?new Date(""):_709=="now"?new Date():_6d8.fromISOString(_709)):(pVal instanceof _6d5)?(dojo.baseUrl+_709):_6d6.fromJson(_709);}}else{_6fe[name]=_709;}}}for(var j=0;j<_705.length;j++){var _70a=_705[j].toLowerCase();node.removeAttribute(_70a);node[_70a]=null;}if(_707){try{_707=_6d6.fromJson.call(_6fa.propsThis,"{"+_707+"}");_6d0.mixin(_6fe,_707);}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+_707+"'");}}_6d0.mixin(_6fe,_6f9);if(!_6fb){_6fb=(ctor&&(ctor._noScript||_6fd._noScript)?[]:_6da("> script[type^='dojo/']",node));}var _70b=[],_70c=[],_70d=[],ons=[];if(_6fb){for(i=0;i<_6fb.length;i++){var _70e=_6fb[i];node.removeChild(_70e);var _70f=(_70e.getAttribute(_704+"event")||_70e.getAttribute("event")),prop=_70e.getAttribute(_704+"prop"),_710=_70e.getAttribute(_704+"method"),_711=_70e.getAttribute(_704+"advice"),_712=_70e.getAttribute("type"),nf=this._functionFromScript(_70e,_704);if(_70f){if(_712=="dojo/connect"){_70b.push({method:_70f,func:nf});}else{if(_712=="dojo/on"){ons.push({event:_70f,func:nf});}else{_6fe[_70f]=nf;}}}else{if(_712=="dojo/aspect"){_70b.push({method:_710,advice:_711,func:nf});}else{if(_712=="dojo/watch"){_70d.push({prop:prop,func:nf});}else{_70c.push(nf);}}}}}var _713=ctor.markupFactory||_6fd.markupFactory;var _714=_713?_713(_6fe,node,ctor):new ctor(_6fe,node);if(_706){_6d0.setObject(_706,_714);}for(i=0;i<_70b.length;i++){_6d7[_70b[i].advice||"after"](_714,_70b[i].method,_6d0.hitch(_714,_70b[i].func),true);}for(i=0;i<_70c.length;i++){_70c[i].call(_714);}for(i=0;i<_70d.length;i++){_714.watch(_70d[i].prop,_70d[i].func);}for(i=0;i<ons.length;i++){don(_714,ons[i].event,ons[i].func);}return _714;},scan:function(root,_715){var list=[],mids=[],_716={};var _717=(_715.scope||dojo._scopeName)+"Type",_718="data-"+(_715.scope||dojo._scopeName)+"-",_719=_718+"type",_71a=_718+"textdir",_71b=_718+"mixins";var node=root.firstChild;var _71c=_715.inherited;if(!_71c){function _71d(node,attr){return (node.getAttribute&&node.getAttribute(attr))||(node.parentNode&&_71d(node.parentNode,attr));};_71c={dir:_71d(root,"dir"),lang:_71d(root,"lang"),textDir:_71d(root,_71a)};for(var key in _71c){if(!_71c[key]){delete _71c[key];}}}var _71e={inherited:_71c};var _71f;var _720;function _721(_722){if(!_722.inherited){_722.inherited={};var node=_722.node,_723=_721(_722.parent);var _724={dir:node.getAttribute("dir")||_723.dir,lang:node.getAttribute("lang")||_723.lang,textDir:node.getAttribute(_71a)||_723.textDir};for(var key in _724){if(_724[key]){_722.inherited[key]=_724[key];}}}return _722.inherited;};while(true){if(!node){if(!_71e||!_71e.node){break;}node=_71e.node.nextSibling;_720=false;_71e=_71e.parent;_71f=_71e.scripts;continue;}if(node.nodeType!=1){node=node.nextSibling;continue;}if(_71f&&node.nodeName.toLowerCase()=="script"){type=node.getAttribute("type");if(type&&/^dojo\/\w/i.test(type)){_71f.push(node);}node=node.nextSibling;continue;}if(_720){node=node.nextSibling;continue;}var type=node.getAttribute(_719)||node.getAttribute(_717);var _725=node.firstChild;if(!type&&(!_725||(_725.nodeType==3&&!_725.nextSibling))){node=node.nextSibling;continue;}var _726;var ctor=null;if(type){var _727=node.getAttribute(_71b),_728=_727?[type].concat(_727.split(/\s*,\s*/)):[type];try{ctor=_6e0(_728);}catch(e){}if(!ctor){_6d1.forEach(_728,function(t){if(~t.indexOf("/")&&!_716[t]){_716[t]=true;mids[mids.length]=t;}});}var _729=ctor&&!ctor.prototype._noScript?[]:null;_726={types:_728,ctor:ctor,parent:_71e,node:node,scripts:_729};_726.inherited=_721(_726);list.push(_726);}else{_726={node:node,scripts:_71f,parent:_71e};}node=_725;_71f=_729;_720=ctor&&ctor.prototype.stopParser&&!(_715.template);_71e=_726;}var d=new _6d9();if(mids.length){if(has("dojo-debug-messages")){console.warn("WARNING: Modules being Auto-Required: "+mids.join(", "));}_6cf(mids,function(){d.resolve(_6d1.filter(list,function(_72a){if(!_72a.ctor){try{_72a.ctor=_6e0(_72a.types);}catch(e){}}var _72b=_72a.parent;while(_72b&&!_72b.types){_72b=_72b.parent;}var _72c=_72a.ctor&&_72a.ctor.prototype;_72a.instantiateChildren=!(_72c&&_72c.stopParser&&!(_715.template));_72a.instantiate=!_72b||(_72b.instantiate&&_72b.instantiateChildren);return _72a.instantiate;}));});}else{d.resolve(list);}return d.promise;},_require:function(_72d){var hash=_6d6.fromJson("{"+_72d.innerHTML+"}"),vars=[],mids=[],d=new _6d9();for(var name in hash){vars.push(name);mids.push(hash[name]);}_6cf(mids,function(){for(var i=0;i<vars.length;i++){_6d0.setObject(vars[i],arguments[i]);}d.resolve(arguments);});return d.promise;},_scanAmd:function(root){var _72e=new _6d9(),_72f=_72e.promise;_72e.resolve(true);var self=this;_6da("script[type='dojo/require']",root).forEach(function(node){_72f=_72f.then(function(){return self._require(node);});node.parentNode.removeChild(node);});return _72f;},parse:function(_730,_731){var root;if(!_731&&_730&&_730.rootNode){_731=_730;root=_731.rootNode;}else{if(_730&&_6d0.isObject(_730)&&!("nodeType" in _730)){_731=_730;}else{root=_730;}}root=root?_6d3.byId(root):_6d4.body();_731=_731||{};var _732=_731.template?{template:true}:{},_733=[],self=this;var p=this._scanAmd(root,_731).then(function(){return self.scan(root,_731);}).then(function(_734){return _733=_733.concat(self._instantiate(_734,_732,_731));}).otherwise(function(e){console.error("dojo/parser::parse() error",e);throw e;});_6d0.mixin(_733,p);return _733;}};if(1){dojo.parser=_6e3;}if(_6d2.parseOnLoad){_6db(100,_6e3,"parse");}return _6e3;});},"dijit/_Widget":function(){define("dijit/_Widget",["dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/ready","./registry","./_WidgetBase","./_OnDijitClickMixin","./_FocusMixin","dojo/uacss","./hccss"],function(_735,_736,_737,_738,has,_739,lang,_73a,_73b,_73c,_73d,_73e,_73f){function _740(){};function _741(_742){return function(obj,_743,_744,_745){if(obj&&typeof _743=="string"&&obj[_743]==_740){return obj.on(_743.substring(2).toLowerCase(),lang.hitch(_744,_745));}return _742.apply(_737,arguments);};};_735.around(_737,"connect",_741);if(_739.connect){_735.around(_739,"connect",_741);}var _746=_738("dijit._Widget",[_73d,_73e,_73f],{onClick:_740,onDblClick:_740,onKeyDown:_740,onKeyPress:_740,onKeyUp:_740,onMouseDown:_740,onMouseMove:_740,onMouseOut:_740,onMouseOver:_740,onMouseLeave:_740,onMouseEnter:_740,onMouseUp:_740,constructor:function(_747){this._toConnect={};for(var name in _747){if(this[name]===_740){this._toConnect[name.replace(/^on/,"").toLowerCase()]=_747[name];delete _747[name];}}},postCreate:function(){this.inherited(arguments);for(var name in this._toConnect){this.on(name,this._toConnect[name]);}delete this._toConnect;},on:function(type,func){if(this[this._onMap(type)]===_740){return _737.connect(this.domNode,type.toLowerCase(),this,func);}return this.inherited(arguments);},_setFocusedAttr:function(val){this._focused=val;this._set("focused",val);},setAttribute:function(attr,_748){_739.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(attr,_748);},attr:function(name,_749){if(_736.isDebug){var _74a=arguments.callee._ach||(arguments.callee._ach={}),_74b=(arguments.callee.caller||"unknown caller").toString();if(!_74a[_74b]){_739.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+_74b,"","2.0");_74a[_74b]=true;}}var args=arguments.length;if(args>=2||typeof name==="object"){return this.set.apply(this,arguments);}else{return this.get(name);}},getDescendants:function(){_739.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?_73a("[widgetId]",this.containerNode).map(_73c.byNode):[];},_onShow:function(){this.onShow();},onShow:function(){},onHide:function(){},onClose:function(){return true;}});if(has("dijit-legacy-requires")){_73b(0,function(){var _74c=["dijit/_base"];require(_74c);});}return _746;});},"dijit/focus":function(){define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/Stateful","dojo/_base/unload","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(_74d,_74e,dom,_74f,_750,_751,lang,on,_752,has,_753,_754,win,_755,a11y,_756,_757){var _758=_74e([_753,_751],{curNode:null,activeStack:[],constructor:function(){var _759=lang.hitch(this,function(node){if(dom.isDescendant(this.curNode,node)){this.set("curNode",null);}if(dom.isDescendant(this.prevNode,node)){this.set("prevNode",null);}});_74d.before(_750,"empty",_759);_74d.before(_750,"destroy",_759);},registerIframe:function(_75a){return this.registerWin(_75a.contentWindow,_75a);},registerWin:function(_75b,_75c){var _75d=this;var _75e=function(evt){_75d._justMouseDowned=true;setTimeout(function(){_75d._justMouseDowned=false;},0);if(has("ie")&&evt&&evt.srcElement&&evt.srcElement.parentNode==null){return;}_75d._onTouchNode(_75c||evt.target||evt.srcElement,"mouse");};var doc=has("ie")?_75b.document.documentElement:_75b.document;if(doc){if(has("ie")){_75b.document.body.attachEvent("onmousedown",_75e);var _75f=function(evt){var tag=evt.srcElement.tagName.toLowerCase();if(tag=="#document"||tag=="body"){return;}if(a11y.isTabNavigable(evt.srcElement)){_75d._onFocusNode(_75c||evt.srcElement);}else{_75d._onTouchNode(_75c||evt.srcElement);}};doc.attachEvent("onfocusin",_75f);var _760=function(evt){_75d._onBlurNode(_75c||evt.srcElement);};doc.attachEvent("onfocusout",_760);return {remove:function(){_75b.document.detachEvent("onmousedown",_75e);doc.detachEvent("onfocusin",_75f);doc.detachEvent("onfocusout",_760);doc=null;}};}else{doc.body.addEventListener("mousedown",_75e,true);doc.body.addEventListener("touchstart",_75e,true);var _761=function(evt){_75d._onFocusNode(_75c||evt.target);};doc.addEventListener("focus",_761,true);var _762=function(evt){_75d._onBlurNode(_75c||evt.target);};doc.addEventListener("blur",_762,true);return {remove:function(){doc.body.removeEventListener("mousedown",_75e,true);doc.body.removeEventListener("touchstart",_75e,true);doc.removeEventListener("focus",_761,true);doc.removeEventListener("blur",_762,true);doc=null;}};}}},_onBlurNode:function(node){if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);}this._clearFocusTimer=setTimeout(lang.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null);}),0);if(this._justMouseDowned){return;}if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);}this._clearActiveWidgetsTimer=setTimeout(lang.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([]);}),0);},_onTouchNode:function(node,by){if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);delete this._clearActiveWidgetsTimer;}var _763=[];try{while(node){var _764=_74f.get(node,"dijitPopupParent");if(_764){node=_756.byId(_764).domNode;}else{if(node.tagName&&node.tagName.toLowerCase()=="body"){if(node===win.body()){break;}node=_755.get(node.ownerDocument).frameElement;}else{var id=node.getAttribute&&node.getAttribute("widgetId"),_765=id&&_756.byId(id);if(_765&&!(by=="mouse"&&_765.get("disabled"))){_763.unshift(id);}node=node.parentNode;}}}}catch(e){}this._setStack(_763,by);},_onFocusNode:function(node){if(!node){return;}if(node.nodeType==9){return;}if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);delete this._clearFocusTimer;}this._onTouchNode(node);if(node==this.curNode){return;}this.set("prevNode",this.curNode);this.set("curNode",node);},_setStack:function(_766,by){var _767=this.activeStack;this.set("activeStack",_766);for(var _768=0;_768<Math.min(_767.length,_766.length);_768++){if(_767[_768]!=_766[_768]){break;}}var _769;for(var i=_767.length-1;i>=_768;i--){_769=_756.byId(_767[i]);if(_769){_769._hasBeenBlurred=true;_769.set("focused",false);if(_769._focusManager==this){_769._onBlur(by);}this.emit("widget-blur",_769,by);}}for(i=_768;i<_766.length;i++){_769=_756.byId(_766[i]);if(_769){_769.set("focused",true);if(_769._focusManager==this){_769._onFocus(by);}this.emit("widget-focus",_769,by);}}},focus:function(node){if(node){try{node.focus();}catch(e){}}}});var _76a=new _758();_752(function(){var _76b=_76a.registerWin(_755.get(win.doc));if(has("ie")){_754.addOnWindowUnload(function(){if(_76b){_76b.remove();_76b=null;}});}});_757.focus=function(node){_76a.focus(node);};for(var attr in _76a){if(!/^_/.test(attr)){_757.focus[attr]=typeof _76a[attr]=="function"?lang.hitch(_76a,attr):_76a[attr];}}_76a.watch(function(attr,_76c,_76d){_757.focus[attr]=_76d;});return _76a;});},"dijit/_FocusMixin":function(){define("dijit/_FocusMixin",["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(_76e,_76f,_770,lang){lang.extend(_76f,{focused:false,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus();},_onBlur:function(){this.onBlur();}});return _770("dijit._FocusMixin",null,{_focusManager:_76e});});},"esri/layers/MosaicRule":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/lang","esri/geometry/Point"],function(_771,lang,_772,has,_773,_774,_775){var _776=_771(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:false,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,constructor:function(_777){if(!lang.isObject(_777)){return;}lang.mixin(this,_777);if(_777.mosaicMethod){this.method=_777.mosaicMethod;}if(this.method&&this.method.toLowerCase().substring(0,4)!=="esri"){this.method=this._getMethodEnum(this.method);}if(_777.mosaicOperation){this.operation=_777.mosaicOperation;}if(this.operation&&this.operation.toUpperCase().substring(0,3)!=="MT_"){this.operation=this._getOperatorEnum(this.operation);}if(_777.fids){this.objectIds=_777.fids;}if(_777.viewpoint){this.viewpoint=new _775(_777.viewpoint);}},toJson:function(){var json={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue?_772.toJson(this.sortValue):null,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation};return _774.filter(json,function(_778){if(_778!==null){return true;}});},_getMethodEnum:function(_779){if(!_779){return;}var _77a=_776.METHOD_NONE;switch(_779.toLowerCase()){case "byattribute":_77a=_776.METHOD_ATTRIBUTE;break;case "center":_77a=_776.METHOD_CENTER;break;case "lockraster":_77a=_776.METHOD_LOCKRASTER;break;case "nadir":_77a=_776.METHOD_NADIR;break;case "northwest":_77a=_776.METHOD_NORTHWEST;break;case "seamline":_77a=_776.METHOD_SEAMLINE;break;case "viewpoint":_77a=_776.METHOD_VIEWPOINT;break;}return _77a;},_getOperatorEnum:function(_77b){if(!_77b){return;}switch(_77b.toLowerCase()){case "first":return _776.OPERATION_FIRST;case "last":return _776.OPERATION_LAST;case "max":return _776.OPERATION_MAX;case "min":return _776.OPERATION_MIN;case "blend":return _776.OPERATION_BLEND;case "mean":return _776.OPERATION_MEAN;}}});lang.mixin(_776,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});if(has("extend-esri")){lang.setObject("layers.MosaicRule",_776,_773);}return _776;});},"esri/tasks/QueryTask":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/_base/json","dojo/has","esri/kernel","esri/request","esri/deferredUtils","esri/geometry/normalizeUtils","esri/tasks/Task","esri/tasks/FeatureSet"],function(_77c,lang,_77d,_77e,_77f,has,_780,_781,_782,_783,Task,_784){var _785=_77c(Task,{declaredClass:"esri.tasks.QueryTask",constructor:function(url,_786){this._handler=lang.hitch(this,this._handler);this._relationshipQueryHandler=lang.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=lang.hitch(this,this._executeForIdsHandler);this._countHandler=lang.hitch(this,this._countHandler);this.source=_786&&_786.source;this.gdbVersion=_786&&_786.gdbVersion;this.registerConnectEvents("esri.tasks.QueryTask",{"complete":["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]});},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},execute:function(_787,_788,_789,_78a,_78b){var _78c=_78b.assembly,_78d=this._encode(lang.mixin({},this._url.query,{f:"json"},_787.toJson(_78c&&_78c[0]))),_78e=this._handler,_78f=this._errorHandler;if(this.source){var _790={source:this.source.toJson()};_78d.layer=_77f.toJson(_790);}if(this.gdbVersion){_78d.gdbVersion=this.gdbVersion;}return _781({url:this._url.path+"/query",content:_78d,callbackParamName:"callback",load:function(r,i){_78e(r,i,_788,_789,_78b.dfd);},error:function(r){_78f(r,_789,_78b.dfd);},callbackSuffix:_78a});},executeRelationshipQuery:function(_791,_792,_793){var _794=this._encode(lang.mixin({},this._url.query,{f:"json"},_791.toJson())),_795=this._relationshipQueryHandler,_796=this._errorHandler;if(this.gdbVersion){_794.gdbVersion=this.gdbVersion;}var dfd=new _77e(_782._dfdCanceller);dfd._pendingDfd=_781({url:this._url.path+"/queryRelatedRecords",content:_794,callbackParamName:"callback",load:function(r,i){_795(r,i,_792,_793,dfd);},error:function(r){_796(r,_793,dfd);}});return dfd;},executeForIds:function(_797,_798,_799,_79a){var _79b=_79a.assembly,_79c=this._encode(lang.mixin({},this._url.query,{f:"json",returnIdsOnly:true},_797.toJson(_79b&&_79b[0]))),_79d=this._executeForIdsHandler,_79e=this._errorHandler;if(this.source){var _79f={source:this.source.toJson()};_79c.layer=_77f.toJson(_79f);}if(this.gdbVersion){_79c.gdbVersion=this.gdbVersion;}return _781({url:this._url.path+"/query",content:_79c,callbackParamName:"callback",load:function(r,i){_79d(r,i,_798,_799,_79a.dfd);},error:function(r){_79e(r,_799,_79a.dfd);}});},executeForCount:function(_7a0,_7a1,_7a2,_7a3){var _7a4=_7a3.assembly,_7a5=this._encode(lang.mixin({},this._url.query,{f:"json",returnIdsOnly:true,returnCountOnly:true},_7a0.toJson(_7a4&&_7a4[0]))),_7a6=this._countHandler,_7a7=this._errorHandler;if(this.source){var _7a8={source:this.source.toJson()};_7a5.layer=_77f.toJson(_7a8);}if(this.gdbVersion){_7a5.gdbVersion=this.gdbVersion;}return _781({url:this._url.path+"/query",content:_7a5,callbackParamName:"callback",load:function(r,i){_7a6(r,i,_7a1,_7a2,_7a3.dfd);},error:function(r){_7a7(r,_7a2,_7a3.dfd);}});},_handler:function(_7a9,io,_7aa,_7ab,dfd){try{var _7ac=new _784(_7a9);this._successHandler([_7ac],"onComplete",_7aa,dfd);}catch(err){this._errorHandler(err,_7ab,dfd);}},_relationshipQueryHandler:function(_7ad,io,_7ae,_7af,dfd){try{var gt=_7ad.geometryType,sr=_7ad.spatialReference,_7b0={};_77d.forEach(_7ad.relatedRecordGroups,function(gr){var _7b1={};_7b1.geometryType=gt;_7b1.spatialReference=sr;_7b1.features=gr.relatedRecords;var fset=new _784(_7b1);_7b0[gr.objectId]=fset;});this._successHandler([_7b0],"onExecuteRelationshipQueryComplete",_7ae,dfd);}catch(err){this._errorHandler(err,_7af,dfd);}},_executeForIdsHandler:function(_7b2,io,_7b3,_7b4,dfd){try{this._successHandler([_7b2.objectIds],"onExecuteForIdsComplete",_7b3,dfd);}catch(err){this._errorHandler(err,_7b4,dfd);}},_countHandler:function(_7b5,io,_7b6,_7b7,dfd){try{var _7b8,_7b9=_7b5.features,ids=_7b5.objectIds;if(ids){_7b8=ids.length;}else{if(_7b9){throw new Error("Unable to perform query. Please check your parameters.");}else{_7b8=_7b5.count;}}this._successHandler([_7b8],"onExecuteForCountComplete",_7b6,dfd);}catch(err){this._errorHandler(err,_7b7,dfd);}}});_783._createWrappers(_785);if(has("extend-esri")){lang.setObject("tasks.QueryTask",_785,_780);}return _785;});},"esri/layers/ArcGISImageServiceLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/array","dojo/_base/json","dojo/_base/config","dojo/has","dojo/io-query","esri/kernel","esri/config","esri/lang","esri/request","esri/deferredUtils","esri/urlUtils","esri/geometry/Extent","esri/layers/MosaicRule","esri/layers/DynamicMapServiceLayer","esri/layers/TimeInfo","esri/layers/Field"],function(_7ba,lang,_7bb,_7bc,_7bd,_7be,has,ioq,_7bf,_7c0,_7c1,_7c2,_7c3,_7c4,_7c5,_7c6,_7c7,_7c8,_7c9){var _7ca=_7ba(_7c7,{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(url,_7cb){this._url=_7c4.urlToObject(url);var _7cc=_7cb&&_7cb.imageServiceParameters;this.format=_7cc&&_7cc.format;this.interpolation=_7cc?_7cc.interpolation:null;this.compressionQuality=_7cc?_7cc.compressionQuality:null;this.bandIds=_7cc?_7cc.bandIds:null;this.mosaicRule=_7cc?_7cc.mosaicRule:null;this.renderingRule=_7cc?_7cc.renderingRule:null;this._params=lang.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},_7cc?_7cc.toJson():{});this._initLayer=lang.hitch(this,this._initLayer);this.useMapImage=(_7cb&&_7cb.useMapImage)||false;this._loadCallback=_7cb&&_7cb.loadCallback;var _7cd=_7cb&&_7cb.resourceInfo;if(_7cd){this._initLayer(_7cd);}else{_7c2({url:this._url.path,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents("esri.layers.ArcGISImageServiceLayer",{"rendering-change":true});},disableClientCaching:false,_initLayer:function(_7ce,io){this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_7ce&&_7ce._ssl);if(ssl){this._useSSL();}var _7cf=this.minScale,_7d0=this.maxScale;lang.mixin(this,_7ce);this.minScale=_7cf;this.maxScale=_7d0;this.initialExtent=(this.fullExtent=this.extent=(new _7c5(_7ce.extent)));this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var i,il,mins=this.minValues,maxs=this.maxValues,_7d1=this.meanValues,_7d2=this.stdvValues,bs=(this.bands=[]);for(i=0,il=this.bandCount;i<il;i++){bs[i]={min:mins[i],max:maxs[i],mean:_7d1[i],stddev:_7d2[i]};}var _7d3=this.timeInfo;this.timeInfo=(_7d3&&_7d3.timeExtent)?new _7c8(_7d3):null;var _7d4=this.fields=[];var _7d5=_7ce.fields;if(_7d5){for(i=0;i<_7d5.length;i++){_7d4.push(new _7c9(_7d5[i]));}}this.version=_7ce.currentVersion;if(!this.version){var ver;if("fields" in _7ce||"objectIdField" in _7ce||"timeInfo" in _7ce){ver=10;}else{ver=9.3;}this.version=ver;}if(_7c1.isDefined(_7ce.minScale)&&!this._hasMin){this.setMinScale(_7ce.minScale);}if(_7c1.isDefined(_7ce.maxScale)&&!this._hasMax){this.setMaxScale(_7ce.maxScale);}var _7d6={};if(_7ce.defaultMosaicMethod){_7d6.method=_7ce.defaultMosaicMethod;_7d6.operation=_7ce.mosaicOperator;_7d6.sortField=_7ce.sortField;_7d6.sortValue=_7ce.sortValue;}else{_7d6.method=_7c6.METHOD_NONE;}this.defaultMosaicRule=new _7c6(_7d6);this.defaultMosaicRule.ascending=true;this.loaded=true;this.onLoad(this);var _7d7=this._loadCallback;if(_7d7){delete this._loadCallback;_7d7(this);}},getKeyProperties:function(){var url=this._url.path+"/keyProperties",dfd=new _7bb(_7c3._dfdCanceller);if(this.version>10){dfd._pendingDfd=_7c2({url:url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});dfd._pendingDfd.then(function(_7d8){dfd.callback(_7d8);},function(_7d9){dfd.errback(_7d9);});}else{var err=new Error("Layer does not have key properties");err.log=_7be.isDebug;dfd.errback(err);}return dfd;},getImageUrl:function(_7da,_7db,_7dc,_7dd){var sr=_7da.spatialReference.wkid||_7bd.toJson(_7da.spatialReference.toJson());delete this._params._ts;var path=this._url.path+"/exportImage?";lang.mixin(this._params,{bbox:_7da.xmin+","+_7da.ymin+","+_7da.xmax+","+_7da.ymax,imageSR:sr,bboxSR:sr,size:_7db+","+_7dc},this.disableClientCaching?{_ts:new Date().getTime()}:{});var _7de=(this._params.token=this._getToken()),_7df=_7c4.addProxy(path+ioq.objectToQuery(lang.mixin(this._params,{f:"image"})));if((_7df.length>_7c0.defaults.io.postLength)||this.useMapImage){this._jsonRequest=_7c2({url:path,content:lang.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(_7e0,io){var href=_7e0.href;if(_7de){href+=(href.indexOf("?")===-1?("?token="+_7de):("&token="+_7de));}_7dd(_7c4.addProxy(href));},error:this._errorHandler});}else{_7dd(_7df);}},onRenderingChange:function(){},setInterpolation:function(_7e1,_7e2){this.interpolation=(this._params.interpolation=_7e1);if(!_7e2){this.refresh(true);}},setCompressionQuality:function(_7e3,_7e4){this.compressionQuality=(this._params.compressionQuality=_7e3);if(!_7e4){this.refresh(true);}},setBandIds:function(ids,_7e5){var _7e6=false;if(this.bandIds!==ids){_7e6=true;}this.bandIds=ids;this._params.bandIds=ids.join(",");if(_7e6&&!_7e5){this.onRenderingChange(this._params.bandIds);}if(!_7e5){this.refresh(true);}},setDefaultBandIds:function(_7e7){this.bandIds=(this._params.bandIds=null);if(!_7e7){this.refresh(true);}},setDisableClientCaching:function(_7e8){this.disableClientCaching=_7e8;},setMosaicRule:function(_7e9,_7ea){this.mosaicRule=_7e9;this._params.mosaicRule=_7bd.toJson(_7e9.toJson());if(!_7ea){this.refresh(true);}},setRenderingRule:function(_7eb,_7ec){var _7ed=false;if(this.renderingRule!==_7eb){_7ed=true;}this.renderingRule=_7eb;this._params.renderingRule=_7bd.toJson(_7eb.toJson());if(_7ed&&!_7ec){this.onRenderingChange(this._params.renderingRule);}if(!_7ec){this.refresh(true);}},setImageFormat:function(_7ee,_7ef){this.format=(this._params.format=_7ee);if(!_7ef){this.refresh(true);}},refresh:function(_7f0){if(_7f0){this.inherited(arguments);}else{var dc=this.disableClientCaching;this.disableClientCaching=true;this.inherited(arguments);this.disableClientCaching=dc;}},exportMapImage:function(_7f1,_7f2){var m=_7c0.defaults.map,p=lang.mixin({size:m.width+","+m.height},this._params,_7f1?_7f1.toJson(this.normalization):{},{f:"json"});delete p._ts;this._exportMapImage(this._url.path+"/exportImage",p,_7f2);}});if(has("extend-esri")){lang.setObject("layers.ArcGISImageServiceLayer",_7ca,_7bf);}return _7ca;});},"esri/arcgis/csv":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_7f3,_7f4,has,_7f5,_7f6,_7f7,_7f8,_7f9,_7fa,_7fb,_7fc,_7fd){var _7fe=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_7ff=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _800(_801){var _802=[","," ",";","|","\t"];var _803=0;var _804="";_7f3.forEach(_802,function(_805){var _806=_801.split(_805).length;if(_806>_803){_803=_806;_804=_805;}});return _804;};function _807(d,_808){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _809=true;if(has("chrome")&&/\d+\W*$/.test(_808)){var _80a=_808.match(/[a-zA-Z]{2,}/);if(_80a){var _80b=false,i=0,len=_80a.length,_80c=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_80b&&(i<=len)&&!(_80b=!_80c.test(_80a[i]))){i++;}_809=!_80b;}}return _809;};function _80d(data,_80e,_80f){var _810=data.indexOf("\n");var _811=lang.trim(data.substr(0,_810));var _812=_80e.columnDelimiter;if(!_812){_812=_800(_811);}var _813=new _7f6({data:data,separator:_812});var _814=(has("ie")<9)?750:1001;_813.fetch({start:0,count:_814,onComplete:function(_815,_816){var _817=0;var _818={"layerDefinition":_80e.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _819=_818.layerDefinition.objectIdField;if(!_819){if(!_7f3.some(_818.layerDefinition.fields,function(_81a){if(_81a.type=="esriFieldTypeOID"){_819=_81a.name;return true;}return false;})){_818.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_819="__OBJECTID";}}var _81b,_81c;var _81d=_813._attributes;var _81e=[];var _81f=[];_7f3.forEach(_818.layerDefinition.fields,function(_820,_821){if(_820.type==="esriFieldTypeDate"){_81e.push(_820.name);}else{if(_820.type==="esriFieldTypeDouble"||_820.type==="esriFieldTypeInteger"){_81f.push(_820.name);}}});if(_80e.locationInfo&&_80e.locationInfo.locationType==="coordinates"){_81b=_80e.locationInfo.latitudeFieldName;_81c=_80e.locationInfo.longitudeFieldName;}else{_7f3.forEach(_81d,function(_822){var _823;_823=_7f3.indexOf(_7fe,_822.toLowerCase());if(_823!==-1){_81b=_822;}_823=_7f3.indexOf(_7ff,_822.toLowerCase());if(_823!==-1){_81c=_822;}},this);}if(!_81b||!_81c){setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.");},1);return;}var i=0,il=_815.length;for(i;i<il;i++){if(_818.featureSet.features.length>=1000){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.");},1);break;}var item=_815[i];var _824=_813.getAttributes(item),_825={};_7f3.forEach(_824,function(attr,_826){if(attr){var _827=attr;if(attr.length===0){_7f3.forEach(_818.layerDefinition.fields,function(_828,idx){if(_828.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_7f3.some(_81e,function(a){return a===attr;})){var val=_813.getValue(item,_827),date=new Date(val);_825[attr]=_807(date,val)?date.getTime():null;}else{if(_7f3.some(_81f,function(a){return a===attr;})){var _829=_7f5.parse(_813.getValue(item,_827));if((attr==_81b||attr==_81c)&&(isNaN(_829)||Math.abs(_829)>181)){_829=parseFloat(_813.getValue(item,_827));if(isNaN(_829)){_825[attr]=null;}else{_825[attr]=_829;}}else{if(isNaN(_829)){_825[attr]=null;}else{_825[attr]=_829;}}}else{_825[attr]=_813.getValue(item,_827);}}}});_825[_819]=_817;_817++;var _82a=_825[_81b];var _82b=_825[_81c];if(_82b==null||_82a==null||isNaN(_82a)||isNaN(_82b)){continue;}var _82c=new _7fb(_82b,_82a,new _7fa({wkid:4326}));var _82d={"geometry":_82c.toJson(),"attributes":_825};_818.featureSet.features.push(_82d);}_818.layerDefinition.name="csv";if(_80f){_80f(_818);}},onError:function(_82e){console.error("Error fetching items from CSV store: ",_82e);}});return true;};function _82f(_830,_831,inSR,_832,_833,_834){if(_830.length===0){_833(null);}var _835=_7fc.getGeometryType(_831);var _836=[];_7f3.forEach(_830,function(_837){var _838=new _835(_837);_838.spatialReference=inSR;_836.push(_838);},this);var _839=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_832.wkid&&_7f3.indexOf(_839,_832.wkid)>-1){_7f3.forEach(_836,function(_83a){if(_83a.xmin){_83a.xmin=Math.max(_83a.xmin,-180);_83a.xmax=Math.min(_83a.xmax,180);_83a.ymin=Math.max(_83a.ymin,-89.99);_83a.ymax=Math.min(_83a.ymax,89.99);}else{if(_83a.rings){_7f3.forEach(_83a.rings,function(ring){_7f3.forEach(ring,function(_83b){_83b[0]=Math.min(Math.max(_83b[0],-180),180);_83b[1]=Math.min(Math.max(_83b[1],-89.99),89.99);},this);},this);}else{if(_83a.paths){_7f3.forEach(_83a.paths,function(path){_7f3.forEach(path,function(_83c){_83c[0]=Math.min(Math.max(_83c[0],-180),180);_83c[1]=Math.min(Math.max(_83c[1],-89.99),89.99);},this);},this);}else{if(_83a.x){_83a.x=Math.min(Math.max(_83a.x,-180),180);_83a.y=Math.min(Math.max(_83a.y,-89.99),89.99);}}}}},this);_830=[];_7f3.forEach(_836,function(_83d){var _83e=_7fd.geographicToWebMercator(_83d);if(_832.wkid!==102100){_83e.spatialReference=_832;}_830.push(_83e.toJson());},this);_833(_830);}else{if(inSR.wkid!==null&&_7f3.indexOf(_839,inSR.wkid)>-1&&_832.wkid!==null&&_832.wkid===4326){_830=[];_7f3.forEach(_836,function(_83f){_830.push(_7fd.webMercatorToGeographic(_83f).toJson());},this);_833(_830);}else{var _840=function(_841,args){if(_841&&_841.length===_830.length){_830=[];_7f3.forEach(_841,function(_842){if(_842&&((_842.rings&&_842.rings.length>0&&_842.rings[0].length>0&&_842.rings[0][0].length>0&&!isNaN(_842.rings[0][0][0])&&!isNaN(_842.rings[0][0][1]))||(_842.paths&&_842.paths.length>0&&_842.paths[0].length>0&&_842.paths[0][0].length>0&&!isNaN(_842.paths[0][0][0])&&!isNaN(_842.paths[0][0][1]))||(_842.xmin&&!isNaN(_842.xmin)&&_842.ymin&&!isNaN(_842.ymin))||(_842.x&&!isNaN(_842.x)&&_842.y&&!isNaN(_842.y)))){_830.push(_842.toJson());}else{_830.push(null);}},this);_833(_830);}else{_834(_841,args);}};if(_7f8.defaults.geometryService){_7f8.defaults.geometryService.project(_836,_832,lang.hitch(this,_840),_834);}else{_833(null);}}}};function _843(sp1,sp2){var _844=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_7f3.indexOf(_844,sp1.wkid)>-1&&_7f3.indexOf(_844,sp2.wkid)>-1){return true;}}return false;};function _845(_846,_847,_848,_849){if(!_846.featureSet||_846.featureSet.length===0){return;}if(_843(_848,_847)){_849(_846);return;}var _84a=function(_84b){var _84c=[];_7f3.forEach(_846.featureSet.features,function(_84d,i){if(_84b[i]){_84d.geometry=_84b[i];_84c.push(_84d);}},this);_849(_846);};var _84e=function(_84f,args){console.error("error projecting featureSet ("+_846.layerDefinition.name+"). Final try.");_849(_846);};var _850=function(_851,args){console.error("error projecting featureSet ("+_846.layerDefinition.name+"). Try one more time.");_82f(_852,_846.featureSet.geometryType,_847,_848,lang.hitch(this,_84a),lang.hitch(this,_84e));};if(_846.featureSet.features&&_846.featureSet.features.length>0){var _852=[];_7f3.forEach(_846.featureSet.features,function(_853){_852.push(_853.geometry);});_82f(_852,_846.featureSet.geometryType,_847,_848,lang.hitch(this,_84a),lang.hitch(this,_850));}else{_849(_846);}};function _854(_855){var _856=new _7f4();var _857=function(_858){_856.callback(_858);};var _859=_7f9({url:_855.url,handleAs:"text",load:function(_85a){_80d(_85a,_855,lang.hitch(this,_857));},error:function(_85b){console.error("error: "+_85b);}},{usePost:false});return _856;};function _85c(_85d,_85e){var _85f=new _7f4();var _860=function(_861){_85f.callback(_861);};_845(_85d,new _7fa({wkid:4326}),_85e,lang.hitch(this,_860));return _85f;};function _862(_863){var _864=_863.layerDefinition.fields;var _865={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _866={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _867=null;var _868=_7f3.map(_864,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_867=item.name;}var _869=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _86a=null;if(_869){var f=item.name.toLowerCase();var _86b=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_86b.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_869=false;}if(item.type in _866){_86a={places:0,digitSeparator:true};}else{if(item.type in _865){_86a={places:2,digitSeparator:true};}else{if(item.type in dt){_86a={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_869,format:_86a,stringFieldOption:"textbox"});}));var _86c={title:_867?"{"+_867+"}":"",fieldInfos:_868,description:null,showAttachments:false,mediaInfos:[]};return _86c;};var csv={latFieldStrings:_7fe,longFieldStrings:_7ff,buildCSVFeatureCollection:_854,projectFeatureCollection:_85c,generateDefaultPopupInfo:_862,_getSeparator:_800,_isValidDate:_807,_processCsvData:_80d,_projectGeometries:_82f,_sameSpatialReference:_843,_projectFeatureSet:_845};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_7f7);}return csv;});},"dijit/Destroyable":function(){define("dijit/Destroyable",["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(_86d,_86e,_86f){return _86f("dijit.Destroyable",null,{destroy:function(_870){this._destroyed=true;},own:function(){_86d.forEach(arguments,function(_871){var _872="destroyRecursive" in _871?"destroyRecursive":"destroy" in _871?"destroy":"remove";var odh=_86e.before(this,"destroy",function(_873){_871[_872](_873);});var hdh=_86e.after(_871,_872,function(){odh.remove();hdh.remove();},true);},this);return arguments;}});});},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_874,lang,has,_875){var _876=_874(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(json){if(json&&lang.isObject(json)){this.objectId=json.objectId;this.success=json.success;if(!json.success){var err=json.error;this.error=new Error();this.error.code=err.code;this.error.message=err.description;}}}});if(has("extend-esri")){lang.setObject("layers.FeatureEditResult",_876,_875);}return _876;});},"dojo/cache":function(){define(["./_base/kernel","./text"],function(dojo){return dojo.cache;});},"esri/tasks/query":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/has","esri/kernel","esri/geometry/jsonUtils","esri/tasks/SpatialRelationship","dojo/has!extend-esri?esri/tasks/QueryTask","dojo/has!extend-esri?esri/tasks/RelationshipQuery","dojo/has!extend-esri?esri/tasks/StatisticDefinition"],function(_877,lang,_878,_879,has,_87a,_87b,_87c){var _87d=_877(null,{declaredClass:"esri.tasks.Query",constructor:function(){this.spatialRelationship=_87d.SPATIAL_REL_INTERSECTS;},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:false,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,pixelSize:null,toJson:function(_87e){var json={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},g=_87e&&_87e["geometry"]||this.geometry,ids=this.objectIds,_87f=this.outFields,_880=this.outSpatialReference,_881=this.groupByFieldsForStatistics,_882=this.orderByFields,_883=this.outStatistics;if(g){json.geometry=g;json.geometryType=_87b.getJsonType(g);json.inSR=g.spatialReference.wkid||_879.toJson(g.spatialReference.toJson());}if(ids){json.objectIds=ids.join(",");}if(_87f){json.outFields=_87f.join(",");}if(_881){json.groupByFieldsForStatistics=_881.join(",");}if(_882){json.orderByFields=_882.join(",");}if(_883){var _884=[];_878.forEach(_883,function(item,idx){_884.push(item.toJson());});json.outStatistics=_879.toJson(_884);}if(_880!==null){json.outSR=_880.wkid||_879.toJson(_880.toJson());}else{if(g){json.outSR=g.spatialReference.wkid||_879.toJson(g.spatialReference.toJson());}}var _885=this.timeExtent;json.time=_885?_885.toJson().join(","):null;var _886=this.relationParam;if(_886&&this.spatialRelationship===_87d.SPATIAL_REL_RELATION){json.relationParam=_886;}json.pixelSize=this.pixelSize?_879.toJson(this.pixelSize.toJson()):null;json._ts=this._ts;return json;}});lang.mixin(_87d,_87c);if(has("extend-esri")){lang.setObject("tasks.Query",_87d,_87a);}return _87d;});},"esri/tasks/FeatureSet":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/graphic","esri/SpatialReference","esri/graphicsUtils","esri/geometry/jsonUtils","esri/symbols/jsonUtils"],function(_887,lang,_888,has,_889,_88a,_88b,_88c,_88d,_88e,_88f){var _890=_887(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(json){if(json){lang.mixin(this,json);var _891=this.features,sr=json.spatialReference,_892=_88e.getGeometryType(json.geometryType);sr=(this.spatialReference=new _88c(sr));this.geometryType=json.geometryType;if(json.fields){this.fields=json.fields;}_888.forEach(_891,function(_893,i){var _894=_893.geometry&&_893.geometry.spatialReference;_891[i]=new _88b((_892&&_893.geometry)?new _892(_893.geometry):null,_893.symbol&&_88f.fromJson(_893.symbol),_893.attributes);if(_891[i].geometry&&!_894){_891[i].geometry.setSpatialReference(sr);}});}else{this.features=[];}},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(_895){var json={};if(this.displayFieldName){json.displayFieldName=this.displayFieldName;}if(this.fields){json.fields=this.fields;}if(this.spatialReference){json.spatialReference=this.spatialReference.toJson();}else{if(this.features[0]&&this.features[0].geometry){json.spatialReference=this.features[0].geometry.spatialReference.toJson();}}if(this.features[0]){if(this.features[0].geometry){json.geometryType=_88e.getJsonType(this.features[0].geometry);}json.features=_88d._encodeGraphics(this.features,_895);}json.exceededTransferLimit=this.exceededTransferLimit;return _88a.fixJson(json);}});if(has("extend-esri")){lang.setObject("tasks.FeatureSet",_890,_889);}return _890;});},"esri/layers/FeatureTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_896,lang,has,_897,_898,_899){var _89a=_896(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _89b=json.prototype;this.prototype=new _899(_89b.geometry,null,_89b.attributes);}},toJson:function(){return _898.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_89a,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_89a,_897);}return _89a;});},"esri/layers/ImageServiceParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/lang"],function(_89c,lang,_89d,has,_89e,_89f){var _8a0=_89c(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(_8a1){var ext=this.bbox||this.extent;ext=ext&&_8a1&&ext._normalize(true);var wkid=ext?(ext.spatialReference.wkid||_89d.toJson(ext.spatialReference.toJson())):null,_8a2=this.imageSpatialReference,json={bbox:ext?(ext.xmin+","+ext.ymin+","+ext.xmax+","+ext.ymax):null,bboxSR:wkid,size:(this.width!==null&&this.height!==null?this.width+","+this.height:null),imageSR:(_8a2?(_8a2.wkid||_89d.toJson(_8a2.toJson())):wkid),format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?_89d.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?_89d.toJson(this.renderingRule.toJson()):null,noData:this.noData};var _8a3=this.timeExtent;json.time=_8a3?_8a3.toJson().join(","):null;return _89f.filter(json,function(_8a4){if(_8a4!==null){return true;}});}});lang.mixin(_8a0,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor"});if(has("extend-esri")){lang.setObject("layers.ImageServiceParameters",_8a0,_89e);}return _8a0;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _8a5={};lang.setObject("dojo.data.util.filter",_8a5);_8a5.patternToRegExp=function(_8a6,_8a7){var rxp="^";var c=null;for(var i=0;i<_8a6.length;i++){c=_8a6.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_8a6.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_8a7){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _8a5;});},"esri/dijit/PopupTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/dom-construct","esri/kernel","esri/InfoTemplate","esri/PopupInfo","esri/dijit/PopupRenderer"],function(_8a8,lang,has,_8a9,_8aa,_8ab,_8ac,_8ad){var PT=_8a8([_8ab,_8ac],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(json,_8ae){lang.mixin(this,_8ae);this.initialize(json,_8ae);},getTitle:function(_8af){return this.info?this.getComponents(_8af).title:"";},getContent:function(_8b0){return this.info?new _8ad({template:this,graphic:_8b0,chartTheme:this.chartTheme},_8a9.create("div")).domNode:"";}});if(has("extend-esri")){lang.setObject("dijit.PopupTemplate",PT,_8aa);}return PT;});},"*noref":1}});define("esri/arcgis/utils",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_8b1,_8b2,_8b3,_8b4,Url,has,_8b5,_8b6,_8b7,_8b8,_8b9,_8ba,_8bb,Map,_8bc,_8bd,_8be,_8bf,_8c0,_8c1,_8c2,_8c3,_8c4,_8c5,csv,_8c6,_8c7,_8c8,_8c9,_8ca,_8cb,_8cc,_8cd,_8ce,_8cf,_8d0,_8d1,_8d2,_8d3,_8d4,_8d5,_8d6){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _8d7;function _8d8(_8d9){var url=_8d7.arcgisUrl+"/"+_8d9.itemId+"/data";var _8da=_8ba({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _8da;};function _8db(_8dc){var _8dd={f:"json"};if(_8b7.id){var _8de=_8b7.id.findCredential(_8bc.urlToObject(_8d7.arcgisUrl).path);if(_8de){_8dd.token=_8de.token;}}var _8df=_8ba({url:_8dc,content:_8dd,callbackParamName:"callback"},{"disableIdentityLookup":true});return _8df;};function _8e0(_8e1){if(_8e1.itemProperties.layerDefinition){if(_8e1.layerDefinition){if(!_8e1.layerDefinition.drawingInfo){_8e1.layerDefinition.drawingInfo=_8e1.itemProperties.layerDefinition.drawingInfo;}if(!_8b9.isDefined(_8e1.layerDefinition.definitionExpression)){_8e1.layerDefinition.definitionExpression=_8e1.itemProperties.layerDefinition.definitionExpression;}if(!_8b9.isDefined(_8e1.layerDefinition.minScale)){_8e1.layerDefinition.minScale=_8e1.itemProperties.layerDefinition.minScale;}if(!_8b9.isDefined(_8e1.layerDefinition.maxScale)){_8e1.layerDefinition.maxScale=_8e1.itemProperties.layerDefinition.maxScale;}}else{_8e1.layerDefinition=_8e1.itemProperties.layerDefinition;}}if(_8e1.itemProperties.popupInfo&&!_8e1.popupInfo&&!_8e1.disablePopup){_8e1.popupInfo=_8e1.itemProperties.popupInfo;}};function _8e2(_8e3,_8e4){var _8e5=new _8b3();var _8e6=_8e3.itemData;var _8e7=[];var _8e8=[];_8b1.forEach(_8e6.operationalLayers,function(_8e9){if(_8e9.itemId&&!_8e9.type){var _8ea=_8e9.url.toLowerCase();if(_8ea.indexOf("/featureserver")>-1){_8e8.push(_8e9);_8e7.push(_8d8(_8e9));}else{if(_8ea.indexOf("/mapserver")>-1&&_8ea.indexOf("/mapserver/")===-1&&(!_8e9.layers||(!_8b9.isDefined(_8e9.minScale)&&!_8b9.isDefined(_8e9.maxScale)))){_8e8.push(_8e9);_8e7.push(_8d8(_8e9));}else{if(_8ea.indexOf("/imageserver")>-1&&!_8b9.isDefined(_8e9.minScale)&&!_8b9.isDefined(_8e9.maxScale)){_8e8.push(_8e9);_8e7.push(_8d8(_8e9));}}}}});if(_8e6.baseMap&&_8e6.baseMap.baseMapLayers){_8b1.forEach(_8e6.baseMap.baseMapLayers,function(_8eb){if((_8eb.type==="BingMapsAerial"||_8eb.type==="BingMapsRoad"||_8eb.type==="BingMapsHybrid")&&_8eb.portalUrl){_8e8.push(_8eb);_8e7.push(_8db(_8eb.portalUrl));}});}if(_8e7.length>0){var _8ec=new _8b5(_8e7);_8ec.addCallback(function(_8ed){_8b1.forEach(_8e8,function(_8ee,i){if((_8ee.type==="BingMapsAerial"||_8ee.type==="BingMapsRoad"||_8ee.type==="BingMapsHybrid")&&_8ee.portalUrl){if(_8ed[i][1].bingKey){_8e4.bingMapsKey=_8ed[i][1].bingKey;}else{_8ee.errors=_8ee.errors||[];var _8ef={message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+_8ee.type+"]"};_8ee.errors.push(_8ef);}return;}var _8f0=_8ed[i][1];if(_8f0){var _8f1=_8ee.url.toLowerCase();if(_8f1.indexOf("/featureserver")>-1&&_8f0.layers){_8b1.forEach(_8f0.layers,function(_8f2){if(_8f1.endsWith("/featureserver/"+_8f2.id)){_8ee.itemProperties=_8f2;_8e0(_8ee);}});}else{if(_8f1.indexOf("/mapserver")>-1){if(_8f0.layers&&!_8ee.layers){_8ee.layers=_8f0.layers;}if(_8b9.isDefined(_8f0.minScale)&&!_8b9.isDefined(_8ee.minScale)){_8ee.minScale=_8f0.minScale;}if(_8b9.isDefined(_8f0.maxScale)&&!_8b9.isDefined(_8ee.maxScale)){_8ee.maxScale=_8f0.maxScale;}}else{if(_8f1.indexOf("/imageserver")>-1){if(_8b9.isDefined(_8f0.minScale)&&!_8b9.isDefined(_8ee.minScale)){_8ee.minScale=_8f0.minScale;}if(_8b9.isDefined(_8f0.maxScale)&&!_8b9.isDefined(_8ee.maxScale)){_8ee.maxScale=_8f0.maxScale;}}}}}});_8e5.callback(_8e3);});}else{_8e5.callback(_8e3);}return _8e5;};function _8f3(_8f4,_8f5){var _8f6=_8f4.dynamicLayerInfos||_8f4.layerInfos;var _8f7=_8f5.layers;if(_8f7&&_8f6){var _8f8=[],ids=[],urls=[];_8b1.forEach(_8f6,function(_8f9){var id=_8f9.id,i;if(!_8f9.subLayerIds&&_8b1.indexOf(_8f4.visibleLayers,id)!==-1){for(i=0;i<_8f7.length;i++){var _8fa=_8f7[i];if(_8fa.id===id){ids.push(id);_8f8.push(_8fa.popupInfo);urls.push(_8fa.layerUrl||"");break;}}}});if(_8f8.length){_8f4.__popups=_8f8;_8f4.__popupIds=ids;_8f4.__popupUrls=urls;_8f4.__resourceInfo=_8f5.resourceInfo;}}};function _8fb(url){if(!url){return false;}var _8fc=".arcgis.com/";var _8fd=(new Url(_8d7.arcgisUrl)).authority;return (url.indexOf(_8fc)!==-1||url.indexOf(_8fd)!==-1);};function _8fe(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _8ff(url){if(location.protocol==="https:"&&(_8fb(url)||_8fe(url))){url=url.replace("http:","https:");}return url;};function _900(_901){var _902=[];if(!_901.displayLevels){_902=_8b1.map(_901.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _903=new _8c6(_8ff(_901.url),{resourceInfo:_901.resourceInfo,opacity:_901.opacity,visible:_901.visibility,displayLevels:_901.displayLevels||_902,id:_901.id,minScale:_901.minScale,maxScale:_901.maxScale});_8f3(_903,_901);return _903;};function _904(_905,_906){if(!_905||!_906||_906.length===0){return [];}var _907=","+_906+",";var _908=[];var _909="";var k,_90a=",";for(k=0;k<_905.length;k++){if(_905[k].subLayerIds!==null){if(_907.indexOf(","+_905[k].id+",")===-1||_90a.indexOf(","+_905[k].id+",")>-1){_90a+=_905[k].subLayerIds.toString()+",";}}else{if(_907.indexOf(","+_905[k].id+",")>-1&&_90a.indexOf(","+_905[k].id+",")===-1){_908.push(_905[k].id);_909=",";}}}return _908;};function _90b(_90c){var _90d=new _8d3();_90d.format="png24";if(_90c.resourceInfo&&_90c.resourceInfo.supportedImageFormatTypes&&_90c.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_90d.format="png32";}var _90e=new _8c7(_8ff(_90c.url),{resourceInfo:_90c.resourceInfo,opacity:_90c.opacity,visible:_90c.visibility,id:_90c.id,imageParameters:_90d,minScale:_90c.minScale,maxScale:_90c.maxScale});var _90f=_90c.visibleLayers;if(!_90c.visibleLayers){var _910="";var _911=_90e.layerInfos;_8b1.forEach(_911,function(_912){if(_912.defaultVisibility){_910+=(_910.length>0?",":"")+_912.id;}});_90f=_910;}_90f=_904(_90e.layerInfos,_90f);_90e.setVisibleLayers(_90f);if(_90c.layers&&_90c.layers.length>0){var _913=[],_914=[],_915,_916=[],_917;_8b1.forEach(_90c.layers,function(_918){if(_918.layerDefinition&&_918.layerDefinition.definitionExpression){_913[_918.id]=_918.layerDefinition.definitionExpression;}if(_918.layerDefinition&&_918.layerDefinition.source){_915=new _8d1(lang.mixin(_918,_918.layerDefinition));delete _915.layerDefinition;_915.id=_918.id;if(_90c.visibleLayers&&_8b1.indexOf(_90c.visibleLayers,_918.id)===-1){_915.defaultVisibility=false;}_914.push(_915);}if(_918.layerDefinition&&_918.layerDefinition.source&&_918.layerDefinition.drawingInfo){_917=new _8d2(_918.layerDefinition.drawingInfo);_916[_918.id]=_917;}},this);if(_913.length>0){_90e.setLayerDefinitions(_913);}if(_914.length>0){_90e.setDynamicLayerInfos(_914,true);if(_916.length>0){_90e.setLayerDrawingOptions(_916,true);}}}_8f3(_90e,_90c);return _90e;};function _919(_91a,_91b){var _91c=[102113,102100,3857];var sp1=new _8bb(_91b[0].layerObject.fullExtent.spatialReference);var sp2=new _8bb(_91a.resourceInfo.fullExtent.spatialReference);if(sp1.wkt==sp2.wkt&&(sp1.wkid==sp2.wkid||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.wkid)||(esri.isDefined(sp2.latestWkid)&&sp1.wkid==sp2.latestWkid)||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.latestWkid))){return true;}else{if(sp1.wkid&&sp2.wkid&&_8b1.some(_91c,function(wkid){return wkid===sp2.wkid;})&&_8b1.some(_91c,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _91d(_91e,_91f){if(!_91f[0].layerObject.tileInfo){return false;}var _920=[];_8b1.forEach(_91f,function(_921){if(_921.baseMapLayer){if(_921.layerObject.tileInfo){_920=_920.concat(_8b1.map(_921.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _922=_8b1.some(_91e.resourceInfo.tileInfo.lods,function(lod){return _8b1.some(_920,function(_923){return _923===lod.scale;});});return _922;};function _924(_925,_926,_927,_928){var _929,_92a=_927._clazz;if(_925.type==="OpenStreetMap"){_929=new _8c9({id:_925.id,opacity:_925.opacity,visible:(_925.visibility!==null&&_925.visibility!==undefined)?_925.visibility:true});}else{if(_925.type==="WMS"){var _92b=[];var _92c=[];_8b1.forEach(_925.layers,function(_92d){_92c.push(new _8d5({name:_92d.name,title:_92d.title,legendURL:_92d.legendURL}));_92b.push(_92d.name);},this);if(_925.visibleLayers){_92b=_925.visibleLayers;}var _92e=new _8be(_925.extent[0][0],_925.extent[0][1],_925.extent[1][0],_925.extent[1][1],new _8bb({wkid:4326}));var _92f={extent:_92e,layerInfos:_92c,version:_925.version,maxWidth:_925.maxWidth,maxHeight:_925.maxHeight,getMapUrl:_925.mapUrl,spatialReferences:_925.spatialReferences,title:_925.title,copyright:_925.copyright};_929=new _8cc(_925.url,{id:_925.id,visibleLayers:_92b,format:"png",transparent:_925.baseMapLayer?false:true,opacity:_925.opacity,visible:(_925.visibility!==null)?_925.visibility:true,resourceInfo:_92f});_929.spatialReference.wkid=_92f.spatialReferences[0];}else{if(_925.type==="KML"){_929=new _8cd(_925.url,{id:_925.id,visible:(_925.visibility!==null)?_925.visibility:true,outSR:_928});_8b2.connect(_929,"onLoad",function(){var _930=function(_931){_8b1.forEach(_931,function(_932){if(_932.declaredClass==="esri.layers.FeatureLayer"||_932.declaredClass==="esri.layers.MapImageLayer"){_932.setOpacity(_925.opacity);}else{if(_932.declaredClass==="esri.layers.KMLLayer"){if(_932.loaded){_930(_932.getLayers());}else{_8b2.connect(_932,"onLoad",lang.hitch(this,function(lyr){_930(lyr.getLayers());}));}}}});};if(_925.opacity||_925.opacity===0){_930(_929.getLayers());}if(_925.visibleFolders){_8b1.forEach(_929.folders,function(_933){if(_8b1.indexOf(_925.visibleFolders,_933.id)>-1){_929.setFolderVisibility(_933,true);}else{_929.setFolderVisibility(_933,false);}},this);}});}else{if(_925.type==="WebTiledLayer"){_929=new _8ca(_925.templateUrl,{id:_925.id,visible:(_925.visibility!==null)?_925.visibility:true,opacity:_925.opacity,copyright:_925.copyright,fullExtent:_925.fullExtent&&new _8be(_925.fullExtent),initialExtent:_925.fullExtent&&new _8be(_925.fullExtent),subDomains:_925.subDomains,tileInfo:_925.tileInfo?new _8d0(_925.tileInfo):null});_8b2.connect(_929,"onLoad",function(){if(_8b9.isDefined(_925.minScale)||_8b9.isDefined(_925.maxScale)){_929.setScaleRange(_925.minScale,_925.maxScale);}});}else{if(_925.type==="GeoRSS"){_929=new _8ce(_925.url,{id:_925.id,visible:(_925.visibility!==null)?_925.visibility:true,opacity:_925.opacity,outSpatialReference:_928});_8b2.connect(_929,"onLoad",function(){var _934=_929.getFeatureLayers();_8b1.forEach(_934,function(_935){if(_925.pointSymbol&&_935.geometryType==="esriGeometryPoint"){_935.renderer.symbol=_8c0.fromJson(_925.pointSymbol);}else{if(_925.lineSymbol&&_935.geometryType==="esriGeometryPolyline"){_935.renderer.symbol=_8c0.fromJson(_925.lineSymbol);}else{if(_925.polygonSymbol&&_935.geometryType==="esriGeometryPolygon"){_935.renderer.symbol=_8c0.fromJson(_925.polygonSymbol);}}}if(_8b9.isDefined(_925.minScale)||_8b9.isDefined(_925.maxScale)){_935.setScaleRange(_925.minScale,_925.maxScale);}});});}else{if(_925.type=="CSV"&&_925.url){_929=new _8cb(_925.featureCollection,{infoTemplate:new _8c2(_925.popupInfo?_925.popupInfo:csv.generateDefaultPopupInfo(_925.featureCollection)),id:_925.id?_925.id:null,outFields:["*"],visible:(_925.visibility!==null)?_925.visibility:true,opacity:_925.opacity,autoGeneralize:true});}else{if(_925.layerDefinition&&!_925.url){var _936=_8b4.fromJson(_8b4.toJson(_925));delete _936.id;delete _936.opacity;delete _936.visibility;_929=new _8cb(_936,{id:_925.id,opacity:_925.opacity,visible:_925.visibility,outFields:["*"],infoTemplate:_936.popupInfo&&new _92a(_936.popupInfo),autoGeneralize:true});}else{if(_925.type==="BingMapsAerial"||_925.type==="BingMapsRoad"||_925.type==="BingMapsHybrid"){if(_927.bingMapsKey){var _937=_8cf.MAP_STYLE_AERIAL_WITH_LABELS;if(_925.type==="BingMapsAerial"){_937=_8cf.MAP_STYLE_AERIAL;}else{if(_925.type==="BingMapsRoad"){_937=_8cf.MAP_STYLE_ROAD;}}_929=new _8cf({bingMapsKey:_927.bingMapsKey,mapStyle:_937,opacity:_925.opacity,id:_925.id});}}else{if(_925.resourceInfo&&_925.resourceInfo.mapName){if(_925.resourceInfo.singleFusedMapCache===true){if(!_925.baseMapLayer){if(_919(_925,_926)){if(_91d(_925,_926)){_929=_900(_925);}else{_929=_90b(_925);}}else{_929=_90b(_925);}}else{_929=_900(_925);}}else{_929=_90b(_925);}}else{if(_925.resourceInfo&&_925.resourceInfo.pixelSizeX){var _938=new _8d4();_938.bandIds=_925.bandIds;if(!_925.bandIds&&_925.resourceInfo.bandCount&&parseInt(_925.resourceInfo.bandCount,10)>3){_938.bandIds=[0,1,2];}_929=new _8c8(_8ff(_925.url),{resourceInfo:_925.resourceInfo,opacity:_925.opacity,visible:_925.visibility,id:_925.id,imageServiceParameters:_938,minScale:_925.minScale,maxScale:_925.maxScale});}else{if(_925.resourceInfo&&_925.resourceInfo.type==="Feature Layer"){_929=new _8cb(_8ff(_925.url),{resourceInfo:_925.resourceInfo,opacity:_925.opacity,visible:_925.visibility,id:_925.id,mode:_8b9.isDefined(_925.mode)?_925.mode:_8cb.MODE_ONDEMAND,outFields:["*"],infoTemplate:_925.popupInfo&&new _92a(_925.popupInfo),autoGeneralize:true});if(_925.layerDefinition){if(_925.layerDefinition.drawingInfo&&_925.layerDefinition.drawingInfo.renderer){var _939=_8c1.fromJson(_925.layerDefinition.drawingInfo.renderer);_939.isMaxInclusive=true;_929.setRenderer(_939);}if(_925.layerDefinition.definitionExpression){_929.setDefinitionExpression(_925.layerDefinition.definitionExpression);}if(_8b9.isDefined(_925.layerDefinition.minScale)){_929.setMinScale(_925.layerDefinition.minScale);}if(_8b9.isDefined(_925.layerDefinition.maxScale)){_929.setMaxScale(_925.layerDefinition.maxScale);}}}}}}}}}}}}}if(_929){_929.arcgisProps={title:_925.title};if(_925.baseMapLayer){if(_925.isReference){_929._basemapGalleryLayerType="reference";}else{_929._basemapGalleryLayerType="basemap";}}}return _929;};function _93a(_93b,_93c,_93d){_8b1.forEach(_93b,function(_93e,_93f){if(_93e.url&&!_93e.type){if(_93f===0||_93b[0].layerObject){_93e.layerObject=_924(_93e,_93b,_93c,_93d);}}else{if(_93e.url&&_93e.type=="CSV"){_93e.layerObject=_924(_93e,_93b,_93c,_93d);}else{_93e.layerObject=_924(_93e,_93b,_93c,_93d);}}});var _940=_8b1.filter(_93b,function(lyr){return !lyr.isReference;});var _941=_8b1.filter(_93b,function(lyr){return !!lyr.isReference;});_93b=_940.concat(_941);return _93b;};function _942(_943){var _944=null;var _945=_943[0];if(_945.url&&!_945.type){if(_945.resourceInfo.spatialReference){_944=new _8bb();if(_945.resourceInfo.spatialReference.wkid){_944.wkid=_945.resourceInfo.spatialReference.wkid;}if(_945.resourceInfo.spatialReference.wkt){_944.wkt=_945.resourceInfo.spatialReference.wkt;}}}else{if(_945.type.indexOf("BingMaps")>-1||_945.type=="OpenStreetMap"){_944=new _8bb({wkid:102100});}else{if(_945.type=="WMS"){_944=new _8bb({wkid:_945.spatialReferences[0]});}}}return _944;};function _946(_947,_948,_949,_94a,_94b){_8b1.forEach(_948,function(_94c,_94d){if(_94c.url&&!_94c.type){_94c.resourceInfo=_947[_94c.deferredsPos][1];delete _94c.deferredsPos;}else{if(_94c.url&&_94c.type=="CSV"){_94c.featureCollection=_94a[_94c.deferredsPos].results[0];delete _94c.deferredsPos;}}});var _94e=_942(_948);var _94f=[];var _950=new _8b3();_8b1.forEach(_948,function(_951){if(_951.url&&_951.type=="CSV"){_951.deferredsPos=_94f.length;_94f.push(csv.projectFeatureCollection(_951.featureCollection,_94e));}});if(_94f.length==0){_948=_93a(_948,_949,_94e);_94b.callback(_948);}else{var _952=new _8b5(_94f);_952.addCallback(function(){_8b1.forEach(_948,function(_953){if(_953.url&&_953.type=="CSV"){_953.featureCollection=_94f[_953.deferredsPos].results[0];delete _953.deferredsPos;}});_948=_93a(_948,_949,_94e);_94b.callback(_948);});}};function _954(url,_955){var url2=_8ff(url);return _8ba({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_956,io){if(_956.message){_956.message+=" [url:"+url2+"]";}else{_956.message="[url:"+url2+"]";}_955.push(_956);_8b8.defaults.io.errorHandler(_956,io);}});};function _957(_958,_959){var _95a=[];var _95b=[];var _95c=[];var _95d=new _8b3();_8b1.forEach(_958.operationalLayers,function(_95e,_95f){if(_95e.featureCollection){_8b1.forEach(_95e.featureCollection.layers,function(_960,idx){var _961=true;if(_95e.visibleLayers){if(_8b1.indexOf(_95e.visibleLayers,idx)==-1){_961=false;}}_960.visibility=(_95e.visibility&&_961);_960.opacity=_95e.opacity;_960.id=(_95e.id||("operational"+_95f))+"_"+idx;_95c.push(_960);},this);}else{_95c.push(_95e);}});_8b1.forEach(_958.baseMap.baseMapLayers,function(_962,_963){_962.baseMapLayer=true;_962.id=_962.id||("base"+_963);_95a.push(_962);});_8b1.forEach(_95c,function(_964,_965){_964.id=_964.id||("operational"+_965);_95a.push(_964);});_8b1.forEach(_95a,function(_966){if(_966.url&&!_966.type){_966.deferredsPos=_95b.length;_966.errors=[];_95b.push(_954(_966.url,_966.errors));}else{if(_966.url&&_966.type=="CSV"){_966.deferredsPos=_95b.length;_95b.push(csv.buildCSVFeatureCollection(_966));}}});if(_95b.length==0){var _967=_942(_95a);_95a=_93a(_95a,_959,_967);_95d.callback(_95a);}else{var _968=new _8b5(_95b);_968.addCallback(function(_969){_946(_969,_95a,_959,_95b,_95d);});}return _95d;};function _96a(_96b,_96c){if(_96c.version<=10.1&&_96b){var i,id=parseInt(_96c.url.substring(_96c.url.lastIndexOf("/")+1,_96c.url.length));for(i=_96b.length-1;i>=0;i--){if(_96b[i].id==id){if(_96c.minScale==0&&_96b[i].minScale>0){_96c.minScale=_96b[i].minScale;}else{if(_96c.minScale>0&&_96b[i].minScale==0){_96c.minScale=_96c.minScale;}else{if(_96c.minScale>0&&_96b[i].minScale>0){_96c.minScale=Math.min(_96c.minScale,_96b[i].minScale);}}}_96c.maxScale=Math.max(_96c.maxScale||0,_96b[i].maxScale||0);if(_96b[i].parentLayerId>-1){id=_96b[i].parentLayerId;}else{break;}}}}};function _96d(_96e,_96f,_970,map){var url=_96e.url;var _971=_96e.__popups;var ids=_96e.__popupIds;var urls=_96e.__popupUrls;var _972=_96e.__resourceInfo;var _973=[];_8b1.forEach(_971,function(_974,_975){if(!_974){return;}var _976,_977=[];_8b1.forEach(_974.fieldInfos,function(item){if(item.fieldName.toLowerCase()!=="shape"){_977.push(item.fieldName);}});if(_96e.dynamicLayerInfos&&_96e.dynamicLayerInfos.length>0){var _978=_8b1.filter(_96e.dynamicLayerInfos,function(item){return ids[_975]==item.id;})[0].source;_976=new _8cb(url+"/dynamicLayer",{id:_96e.id+"_"+ids[_975],source:_978,outFields:_977,mode:_8cb.MODE_SELECTION,infoTemplate:_974&&new _970(_974),drawMode:false,visible:_96e.visible,autoGeneralize:true});}else{var i,_979=null;if(_96f){for(i=0;i<_96f.length;i++){if(_96f[i].id===ids[_975]){_979=_96f[i];break;}}}var _97a=url+"/"+ids[_975];if(urls[_975].length){_97a=urls[_975];}_976=new _8cb(_8ff(_97a),{id:_96e.id+"_"+ids[_975],outFields:_977,mode:_8cb.MODE_SELECTION,infoTemplate:_974&&new _970(_974),drawMode:false,visible:_96e.visible,resourceInfo:_979,autoGeneralize:true});}if(_976.loaded){_96a(_972.layers,_976);}else{_8b2.connect(_976,"onLoad",function(_97b){_96a(_972.layers,_97b);});}_973.push(_976);});if(_973.length>0){var _97c=function(_97d,_97e){_8b1.forEach(_97d,function(_97f){if(_97e){_97f.show();}else{_97f.hide();}});};_8b2.connect(_96e,"onVisibilityChange",lang.hitch(this,_97c,_973));var _980=function(_981,_982,_983){if(_981.id===_983.id){_8b1.forEach(_982,function(_984){map.removeLayer(_984);});}};_8b2.connect(map,"onLayerRemove",lang.hitch(this,_980,_96e,_973));}delete _96e.__popups;delete _96e.__popupIds;delete _96e.__popupUrls;delete _96e.__resourceInfo;return _973;};function _985(_986){return _8ba({url:_8ff(_986.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _987(_988,map,_989){var _98a=[];_8b1.forEach(_988,function(_98b){var _98c=_98b.__popups;if(_98c&&_98c.length>1&&_98b.version>=10){_98b.__deferredsPos=_98a.length;_98a.push(_985(_98b));}});var _98d=[];if(_98a.length>0){var _98e=new _8b5(_98a);_98e.addCallback(function(_98f){_8b1.forEach(_988,function(_990){if(_990.__popups&&_990.__popups.length>0){if(_990.__deferredsPos||_990.__deferredsPos===0){var _991=_98f[_990.__deferredsPos][1];_98d=_98d.concat(_96d(_990,_991.layers,_989,map));delete _990.__deferredsPos;}else{_98d=_98d.concat(_96d(_990,null,_989,map));}}});map.addLayers(_98d);});}else{_8b1.forEach(_988,function(_992){if(_992.__popups&&_992.__popups.length>0){_98d=_98d.concat(_96d(_992,null,_989,map));}});map.addLayers(_98d);}};function _993(_994){_8b1.forEach(_994,function(_995){var _996=_995.layer;if(_996.toJson){var json=_996.toJson();if(json.featureSet&&_996.name.indexOf("Text")>-1){_8b1.forEach(json.featureSet.features,function(_997,idx){if(_997.attributes.TEXT){var _998=_996.graphics[idx];_998.symbol.setText(_997.attributes.TEXT);if(_997.symbol.horizontalAlignment){_998.symbol.align=_997.symbol.horizontalAlignment;}_998.setSymbol(_998.symbol);_998.setAttributes(_997.attributes);}},this);}}});};function _999(_99a){var _99b=6;_8b1.forEach(_99a,function(_99c){var _99d=_99c.renderer;if(_99d.declaredClass==="esri.renderer.SimpleRenderer"){var _99e=_99d.symbol;if(_99e&&_99e.xoffset){_99b=Math.max(_99b,Math.abs(_99e.xoffset));}if(_99e&&_99e.yoffset){_99b=Math.max(_99b,Math.abs(_99e.yoffset));}}else{if(_99d.declaredClass==="esri.renderer.UniqueValueRenderer"||_99d.declaredClass==="esri.renderer.ClassBreaksRenderer"){_8b1.forEach(_99d.infos,function(info){var _99f=info.symbol;if(_99f&&_99f.xoffset){_99b=Math.max(_99b,Math.abs(_99f.xoffset));}if(_99f&&_99f.yoffset){_99b=Math.max(_99b,Math.abs(_99f.yoffset));}});}}});return _99b;};function _9a0(evt){var map=this,_9a1=map.infoWindow,_9a2=evt.graphic;if(!map.loaded){return;}_9a1.hide();_9a1.clearFeatures();var _9a3=[];_8b1.forEach(map.graphicsLayerIds,function(_9a4){var _9a5=map.getLayer(_9a4);if(_9a5&&_9a5.declaredClass.indexOf("FeatureLayer")!==-1&&_9a5.loaded&&_9a5.visible){_9a5.clearSelection();if(_9a5.infoTemplate&&!_9a5.suspended){_9a3.push(_9a5);}}});_9a2=(_9a2&&_9a2.getInfoTemplate())?_9a2:null;if(!_9a3.length&&!_9a2){return;}var _9a6=_999(_9a3);var _9a7=evt.screenPoint,_9a8=map.toMap(new _8bd(_9a7.x-_9a6,_9a7.y+_9a6)),_9a9=map.toMap(new _8bd(_9a7.x+_9a6,_9a7.y-_9a6)),_9aa=new _8be(_9a8.x,_9a8.y,_9a9.x,_9a9.y,map.spatialReference);var _9ab=new _8c4();_9ab.geometry=_9aa;_9ab.timeExtent=map.timeExtent;var _9ac=_8b1.map(_9a3,function(_9ad){var dfd=_9ad.selectFeatures(_9ab);dfd.addCallback(function(){var _9ae=_9ad.getSelectedFeatures();return _9ae;});return dfd;});if(_9a2){var dfd=new _8b3();dfd.callback([_9a2]);_9ac.splice(0,0,dfd);}var _9af=_8b1.some(_9ac,function(dfd){return dfd.fired===-1;});if(!_9af){var _9b0=_9a2?1:0;_8b1.forEach(_9a3,function(_9b1){_9b0=_9b0+_9b1.getSelectedFeatures().length;});if(!_9b0){return;}}_9a1.setFeatures(_9ac);_9a1.show(evt.mapPoint,{closestFirst:true});};function _9b2(_9b3,_9b4,_9b5,_9b6,_9b7,_9b8){var _9b9=(_9b7.mapOptions||{}),_9ba,_9bb;if(!_9b9.infoWindow){_9ba=new _8c3(null,_8b6.create("div"));_9b9.infoWindow=_9ba;}if(!_8b9.isDefined(_9b9.showInfoWindowOnClick)){_9b9.showInfoWindowOnClick=false;}var map=new Map(_9b6,_9b9);if(_9b7.ignorePopups){_8b1.forEach(_9b3,function(_9bc){delete _9bc.infoTemplate;});}if(!(_9b7.ignorePopups||_9b7.disableClickBehavior)){_9bb=_8b2.connect(map,"onClick",_9a0);}_8b2.connect(map,"onLayersAddResult",_993);map.addLayers(_9b3);if(!_9b7.ignorePopups){_987(_9b3,map,_9b7._clazz);}var _9bd=[];_8b1.forEach(_9b4,function(_9be){_9bd=_9bd.concat(_9be.errors);},this);_9b8.callback({map:map,itemInfo:_9b5,errors:_9bd,clickEventHandle:_9bb,clickEventListener:_9a0});};function _9bf(_9c0,_9c1,_9c2,_9c3,_9c4){try{var _9c5=_9c2.mapOptions||{};_9c2.mapOptions=_9c5;var card=_9c0.item;var _9c6=[];_8b1.forEach(_9c4,function(_9c7){if(lang.isArray(_9c7.layerObject)){_8b1.forEach(_9c7.layerObject,function(l){_9c6.push(l);});}else{_9c6.push(_9c7.layerObject);}});if(!_9c6[0]){var msg="";if(_9c4[0].errors&&_9c4[0].errors.length){msg=" ("+_9c4[0].errors[0].message+")";}_9c3.errback(new Error(_8d6.arcgis.utils.baseLayerError+msg));return;}_9c6=_8b1.filter(_9c6,_8b9.isDefined);if(card){if(card.extent){if(!_9c5.extent){var _9c8=new _8be(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _8bb({wkid:4326}));var _9c9=_9c6[0].spatialReference;if(_9c9.wkid===4326){_9c5.extent=_9c8;_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);}else{if(_9c9.wkid===102100||_9c9.wkid===102113||_9c9.wkid===3857){_9c8.xmin=Math.max(_9c8.xmin,-180);_9c8.xmax=Math.min(_9c8.xmax,180);_9c8.ymin=Math.max(_9c8.ymin,-89.99);_9c8.ymax=Math.min(_9c8.ymax,89.99);_9c5.extent=_8bf.geographicToWebMercator(_9c8);_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);}else{if(_9c2.geometryServiceURL||_8b8.defaults.geometryService){var gs;if(_9c2.geometryServiceURL){gs=new _8c5(_9c2.geometryServiceURL);}else{gs=_8b8.defaults.geometryService;}gs.project([_9c8],_9c9,function(_9ca){var _9cb=_9ca[0];_9c5.extent=_9c5.extent||_9cb;_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);});}else{_9c3.errback(new Error(_8d6.arcgis.utils.geometryServiceError));}}}}else{_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);}}else{_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);}}else{_9b2(_9c6,_9c4,_9c0,_9c1,_9c2,_9c3);}}catch(err){_9c3.errback(err);}};function _9cc(_9cd){var _9ce=[];var _9cf=_9cd.baseMap.baseMapLayers.concat(_9cd.operationalLayers);_8b1.forEach(_9cf,function(_9d0,_9d1){var _9d2={};if(_9d0.featureCollection&&_9d0.type!=="CSV"){if(_9d0.featureCollection.showLegend===true){_8b1.forEach(_9d0.featureCollection.layers,function(_9d3){if(_9d3.showLegend!==false){_9d2={"layer":_9d3.layerObject,"title":_9d0.title,"defaultSymbol":false};if(_9d0.featureCollection.layers.length>1){_9d2.title+=" - "+_9d3.layerDefinition.name;}_9ce.push(_9d2);}});}}else{if((_9d0.baseMapLayer&&_9d0.showLegend===true&&_9d0.layerObject)||(!_9d0.baseMapLayer&&_9d0.showLegend!==false&&_9d0.layerObject)){var _9d4=false;if(_9d0.layerObject.version<10.1&&(_9d0.layerObject instanceof _8c7||_9d0.layerObject instanceof _8c6)){_9d4=true;}_9d2={"layer":_9d0.layerObject,"title":_9d0.title,"defaultSymbol":_9d4};if(_9d0.layers){var _9d5=_8b1.map(_8b1.filter(_9d0.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_9d5.length){_9d2.hideLayers=_9d5;}}_9ce.push(_9d2);}}});return _9ce;};function _9d6(_9d7){if(_8d7._arcgisUrl&&_8d7._arcgisUrl.length>0){_8d7.arcgisUrl=_8d7._arcgisUrl;}var url=_8d7.arcgisUrl+"/"+_9d7;var _9d8={},_9d9=new _8b3();_8ba({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_9da){_9d8.item=_9da;_8ba({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_9db){_9d8.itemData=_9db;_9d9.callback(_9d8);},error:function(_9dc){_9d9.errback(_9dc);}});},error:function(_9dd){_9d9.errback(_9dd);}});return _9d9;};function _9de(arg1,_9df,_9e0){var _9e1=new _8b3();_9e0=_9e0||{};var _9e2=_9e0.infoTemplateClass;_9e0._clazz=(_9e2&&(lang.isObject(_9e2)?_9e2:lang.getObject(_9e2)))||_8c2;if(lang.isString(arg1)){_9d6(arg1).addCallback(function(_9e3){_8e2(_9e3,_9e0).addCallback(function(_9e4){_957(_9e4.itemData,_9e0).addCallback(lang.hitch(null,_9bf,_9e4,_9df,_9e0,_9e1));});}).addErrback(lang.hitch(_9e1,_9e1.errback));}else{_8e2(arg1,_9e0).addCallback(function(_9e5){_957(_9e5.itemData,_9e0).addCallback(lang.hitch(null,_9bf,_9e5,_9df,_9e0,_9e1));});}return _9e1;};function _9e6(_9e7){if(_9e7&&_9e7.itemInfo&&_9e7.itemInfo.itemData){return _9cc(_9e7.itemInfo.itemData);}else{return [];}};_8d7={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_9d6,createMap:_9de,getLegendLayers:_9e6,_arcgisUrl:null,_getItemProps:_8e2,_getItemData:_8d8,_getBingKey:_8db,_processFSItemProperties:_8e0,_getLayers:_957,_preBuildLayerObjects:_946,_buildLayerObjects:_93a,_preCreateMap:_9bf,_getMapSR:_942,_createMap:_9b2,_addSelectionLayers:_987,_createSelectionFeatureLayers:_96d,_getServiceInfo:_954,_getLayersInfo:_985,_initLayer:_924,_loadAsCached:_900,_loadAsDynamic:_90b,_processPopups:_8f3,_onLayersAddResult:_993,_sameSpatialReferenceAsBasemap:_919,_sameTilingSchemeAsBasemap:_91d,_showPopup:_9a0,_calculateClickTolerance:_999,_getVisibleFeatureLayers:_904,_updateLayerScaleInfo:_96a,_checkUrl:_8ff,_isHostedService:_8fb,_isAgolService:_8fe,_getLegendLayers:_9cc};lang.setObject("arcgis.utils",_8d7,_8b7);return _8d7;});