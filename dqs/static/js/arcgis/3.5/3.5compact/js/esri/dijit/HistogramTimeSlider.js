/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:dojox/form/resources/HorizontalRangeSlider.html":"<table class=\"dijit dijitReset dijitSlider dijitSliderH dojoxRangeSlider\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" rules=\"none\" dojoAttachEvent=\"onkeypress:_onKeyPress,onkeyup:_onKeyUp\" role=\"presentation\"\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t\t><td dojoAttachPoint=\"topDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH\"></td\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t></tr\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\"\n\t\t\t><div class=\"dijitSliderDecrementIconH\" tabIndex=\"-1\" style=\"display:none\" dojoAttachPoint=\"decrementButton\"><span class=\"dijitSliderButtonInner\">-</span></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper\" dojoAttachEvent=\"onmousedown:_onClkDecBumper\"></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><input dojoAttachPoint=\"valueNode\" type=\"hidden\" ${!nameAttrSetting}\n\t\t\t/><div role=\"presentation\" class=\"dojoxRangeSliderBarContainer\" dojoAttachPoint=\"sliderBarContainer\"\n\t\t\t\t><div dojoAttachPoint=\"sliderHandle\" tabIndex=\"${tabIndex}\" class=\"dijitSliderMoveable dijitSliderMoveableH\" dojoAttachEvent=\"onmousedown:_onHandleClick\" role=\"slider\"\n\t\t\t\t\t><div class=\"dijitSliderImageHandle dijitSliderImageHandleH\"></div\n\t\t\t\t></div\n\t\t\t\t><div role=\"presentation\" dojoAttachPoint=\"progressBar,focusNode\" class=\"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH\" dojoAttachEvent=\"onmousedown:_onBarClick\"></div\n\t\t\t\t><div dojoAttachPoint=\"sliderHandleMax\" tabIndex=\"${tabIndex}\" class=\"dijitSliderMoveable dijitSliderMoveableH\" dojoAttachEvent=\"onmousedown:_onHandleClickMax\" role=\"slider\"\n\t\t\t\t\t><div class=\"dijitSliderImageHandle dijitSliderImageHandleH\"></div\n\t\t\t\t></div\n\t\t\t\t><div role=\"presentation\" dojoAttachPoint=\"remainingBar\" class=\"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH\" dojoAttachEvent=\"onmousedown:_onRemainingBarClick\"></div\n\t\t\t></div\n\t\t></td\n\t\t><td class=\"dijitReset\"\n\t\t\t><div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper\" dojoAttachEvent=\"onmousedown:_onClkIncBumper\"></div\n\t\t></td\n\t\t><td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\"\n\t\t\t><div class=\"dijitSliderIncrementIconH\" tabIndex=\"-1\" style=\"display:none\" dojoAttachPoint=\"incrementButton\"><span class=\"dijitSliderButtonInner\">+</span></div\n\t\t></td\n\t></tr\n\t><tr class=\"dijitReset\"\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t\t><td dojoAttachPoint=\"containerNode,bottomDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH\"></td\n\t\t><td class=\"dijitReset\" colspan=\"2\"></td\n\t></tr\n></table>\n","url:esri/dijit/templates/HistogramTimeSlider.html":"<div id=\"histogram-timeslider\" class=\"histogram-timeslider esriTimeSlider\">\r\n <div id=\"histogram-timeslider-dijit\">\r\n   <div id=\"focusTip\"></div>\r\n   <div id=\"scale-bar-left\"></div>\r\n   <div id=\"scale-bar-right\"></div>\r\n   <div id=\"histogram-container\"></div>\r\n   <div id=\"histogram-slider\"></div>\r\n   <div id=\"histogram-controls\">\r\n     <div id=\"histogram-range\"></div>\r\n   </div>\r\n  </div>\r\n</div>"}});define("esri/dijit/HistogramTimeSlider",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/has","dojo/dom","dojo/dom-style","dojox/gfx","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/form/RangeSlider","dijit/form/HorizontalSlider","esri/kernel","esri/TimeExtent","dojo/text!dojox/form/resources/HorizontalRangeSlider.html","dojo/text!esri/dijit/templates/HistogramTimeSlider.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){var _10=_1([_8,_9],{declaredClass:"esri.dijit.HistogramTimeSlider",widgetsInTemplate:false,templateString:_f,constructor:function(_11,_12){var _13=this;this.layers=_11.layers;this.element=_12;this.bins=[];this.fullTimeExtent=[];this._mode=_11.mode||"show_partial";this._resolution="esriTimeUnitsSeconds";this._max_bins=1000;this._prev_num_bins=0;this._max_bin_height=0;this._color=_11.color||"rgb(5, 112, 176)";this._active=false;this.is_streaming=false;this.load_count=0;this._wire();this._resolutions={"esriTimeUnitsSeconds":[0],"esriTimeUnitsMinutes":[0],"esriTimeUnitsHours":[0],"esriTimeUnitsDays":[0],"esriTimeUnitsMonths":[0],"esriTimeUnitsYears":[0]};this.layers.forEach(function(_14){var _15=_3.connect(_14,"onUpdateEnd",function(){_3.disconnect(_15);var i,li;_13.fullTimeExtent=_13.getFullTimeExtent();if(_14.declaredClass.match(/StreamLayer/g)){_13._bindStreamingEvents(_14);}if(_14.graphics){_13.updateLength=_14.graphics.length;for(i=0,li=_14.graphics.length;i<li;i++){var _16=_14.graphics[i].attributes[_14.timeInfo.startTimeField];_13._add(_16);}}});});},getFullTimeExtent:function(){var min=null;var max=null;var i,li;for(i=0,li=this.layers.length;i<li;i++){if(this.layers[i].timeInfo.timeExtent.startTime){var _17=this.layers[i].timeInfo.timeExtent.startTime.getTime();var end=this.layers[i].timeInfo.timeExtent.endTime.getTime();if(!min){min=_17;max=end;}else{if(min>_17){min=_17;}else{if(max<end){max=end;}}}}}return [min,max];},getCurrentTimeExtent:function(){},_wire:function(){var _18=this;_3.connect(_5.byId("map"),"onmouseup, blur",function(){if(_18._active&&(_18.bins.length!==_18._prev_num_bins)){_18._active=false;_18._prev_num_bins=_18.bins.length;_18._drawHistogram();_18._updateSlider();}});_3.connect(window,"resize",function(){_18._prev_num_bins=_18.bins.length;_18._drawHistogram();_18._updateSlider();});},_bindStreamingEvents:function(_19){var _1a=this;_3.connect(_19,"onMessage",function(m){_1a.is_streaming=true;var _1b=m.graphic.attributes[this.timeInfo.startTimeField];_1a._add(_1b);});_3.connect(_19,"onRemove",function(m){_1a.is_streaming=true;var _1c=m.graphic.attributes[this.timeInfo.startTimeField];if(_1a._mode==="show_partial"){_1a._remove(_1c);}});},_nextRes:function(){var res;for(res in this._resolutions){if(this._resolutions[res].length<=this._max_bins){return res;}}},_updateAllResolutions:function(_1d,_1e){var min=Math.floor(_1d/60),_1f=Math.floor(_1d/(60*60)),day=Math.floor(_1d/(60*60*24));var _20=(min-this._resolutions.esriTimeUnitsMinutes.length);var i,j;if(_20>=1){for(i=0;i<_20;i++){this._resolutions.esriTimeUnitsMinutes.push(0);}}if(!this._resolutions.esriTimeUnitsMinutes[min]){this._resolutions.esriTimeUnitsMinutes[min]=0;}!_1e?this._resolutions.esriTimeUnitsMinutes[min]++:this._resolutions.esriTimeUnitsMinutes[min]--;var _21=(_1f-this._resolutions.esriTimeUnitsHours.length);if(_21>=1){for(j=0;j<_21;j++){this._resolutions.esriTimeUnitsHours.push(0);}}if(!this._resolutions.esriTimeUnitsHours[_1f]){this._resolutions.esriTimeUnitsHours[_1f]=0;}!_1e?this._resolutions.esriTimeUnitsHours[_1f]++:this._resolutions.esriTimeUnitsHours[_1f]--;if(!this._resolutions.esriTimeUnitsDays[day]){this._resolutions.esriTimeUnitsDays[day]=0;}!_1e?this._resolutions.esriTimeUnitsDays[day]++:this._resolutions.esriTimeUnitsDays[day]--;if(this._resolutions[this._resolution].length>=this._max_bins){this._resolution=this._nextRes();}var _22;switch(this._resolution){case "esriTimeUnitsSeconds":_22=_1d;this._numeric_res=1000;break;case "esriTimeUnitsMinutes":_22=min;this._numeric_res=6000;break;case "esriTimeUnitsHours":_22=_1f;this._numeric_res=3600000;break;case "esriTimeUnitsDays":_22=day;this._numeric_res=8640000;break;}this._setBins(_22);},_setBins:function(_23){this.bins=this._resolutions[this._resolution];var _24=0;var i=0;while(this.bins[i]===0){_24=i+1;i=i+1;}if(this._active){if(_24!==this.minVisibleIndex){this.minVisibleIndex=_24;}return;}else{if(!this.is_steaming&&this.updateLength===this.load_count){if((this.bins.length!==this._prev_num_bins)||(_24!==this.minVisibleIndex)){this.minVisibleIndex=_24;this._prev_num_bins=this.bins.length;this._drawHistogram();if(this._slider){this._updateSlider();}}else{this._updateHeights(_23);}}}},_updateFullTimeExtent:function(_25){if(!this.fullTimeExtent[0]){this.fullTimeExtent[0]=_25;}if(!this.fullTimeExtent[1]){this.fullTimeExtent[1]=_25;}if(_25<this.fullTimeExtent[0]){this.fullTimeExtent[0]=_25;}if(_25>this.fullTimeExtent[1]){this.fullTimeExtent[1]=_25;}},_getBin:function(_26){var _27=Math.floor((_26-this.fullTimeExtent[0])/1000);return _27;},_add:function(_28){if(!this.is_steaming){this.load_count++;}this._updateFullTimeExtent(_28);var _29=this._getBin(_28);var _2a=(_29-this._resolutions.esriTimeUnitsSeconds.length);var i;if(_2a>=1){for(i=0;i<_2a;i++){this._resolutions.esriTimeUnitsSeconds.push(0);}}if(!this._resolutions.esriTimeUnitsSeconds[_29]){this._resolutions.esriTimeUnitsSeconds[_29]=1;}else{this._resolutions.esriTimeUnitsSeconds[_29]++;}this._updateAllResolutions(_29);if(!this._slider){this._creatSlider();}},_remove:function(_2b){var _2c=this._getBin(_2b);this._resolutions.esriTimeUnitsSeconds[_2c]--;this._updateAllResolutions(_2c,true);if(!this._active){this._updateSlider();}},_creatSlider:function(){var _2d=this;var _2e=_1([_b,_a],{templateString:_e});this._slider=new _2e({name:"histogram-slider",values:[0,100],minimum:0,maximum:100,showButtons:false,intermediateChanges:true,discreteValues:2,style:"width:100%",onChange:function(_2f){var min=Math.floor(_2f[0]);var max=Math.floor(_2f[1]);_2d._getUserExtents(min,max);_2d._disableBins(min,max);}},"histogram-slider");},_updateSlider:function(){this._slider.discreteValues=this.histogram.length+1;this._slider.maximum=this.histogram.length;this._slider._setValueAttr([0,this.histogram.length],false,false);},_getUserExtents:function(min,max){var _30=new _d();_30.startTime=new Date(this.fullTimeExtent[0]+((min+this.minVisibleIndex)*this._numeric_res));_30.endTime=new Date(this.fullTimeExtent[0]+((max+this.minVisibleIndex)*this._numeric_res));this._updateDateRange(_30);this.onTimeExtentChange(_30);},_drawHistogram:function(){var _31=this,_32=[];if(this.histogramSurface){this.histogramSurface.clear();}else{this.histogramSurface=_7.createSurface("histogram-container",_5.byId(this.element.id).offsetWidth,100);}var max=Math.max.apply(Math,this.bins),_33=(this.histogramSurface._parent.clientWidth/(this.bins.length-this.minVisibleIndex)),gap=_33/10,x=0;this.histogram=[];var i,li;for(i=this.minVisibleIndex,li=this.bins.length;i<li;i++){var _34=(this.bins[i]/max)*100;var y=(100-_34);var bar=this.histogramSurface.createRect({x:x,y:y,width:_33-gap,height:_34}).setFill(this._color);this.histogram.push(bar);x=x+_33;_32.push(x);bar.bin=this.bins[i];bar.x=x-_33;bar.num=i;bar.max=max;bar.connect("onmouseenter",bar,function(){_31._showTipForBin(this.bin,this.num,this.x);});bar.connect("onmouseleave",bar,function(){_31._hideTipForBin();});}this._updateTimeTicks(_32);this._updateScaleBar(max);},_updateHeights:function(_35){var max=Math.max.apply(Math,this.bins);var _36;var y;var i,li;if(max!==this._max_bin_height){for(i=this.minVisibleIndex,li=this.histogram.length;i<li;i++){_36=(this.bins[i]/max)*100;y=100-_36;this.histogram[i].setShape({y:y,height:_36});}}else{_36=(this.bins[_35]/max)*100;y=100-_36;this.histogram[_35-this.minVisibleIndex].setShape({y:y,height:_36});}this._updateScaleBar(max);this._max_bin_height=max;},_updateTimeTicks:function(_37){var _38=Math.floor(this.histogram.length/3);var _39;var i;for(i=0;i<2;i++){this.histogramSurface.createLine({x1:_37[_38],y1:0,x2:_37[_38],y2:this.histogramSurface._parent.clientHeight}).setStroke("rgb(200, 200, 200)");_39=new Date(this.fullTimeExtent[0]+(((_38+1)-this.minVisibleIndex)*this._numeric_res)).toLocaleString();this.histogramSurface.createText({x:_37[_38]+2,y:10,text:_39}).setFont({size:"12px"}).setFill("rgb(82, 95, 109)");_38=_38+_38;}},_updateDateRange:function(_3a){var _3b=new Date(_3a.startTime).toLocaleString();var end=new Date(_3a.endTime).toLocaleString();_5.byId("histogram-range").innerHTML="Date Range: "+_3b+" - "+end;},_disableBins:function(min,max){var _3c=this;if(min===0&&max===this.histogram.length){this.histogram[this.histogram.length-1].setFill(this._color);return;}this.histogram.forEach(function(bar,i){if(i<min){bar.setFill("rgb(216,216,216)");}else{if(i>=max){bar.setFill("rgb(216,216,216)");}else{bar.setFill(_3c._color);}}});},_updateScaleBar:function(max){if(this.scaleLeft){this.scaleLeft.clear();this.scaleRight.clear();}else{this.scaleRight=_7.createSurface("scale-bar-right",45,110);this.scaleLeft=_7.createSurface("scale-bar-left",45,110);}var _3d,_3e,_3f;_3d=(max>99)?_3e=10:20;_3f=((max/2)>99)?_3f=10:20;this.scaleLeft.createLine({x1:40,y1:5,x2:40,y2:130}).setStroke("rgb(82, 95, 109)");this.scaleLeft.createLine({x1:40,y1:5,x2:37,y2:5}).setStroke("rgb(82, 95, 109)");this.scaleLeft.createLine({x1:40,y1:60,x2:37,y2:60}).setStroke("rgb(82, 95, 109)");this.scaleLeft.createText({x:_3d,y:10,text:max}).setFont({size:"14px"}).setFill("rgb(82, 95, 109)");this.scaleLeft.createText({x:_3f,y:65,text:(Math.floor(max/2))}).setFont({size:"14px"}).setFill("rgb(82, 95, 109)");this.scaleRight.createLine({x1:0,y1:5,x2:0,y2:130}).setStroke("rgb(82, 95, 109)");this.scaleRight.createLine({x1:0,y1:5,x2:3,y2:5}).setStroke("rgb(82, 95, 109)");this.scaleRight.createLine({x1:0,y1:60,x2:3,y2:60}).setStroke("rgb(82, 95, 109)");this.scaleRight.createText({x:4,y:10,text:max}).setFont({size:"14px"}).setFill("rgb(82, 95, 109)");this.scaleRight.createText({x:4,y:65,text:(Math.floor(max/2))}).setFont({size:"14px"}).setFill("rgb(82, 95, 109)");},_showTipForBin:function(bin,cnt,x){if(this._active){return;}var _40=new Date(this.fullTimeExtent[0]+((cnt-this.minVisibleIndex)*this._numeric_res)).toLocaleString();_5.byId("focusTip").innerHTML=("<span style='font-size:8pt'>"+_40+"</span> <br /> Count: "+bin);_6.set("focusTip",{"display":"block","left":x+"px","top":"-10px"});},_hideTipForBin:function(){_5.byId("focusTip").style.display="none";},onTimeExtentChange:function(){}});if(_4("extend-esri")){_2.setObject("dijit.HistogramTimeSlider",_10,_c);}return _10;});