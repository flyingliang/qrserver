/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/analysis/templates/AggregateTool.html":"<div class=\"esriAnalysis\">\r\n    <div data-dojo-type=\"dijit/layout/ContentPane\" style=\"margin-top:0.5em; margin-bottom: 0.5em;\">\r\n      <div data-dojo-attach-point=\"_aggregateToolContentTitle\" class=\"analysisTitle\">\r\n        <table class=\"esriFormTable\" > \r\n          <tr>\r\n            <td><div class=\"aggregateIcon\"></div></td>\r\n            <td>${i18n.aggregateToolName}</td>\r\n            <td>\r\n              <div class=\"esriFloatTrailing\" style=\"padding:0;\">\r\n                  <a href=\"#\" class='esriFloatLeading helpIcon' esriHelpTopic=\"toolDescription\"></a>\r\n                  <a href=\"#\" data-dojo-attach-point=\"_closeBtn\" title=\"${i18n.close}\" class=\"closeIcon\">              \r\n                  <img data-dojo-attach-point=\"_closeImg\" border=\"0\"/></a>            \r\n              </div>                \r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n      <div style=\"clear:both; border-bottom: #333 thin solid; height:1px;width:100%;\"></div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"_form\" readOnly=\"true\">\r\n       <table class=\"esriFormTable\"  data-dojo-attach-point=\"_aggregateTable\"  style=\"border-collapse:collapse;border-spacing:5px;\" cellpadding=\"5px\" cellspacing=\"5px\"> \r\n         <tbody>\r\n          <tr>\r\n            <td  colspan=\"3\" class=\"sectionHeader\" data-dojo-attach-point=\"_aggregateToolDescription\" >${i18n.aggregateDefine}</td>\r\n          </tr>      \r\n          <tr>\r\n            <td colspan=\"3\">\r\n              <label class=\"esriFloatLeading esriTrailingMargin025\">${i18n.oneLabel}</label>\r\n              <label class=\"\">${i18n.chooseAreaLabel}</label>\r\n              <a href=\"#\" class='esriFloatTrailing helpIcon' esriHelpTopic=\"PolygonLayer\"></a>\r\n              <select class=\"longInput esriLongLabel\"  style=\"margin-top:1.0em;\" data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"_layersSelect\" data-dojo-attach-event=\"onChange:_handleLayerChange\"></select>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n         <tr>\r\n           <td colspan=\"3\">\r\n             <label class=\"esriSelectLabel\">\r\n               <div data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-point=\"_keepPolygonsCheck\" data-dojo-props=\"checked:'true'\"></div>\r\n               ${i18n.keepPolygonLabel}\r\n             </label>\r\n              <a href=\"#\" class='esriFloatTrailing helpIcon' esriHelpTopic=\"KeepBoundaryNoPoints\"></a>\r\n           </td>\r\n          </tr>    \r\n          <tr>\r\n            <td colspan=\"3\" class=\"clear\"></td>\r\n          </tr>\r\n          <tr>\r\n            <td colspan=\"2\">\r\n              <label class=\"esriFloatLeading esriTrailingMargin025\">${i18n.twoLabel}</label>\r\n              <label class=\"longTextInput\">${i18n.addStatsLabel}</label>\r\n            </td>\r\n            <td class=\"shortTextInput\">\r\n              <a href=\"#\" class='esriFloatTrailing helpIcon' esriHelpTopic=\"SummaryFields\"></a> \r\n            </td>             \r\n          </tr>\r\n          <tr data-dojo-attach-point=\"_afterStatsRow\">\r\n            <td colspan=\"3\" class=\"clear\"></td>\r\n          </tr>\r\n          <!--\r\n          <tr>\r\n            <td colspan=\"2\">\r\n              <label class=\"esriFloatLeading esriTrailingMargin025\">${i18n.threeLabel}</label>\r\n              <label class=\"longTextInput\"  data-dojo-attach-point=\"_groupByLabel\">${i18n.groupByLabel}</label>\r\n            </td>\r\n            <td class=\"shortTextInput\">\r\n              <a href=\"#\" class='esriFloatTrailing helpIcon' esriHelpTopic=\"GroupByField\"></a> \r\n            </td>             \r\n          </tr>\r\n          <tr>\r\n            <td colspan=\"3\">\r\n              <select class=\"longInput\" data-dojo-type=\"dijit.form.Select\"  data-dojo-props=\"disabled:true\" data-dojo-attach-point=\"_groupBySelect\"></select>\r\n            </td>                \r\n          </tr>         \r\n          <tr>\r\n            <td colspan=\"3\" class=\"clear\"></td>\r\n          </tr> -->\r\n          <tr>\r\n            <td colspan=\"2\">\r\n              <label class=\"esriFloatLeading esriTrailingMargin025\">${i18n.threeLabel}</label>\r\n              <label class=\"longTextInput\">${i18n.outputLayerLabel}</label>\r\n            </td>\r\n            <td class=\"shortTextInput\">\r\n              <a href=\"#\" class='esriFloatTrailing helpIcon' esriHelpTopic=\"OutputLayer\"></a> \r\n            </td>             \r\n          </tr>\r\n          <tr>\r\n            <td colspan=\"3\">\r\n              <input type=\"text\" data-dojo-type=\"dijit/form/ValidationTextBox\" class=\"longInput\" data-dojo-props=\"required:true\" data-dojo-attach-point=\"_outputLayerInput\" value=\"\"></input>\r\n            </td>                \r\n          </tr>\r\n          <tr>\r\n            <td colspan=\"3\">\r\n               <div data-dojo-attach-point=\"_chooseFolderRow\">\r\n                 <label style=\"width:9px;font-size:smaller;\">${i18n.saveResultIn}</label>\r\n                 <input class=\"longInput\" dojoAttachPoint=\"_webMapFolderSelect\" dojotype=\"dijit/form/ComboBox\" trim=\"true\" style=\"width:60%;height:auto\"></input>\r\n               </div>              \r\n            </td>\r\n          </tr>\r\n        </tbody>         \r\n       </table>\r\n     </div>\r\n    <div id=\"aggregateToolContentButtons\" style=\"padding:5px;margin-top:5px;border-top:solid 1px #BBB;\">\r\n       <div data-dojo-attach-point=\"_chooseExtentDiv\" style=\"width:100%;padding:0.5em 0 0.5em 0\">\r\n         <label class=\"esriSelectLabel\" style=\"font-size:smaller;\">\r\n           <input type=\"radio\" data-dojo-attach-point=\"_useExtentCheck\" data-dojo-type=\"dijit/form/CheckBox\" data-dojo-props=\"checked:true\" name=\"extent\" value=\"true\"/>\r\n             ${i18n.useMapExtent}\r\n         </label>    \r\n        </div>  \r\n        <button data-dojo-type=\"dijit/form/Button\" type=\"submit\" data-dojo-attach-point=\"_saveBtn\" class=\"esriLeadingMargin4\" data-dojo-attach-event=\"onClick:_handleSaveBtnClick\">\r\n            ${i18n.runAnalysis}\r\n        </button>\r\n    </div>\r\n</div>\r\n"}});define("esri/dijit/analysis/AggregateTool",["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/json","dojo/has","dojo/i18n","dojo/json","dojo/string","dojo/dom-style","dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","dijit/registry","dijit/form/Button","dijit/form/CheckBox","dijit/form/Form","dijit/form/Select","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/layout/ContentPane","dijit/form/ComboBox","esri/kernel","esri/dijit/analysis/AnalysisBase","esri/dijit/analysis/utils","dojo/text!esri/dijit/analysis/templates/AggregateTool.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21){var _22=_2([_10,_11,_12,_13,_14,_1f],{declaredClass:"esri.dijit.analysis.AggregateTool",templateString:_21,basePath:_1.toUrl("esri/dijit/analysis"),widgetsInTemplate:true,pointLayer:null,polygonLayers:null,summaryFields:null,outputLayerName:null,keepBoundariesWithNoPoints:true,polygonLayer:null,groupByField:null,showSelectFolder:false,showChooseExtent:true,i18n:null,toolName:"AggregatePoints",helpFileName:"AggregatePoints",resultParameter:"AggregatedLayer",constructor:function(_23,_24){this.inherited(arguments);this._pbConnects=[];if(_23.containerNode){this.container=_23.containerNode;}},destroy:function(){this.inherited(arguments);_4.forEach(this._pbConnects,_5.disconnect);delete this._pbConnects;},postMixInProperties:function(){this.inherited(arguments);_3.mixin(this.i18n,_8.getLocalization("esri","jsapi").aggregatePointsTool);},postCreate:function(){this.inherited(arguments);_f.add(this._form.domNode,"esriSimpleForm");_c.set(this._closeImg,"src",this.basePath+"/images/close.gif");this._outputLayerInput.set("validator",_3.hitch(this,this.validateServiceName));this._buildUI();},startup:function(){},_onClose:function(_25){if(_25){this._save();this.onSave();}this.onClose();},_handleSaveBtnClick:function(e){if(!this._form.validate()){return;}this._saveBtn.set("disabled",true);var _26={},_27={};var _28=this.polygonLayers[this._layersSelect.get("value")];_26.PolygonLayer=_6.toJson(_20.constructAnalysisInputLyrObj(_28));_26.PointLayer=_6.toJson(_20.constructAnalysisInputLyrObj(this.pointLayer));_26.SummaryFields=_6.toJson(this.get("aggregateFields"));_26.OutputName=_6.toJson({serviceProperties:{name:this._outputLayerInput.get("value")}});_26.KeepBoundariesWithNoPoints=this._keepPolygonsCheck.get("checked");if(this.showChooseExtent){if(this._useExtentCheck.get("checked")){_26.context=_6.toJson({extent:this.map.extent});}}_27.jobParams=_26;_27.itemParams={"description":_a.substitute(this.i18n.itemDescription,{pointlayername:this.pointLayer.name,polygonlayername:_28.name}),"tags":_a.substitute(this.i18n.itemTags,{pointlayername:this.pointLayer.name,polygonlayername:_28.name}),"snippet":this.i18n.itemSnippet};if(this.showSelectFolder){_27.itemParams.folder=this._webMapFolderSelect.item?this.folderStore.getValue(this._webMapFolderSelect.item,"id"):"";}this.execute(_27);},_handleLayerChange:function(_29){this.outputLayerName=_a.substitute(this.i18n.outputLayerName,{pointlayername:this.pointLayer.name,polygonlayername:this.polygonLayers[_29].name});this._outputLayerInput.set("value",this.outputLayerName);},_handleAttrSelectChange:function(_2a){if(_2a!=="0"){statsSelect=this.get("statisticSelect");if(statsSelect.get("value")!=="0"){if(!statsSelect.get("isnewRowAdded")){removeTd=statsSelect.get("removeTd");_b.set(removeTd,"display","block");var obj=statsSelect.get("referenceWidget");_3.hitch(obj,obj._createStatsRow());statsSelect.set("isnewRowAdded",true);}}}},_handleStatsValueUpdate:function(_2b,_2c,_2d){var _2e,_2f;if(!this.get("attributeSelect")){return;}_2e=this.get("attributeSelect");if(_2e.get("value")!=="0"&&_2d!=="0"){if(!this.get("isnewRowAdded")){_2f=this.get("removeTd");_b.set(_2f,"display","block");var obj=this.get("referenceWidget");_3.hitch(obj,obj._createStatsRow());this.set("isnewRowAdded",true);}}},_save:function(){},_buildUI:function(){this._loadConnections();_20.initHelpLinks(this.domNode);if(this.pointLayer){_c.set(this._aggregateToolDescription,"innerHTML",_a.substitute(this.i18n.aggregateDefine,{layername:this.pointLayer.name}));}if(this.polygonLayers){_4.forEach(this.polygonLayers,function(_30,_31){if(_30.geometryType==="esriGeometryPolygon"){this._layersSelect.addOption({value:_31,label:_30.name});if(_31===0&&!this.outputLayerName){this.outputLayerName=_a.substitute(this.i18n.outputLayerName,{pointlayername:this.pointLayer.name,polygonlayername:_30.name});}}},this);}if(this.outputLayerName){this._outputLayerInput.set("value",this.outputLayerName);}this._keepPolygonsCheck.set("checked",this.keepBoundariesWithNoPoints);if(this.polygonLayer){this._layersSelect.set();}this._createStatsRow();_4.forEach(this.aggregateFields,function(_32){var _33=_32.split(" ");this._currentAttrSelect.set("value",_33[0]);_3.hitch(this._currentAttrSelect,this._handleAttrSelectChange,_33[0])();this._currentStatsSelect.set("value",_33[1]);_3.hitch(this._currentStatsSelect,this._handleStatsValueUpdat,"value","",_33[1])();},this);_b.set(this._chooseFolderRow,"display",this.showSelectFolder===true?"block":"none");if(this.showSelectFolder){this.getFolderStore().then(_3.hitch(this,function(_34){this.folderStore=_34;this._webMapFolderSelect.set("store",_34);this._webMapFolderSelect.set("value",this.portalUser.username);}));}_b.set(this._chooseExtentDiv,"display",this.showChooseExtent===true?"block":"none");},_loadConnections:function(){this._connect(this,"onExecute",_3.hitch(this,"_onClose",false));this._connect(this._closeBtn,"onclick",_3.hitch(this,"_onClose",false));},_createStatsRow:function(_35){var _36,_37,_38,_39,_3a,_3b,_3c;_36=_d.create("tr",null,this._afterStatsRow,"before");_38=_d.create("td",{style:{width:"49%",maxWidth:"100px"}},_36);_37=_d.create("td",{style:{width:"50%",maxWidth:"104px"}},_36);_39=new _19({maxHeight:200,"class":"mediumInput esriTrailingMargin025 attrSelect",style:{tableLayout:"fixed",overflowX:"hidden"}},_d.create("select",null,_38));this.set("attributes",{selectWidget:_39,pointLayer:this.pointLayer});_3a=new _19({"class":"mediumInput statsSelect",style:{tableLayout:"fixed",overflowX:"hidden"}},_d.create("select",null,_37));this.set("statistics",{selectWidget:_3a});_39.set("statisticSelect",_3a);_5.connect(_39,"onChange",this._handleAttrSelectChange);_3c=_d.create("td",{"class":"shortTextInput removeTd",style:{"display":"none",maxWidth:"12px"}},_36);_3b=_d.create("a",{"title":this.i18n.removeAttrStats,"class":"closeIcon statsRemove","innerHTML":"<img src='"+this.basePath+"/images/close.gif"+"' border='0''/>"},_3c);_5.connect(_3b,"onclick",_3.hitch(this,this._removeStatsRow,_36));_3a.set("attributeSelect",_39);_3a.set("removeTd",_3c);_3a.set("isnewRowAdded",false);_3a.set("referenceWidget",this);_3a.watch("value",this._handleStatsValueUpdate);this._currentStatsSelect=_3a;this._currentAttrSelect=_39;return true;},_removeStatsRow:function(row){_4.forEach(_15.findWidgets(row),function(w){w.destroyRecursive();});_d.destroy(row);},_setAnalysisGpServerAttr:function(url){this.analysisGpServer=url;this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);},_setPointLayerAttr:function(_3d){if(_3d.geometryType==="esriGeometryPoint"){this.pointLayer=_3d;}else{}},_setPolygonLayersAttr:function(_3e){this.polygonLayers=_3e;},_setLayersAttr:function(_3f){this.polygonLayers=[];_4.forEach(_3f,function(_40,_41){if(_40.geometryType==="esriGeometryPolygon"){this.polygonLayers.push(_40);}else{if(_40.geometryType==="esriGeometryPoint"){this.pointLayer=_40;}}},this);},_setAttributesAttr:function(_42){if(!_42.pointLayer){return;}var _43=_42.pointLayer;var _44=_42.selectWidget;var _45=_43.fields;_44.addOption({value:"0",label:this.i18n.attribute});_4.forEach(_45,function(_46,_47){if(_4.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_46.type)!==-1){if(_46.name!==_43.objectIdField){_44.addOption({value:_46.name,label:_46.name});}}},this);},_setStatisticsAttr:function(_48){var _49=_48.selectWidget;_49.addOption({value:"0",label:this.i18n.statistic});_49.addOption({value:"SUM",label:this.i18n.sum});_49.addOption({value:"MIN",label:this.i18n.minimum});_49.addOption({value:"MAX",label:this.i18n.maximum});_49.addOption({value:"MEAN",label:this.i18n.average});_49.addOption({value:"STDDEV",label:this.i18n.standardDev});},_setAggregateFieldsAttr:function(_4a){this.aggregateFields=_4a;},_getAggregateFieldsAttr:function(){var _4b="";var _4c=[];_e(".statsSelect",this.domNode).forEach(function(_4d,_4e){var _4f=_15.byNode(_4d);var _50=_4f.get("attributeSelect");if(_50.get("value")!=="0"&&_4f.get("value")!=="0"){_4b+=_50.get("value")+" "+_4f.get("value")+";";_4c.push(_50.get("value")+" "+_4f.get("value"));}});return _4c;},_setDisableRunAnalysisAttr:function(_51){this._saveBtn.set("disabled",_51);},_setShowSelectFolderAttr:function(_52){this.showSelectFolder=_52;},_getShowSelectFolderAttr:function(){return this.showSelectFolder;},_setShowChooseExtentAttr:function(_53){this.showChooseExtent=_53;},_getShowChooseExtentAttr:function(){return this.showChooseExtent;},_setMapAttr:function(map){this.map=map;},_getMapAttr:function(){return this.map;},validateServiceName:function(_54){var _55=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(_54);if(_54.length===0||(_54.trim().length===0)){this._outputLayerInput.set("invalidMessage",this.i18n.requiredValue);return false;}if(_55){this._outputLayerInput.set("invalidMessage",this.i18n.invalidServiceName);return false;}if(_54.length>128){this._outputLayerInput.set("invalidMessage",this.i18n.invalidServiceNameLength);return false;}return true;},_connect:function(_56,evt,_57){this._pbConnects.push(_5.connect(_56,evt,_57));},onSave:function(){},onClose:function(){}});if(_7("extend-esri")){_3.setObject("dijit.analysis.AggregateTool",_22,_1e);}return _22;});